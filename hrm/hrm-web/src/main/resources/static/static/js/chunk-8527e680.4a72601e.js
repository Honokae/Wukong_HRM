(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8527e680"],{7322:function(e,t,a){"use strict";a("7efa")},"7efa":function(e,t,a){},e407:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("flexbox",{staticClass:"main",attrs:{direction:"column",align:"stretch"}},[a("xr-header",{attrs:{label:"流程委托"}},[a("template",{slot:"otherLabel"},[a("el-tooltip",{attrs:{effect:"dark",placement:"top",content:"流程委托是指将某一时间段内某位员工需要处理的流程，委托给另一个员工处理。"}},[a("i",{staticClass:"wk wk-help wk-help-tips"})])],1),e._v(" "),e.addAuth?a("el-button",{attrs:{slot:"ft",type:"primary"},on:{click:e.addClick},slot:"ft"},[e._v("新建委托")]):e._e()],2),e._v(" "),a("div",{staticClass:"main-body"},[a("flexbox",{staticClass:"content-table-header"},[a("el-select",{on:{change:e.refreshList},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-table",class:e.WKConfig.tableStyle.class,staticStyle:{width:"100%"},attrs:{id:"examine-table",data:e.list,stripe:e.WKConfig.tableStyle.stripe,height:e.tableHeight,"highlight-current-row":""}},[e._l(e.fieldList,(function(t,i){return a("el-table-column",{key:i,attrs:{formatter:e.fieldFormatter,prop:t.prop,"min-width":t.width,label:t.label,"show-overflow-tooltip":""}})})),e._v(" "),e.editAuth||e.changeStateAuth?a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.editAuth?a("el-button",{staticStyle:{padding:"0"},attrs:{disabled:e.commissionTime(t.row),type:"primary-text"},on:{click:function(a){e.handleClick("edit",t)}}},[e._v("编辑")]):e._e(),e._v(" "),e.changeStateAuth?a("el-button",{staticStyle:{padding:"0"},attrs:{type:"primary-text"},on:{click:function(a){e.handleClick("state",t)}}},[e._v(e._s(0===t.row["state"]?"启用":"停用"))]):e._e()]}}])}):e._e()],2),e._v(" "),a("div",{staticClass:"p-contianer"},[a("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,background:"",layout:"prev, pager, next, sizes, total, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),e.createViewVisible?a("process-delegation-create",{attrs:{data:e.editData},on:{success:e.refreshList,close:function(t){e.createViewVisible=!1}}}):e._e()],1)},l=[],n=a("5530"),s=(a("a15b"),a("d81d"),a("99af"),a("b775"));function r(e){return Object(s["a"])({url:"/examineDelegate/queryPageList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function o(e){return Object(s["a"])({url:"/examineDelegate/save",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function c(e){return Object(s["a"])({url:"/examineDelegate/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function d(e){return Object(s["a"])({url:"/examineDelegate/setDelegateState/".concat(e.delegateId,"/").concat(e.state),method:"post",data:e})}var u=a("f468"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("xr-create",{attrs:{loading:e.loading,title:e.title},on:{close:e.close,save:e.debouncedSaveField}},[a("wk-form",{ref:"wkBaseFrom",attrs:{model:e.fieldsForm,rules:e.fieldsRules,"field-from":e.fieldsForm,"field-list":e.fields,"label-position":"top"},on:{change:e.formChange},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.data;return[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"picker-options":e.expireTimeOption,type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",clearable:"","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.fieldsForm[i.field],callback:function(t){e.$set(e.fieldsForm,i.field,t)},expression:"fieldsForm[data.field]"}})]}}])})],1)},f=[],h=(a("d3b7"),a("159b"),a("8156")),m=a("5067"),g=a("7a1a"),b=a("0730"),v=a("ed08"),w=a("6bfe"),y={name:"ProcessDelegationCreate",components:{XrCreate:h["a"],WkForm:m["a"]},mixins:[b["a"]],props:{data:{type:Object,default:function(){return{}}}},data:function(){return{loading:!1,fieldsForm:{},fields:[{field:"delegateUserId",formType:"user",isNull:1,name:"委托人",setting:[],inputTips:"",radio:!0},{field:"trusteeUserId",formType:"user",isNull:1,name:"受委托人",setting:[],inputTips:"",radio:!0},{field:"labels",formType:"checkbox",isNull:1,name:"业务模块",setting:[{label:"办公审批",value:"0"},{label:"合同",value:"1"},{label:"回款",value:"2"},{label:"发票",value:"3"},{label:"薪资",value:"4"},{label:"采购审核",value:"5"},{label:"采购退货审核",value:"6"},{label:"销售审核",value:"7"},{label:"销售退货审核",value:"8"},{label:"付款单审核",value:"9"},{label:"回款单审核",value:"10"},{label:"盘点审核",value:"11"},{label:"调拨审核",value:"12"},{label:"阶段审批",value:"20"}],clearable:!0},{field:"time",formType:"time",isNull:1,dateValueFormat:"yyyy-MM-dd HH:mm:ss",name:"委托时间"},{field:"remarks",formType:"textarea",isNull:0,name:"备注"}],fieldsRules:{},expireTimeOption:{disabledDate:function(e){var t=(new Date).getTime(),a=new Date(t);return a.setHours(0,0,0,0),e.getTime()<a.getTime()}}}},computed:{title:function(){return this.data?"编辑委托":"新建委托"}},watch:{},created:function(){if(this.data){var e=this.data,t=e.delegateUserId,a=e.trusteeUserId,i=e.labels,l=e.startTime,n=e.endTime,s=e.remarks;this.fieldsForm={delegateUserId:t,trusteeUserId:a,labels:i.split(","),time:[l,n],remarks:s}}else this.fieldsForm={delegateUserId:"",trusteeUserId:"",labels:"",time:[],remarks:""};this.initRules(),this.debouncedSaveField=Object(g["debounce"])(300,this.saveClick)},mounted:function(){},beforeDestroy:function(){},methods:{initRules:function(){var e=this,t={};this.fields.forEach((function(a){t[a.field]=e.getRules(a)})),this.fieldsRules=t},close:function(){this.$emit("close")},formChange:function(e,t,a){},saveClick:function(){var e=this;this.$refs.wkBaseFrom.instance.validate((function(t){if(t){var a=Object(v["z"])(e.fieldsForm);e.loading=!0;var i=Object(n["a"])(Object(n["a"])({},a),{},{labels:a.labels.join(),startTime:a.time[0],endTime:a.time[1],state:1});Object(w["c"])(e.data)||(i.delegateId=e.data.delegateId);var l=Object(w["c"])(e.data)?o:c;l(i).then((function(t){e.$message.success(Object(w["c"])(e.data)?"保存成功":"编辑成功"),e.loading=!1,e.$emit("success"),e.close()})).catch((function(){e.loading=!1}))}else e.$message.error("请完善基本信息")}))}}},k=y,C=a("2877"),T=Object(C["a"])(k,p,f,!1,null,"4b371f79",null),x=T.exports,S=a("c1df"),_=a.n(S),j=a("2f62"),O={name:"ProcessDelegation",components:{XrHeader:u["a"],ProcessDelegationCreate:x},data:function(){return{loading:!1,tableHeight:document.documentElement.clientHeight-250,status:"",statusOptions:[{label:"全部",value:""},{label:"启用",value:1},{label:"停用",value:0}],list:[],fieldList:[{prop:"delegateUser",label:"委托人",width:150},{prop:"number",label:"委托编号",width:150},{prop:"trusteeUser",label:"受委托人",width:150},{prop:"labels",label:"业务模块",width:150},{prop:"startTime",label:"委托开始时间",width:150},{prop:"endTime",label:"委托结束时间",width:150},{prop:"remarks",label:"备注",width:150},{prop:"state",label:"状态",width:150},{prop:"createUser",label:"创建人",width:150},{prop:"createTime",label:"创建时间",width:150},{prop:"updateTime",label:"最后修改时间",width:150}],currentPage:1,pageSize:10,pageSizes:[10,20,30,40],total:0,editData:null,createViewVisible:!1,labels:{0:"办公审批",1:"合同",2:"回款",3:"发票",4:"薪资",5:"采购审核",6:"采购退货审核",7:"销售审核",8:"销售退货审核",9:"付款单审核",10:"回款单审核",11:"盘点审核",12:"调拨审核",20:"阶段审批"}}},computed:Object(n["a"])(Object(n["a"])({},Object(j["b"])(["manage"])),{},{addAuth:function(){return this.manage.delegate&&this.manage.delegate.addDelegate},editAuth:function(){return this.manage.delegate&&this.manage.delegate.updateDelegate},changeStateAuth:function(){return this.manage.delegate&&this.manage.delegate.updateState},commissionTime:function(){return function(e){var t=_()(new Date);return 1==e.state&&_()(e.startTime).isBefore(t)}}}),mounted:function(){var e=this;window.onresize=function(){e.tableHeight=document.documentElement.clientHeight-250},this.getList()},methods:{handleSizeChange:function(e){this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.currentPage=e,this.getList()},refreshList:function(){this.handleCurrentChange(1)},getList:function(){var e=this;this.loading=!0,r({state:this.status,page:this.currentPage,limit:this.pageSize}).then((function(t){e.list=t.data.list,e.total=t.data.totalRow,e.loading=!1})).catch((function(){e.loading=!1}))},fieldFormatter:function(e,t){var a=this;if("labels"===t.property){var i=e[t.property].split(",");return i.map((function(e){return a.labels[e]})).join()}return"state"===t.property?1==e[t.property]?"启用":"停用":e[t.property]||"--"},addClick:function(){this.editData=null,this.createViewVisible=!0},handleClick:function(e,t){var a=this;"edit"===e?(this.editData=t.row,this.createViewVisible=!0):"state"===e&&this.$confirm("您确定要".concat(0===t.row.state?"启用":"停用","该流程委托?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d({delegateId:t.row.delegateId,state:0===t.row.state?1:0}).then((function(e){a.$message({type:"success",message:"操作成功"}),a.getList()})).catch((function(){}))})).catch((function(){}))}}},F=O,D=(a("7322"),Object(C["a"])(F,i,l,!1,null,"14f5cbf3",null));t["default"]=D.exports}}]);