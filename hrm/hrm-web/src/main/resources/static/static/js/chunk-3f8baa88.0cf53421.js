(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f8baa88"],{"05d0":function(e,t,i){"use strict";i("cd44")},"33ca":function(e,t,i){"use strict";i("a734")},4378:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("flexbox",{staticClass:"wk-backgroud-tabs",staticStyle:{width:"auto"},attrs:{justify:"space-between",align:"center"}},[i("flexbox",{staticStyle:{"z-index":"1",width:"auto"},attrs:{align:"center"}},[e._t("left")],2),e._v(" "),i("div",{staticClass:"wk-tabs__wrap"},[i("div",{staticClass:"wk-tabs"},e._l(e.options,(function(t,a){return i("div",{key:a,staticClass:"wk-tabs__item",class:{active:t.value===e.value},on:{click:function(i){e.tabsClick(t,a)}}},[e._v("\n        "+e._s(t.label)),t.helpType?i("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":t.helpType,"data-id":t.helpId},on:{click:function(e){e.stopPropagation()}}}):e._e()])})))]),e._v(" "),i("flexbox",{staticStyle:{"z-index":"1",width:"auto"},attrs:{align:"center"}},[e._t("right")],2)],1)},n=[],l=(i("a9e3"),{name:"WkBackgroudTabs",components:{},props:{value:[String,Number],options:Array},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{tabsClick:function(e,t){this.$emit("input",e.value),this.$emit("tab-click",e,t)}}}),s=l,o=(i("a548"),i("2877")),r=Object(o["a"])(s,a,n,!1,null,"8ec15ab4",null);t["a"]=r.exports},6166:function(e,t,i){"use strict";i("b293")},"77a6":function(e,t,i){"use strict";i("9a4c")},"9a4c":function(e,t,i){},a548:function(e,t,i){"use strict";i("c5f1")},a734:function(e,t,i){},b293:function(e,t,i){},c5f1:function(e,t,i){},cd44:function(e,t,i){},d97a:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"main"},[i("xr-header",{attrs:{label:"业务审批流"}},[i("el-button",{attrs:{slot:"ft",type:"primary"},on:{click:e.addExamine},slot:"ft"},[e._v("新建审批流程")])],1),e._v(" "),i("div",{staticClass:"main-body"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-table",class:e.WKConfig.tableStyle.class,staticStyle:{width:"100%"},attrs:{id:"examine-table",data:e.list,stripe:e.WKConfig.tableStyle.stripe,height:e.tableHeight,"highlight-current-row":""}},[i("el-table-column",{attrs:{width:"100",label:"审批流图标"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"table-icon"},[i("i",{class:e.getLableIcon(t.row.label)})])]}}])}),e._v(" "),e._l(e.fieldList,(function(t,a){return i("el-table-column",{key:a,attrs:{formatter:e.fieldFormatter,prop:t.prop,"min-width":t.width,label:t.label,"show-overflow-tooltip":""}})})),e._v(" "),i("el-table-column",{attrs:{fixed:"right",label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{staticStyle:{padding:"0"},attrs:{type:"primary-text"},on:{click:function(i){e.handleClick("edit",t)}}},[e._v("编辑")]),e._v(" "),i("el-button",{staticStyle:{padding:"0"},attrs:{type:"primary-text"},on:{click:function(i){e.handleClick("delete",t)}}},[e._v("删除")]),e._v(" "),i("el-button",{staticStyle:{padding:"0"},attrs:{type:"primary-text"},on:{click:function(i){e.handleClick("change",t)}}},[e._v(e._s(2===t.row["status"]?"启用":"停用"))]),e._v(" "),i("el-button",{staticStyle:{padding:"0"},attrs:{type:"primary-text"},on:{click:function(i){e.handleClick("copy",t)}}},[e._v("复制并新建")])]}}])})],2),e._v(" "),i("div",{staticClass:"p-contianer"},[i("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,background:"",layout:"prev, pager, next, sizes, total, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),e.createShow?i("business-approve-flow-create",{ref:"create",attrs:{"moduel-type":e.currentRouteName,detail:e.rowDetail,"is-copy":e.isCopyCreate,"label-list":e.labelList},on:{success:e.getList,close:function(t){e.createShow=!1}}}):e._e()],1)},n=[],l=(i("b0c0"),i("7db0"),i("d3b7"),i("a15b"),i("d81d"),i("a434"),i("ffce")),s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"opacity-fade"}},[i("div",{staticClass:"business-approve-flow-create"},[i("wk-backgroud-tabs",{attrs:{options:e.tabs},model:{value:e.tabIndex,callback:function(t){e.tabIndex=t},expression:"tabIndex"}},[i("template",{slot:"right"},[i("el-button",{attrs:{type:"primary"},on:{click:e.sendClick}},[e._v("发布")]),e._v(" "),i("i",{staticClass:"el-icon-close create-close",on:{click:e.closeClick}})],1)],2),e._v(" "),i("base-info-set",{directives:[{name:"show",rawName:"v-show",value:"base"===e.tabIndex,expression:"tabIndex === 'base'"}],ref:"baseInfoSet",attrs:{examine:!0,fields:e.fields,"fields-form":e.fieldsForm,"fields-rules":e.fieldsRules,"advanced-props":e.advancedProps},on:{change:e.formChange}}),e._v(" "),i("wk-approve-flow",{directives:[{name:"show",rawName:"v-show",value:"flow"===e.tabIndex,expression:"tabIndex === 'flow'"}],ref:"wkApproveFlow",attrs:{props:e.approveFlowConfig,list:e.flowList,"send-node":e.sendNode}})],1)])},o=[],r=i("5530"),d=(i("159b"),i("4de4"),i("14d9"),i("ea20")),c=i("bcbc"),u=i("4378"),m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-card",{staticClass:"base-info-set",attrs:{loading:e.loading,"body-style":{height:"100%",overflow:"auto"}}},[i("div",{staticClass:"base-info-set__header"},[e._v("\n    配置基础信息\n  ")]),e._v(" "),i("create-sections",{attrs:{title:"基础信息"}},[i("wk-form",{ref:"wkBaseFrom",attrs:{model:e.fieldsForm,rules:e.fieldsRules,"field-from":e.fieldsForm,"field-list":e.fields,"label-position":"top"},on:{change:e.formChange},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data,n=t.index;return[a&&"userDep"==a.formType?i("wk-user-dep-dialog-select",{staticStyle:{width:"100%"},attrs:{"user-value":e.fieldsForm.userList,"dep-value":e.fieldsForm.deptList,"sub-dept-contain":e.fieldsForm.isNeedChild,props:{showSubDeptContain:!0,showDisableUser:!1}},on:{"update:userValue":function(t){e.$set(e.fieldsForm,"userList",t)},"update:depValue":function(t){e.$set(e.fieldsForm,"deptList",t)},"update:subDeptContain":function(t){e.$set(e.fieldsForm,"isNeedChild",t)},change:function(t){e.userDepSelectChange(arguments,a,n)}}}):[e._t("default",null,{data:a})]]}}])})],1),e._v(" "),e.examine?i("create-sections",{attrs:{title:"高级设置"}},[i("AdvancedSetting",{ref:"advancedSetting",attrs:{"is-stage-flow":e.isStageFlow,props:e.advancedProps},model:{value:e.fieldsForm.advancedConfigBO,callback:function(t){e.$set(e.fieldsForm,"advancedConfigBO",t)},expression:"fieldsForm.advancedConfigBO"}})],1):e._e()],1)},f=[],p=i("10ff"),h=i("5067"),v=i("b592"),b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ad-set"},[i("el-form",{ref:"advancedSettingFrom",attrs:{model:e.advancedLimitTimeBO}},e._l(e.fieldList,(function(t){return i("div",{key:t.name,staticClass:"ad-set-item"},[i("div",{staticClass:"set-name-wrap"},[i("div",{staticClass:"set-name"},[e._v(e._s(t.name))]),e._v(" "),"nodeLimit"==t.field?i("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:e.nodeLimitChange},model:{value:e.form.limitTimeStatus,callback:function(t){e.$set(e.form,"limitTimeStatus",t)},expression:"form.limitTimeStatus"}}):e._e()],1),e._v(" "),t.explain?i("div",{staticClass:"set-explain"},[e._v(e._s(t.explain))]):e._e(),e._v(" "),"radio"!=t.type||"nodeLimit"==t.field&&!e.form.limitTimeStatus?e._e():i("el-radio-group",{on:{change:function(i){e.radioChange(i,t.field)}},model:{value:e.form[t.field],callback:function(i){e.$set(e.form,t.field,i)},expression:"form[item.field]"}},[e._l(t.forms,(function(t){return i("el-radio",{key:t.value,attrs:{label:t.value}},[e._v("\n          "+e._s(t.label)+"\n        ")])})),e._v(" "),"nodeLimit"==t.field?i("el-form-item",{attrs:{prop:"limitTime",rules:{required:!0,message:"节点时间不能为空",trigger:"blur"}}},[i("div",[i("div",[i("span",[e._v("流程到达该节点超过")]),e._v(" "),i("div",{staticStyle:{display:"inline-block",width:"200px"}},[i("el-input",{attrs:{placeholder:"请输入内容"},on:{input:e.timeChange},model:{value:e.advancedLimitTimeBO.limitTime,callback:function(t){e.$set(e.advancedLimitTimeBO,"limitTime",t)},expression:"advancedLimitTimeBO.limitTime"}},[i("el-select",{style:{width:"90px"},attrs:{slot:"append"},on:{change:e.timeTypeChange},slot:"append",model:{value:e.advancedLimitTimeBO.limitTimeUnit,callback:function(t){e.$set(e.advancedLimitTimeBO,"limitTimeUnit",t)},expression:"advancedLimitTimeBO.limitTimeUnit"}},[i("el-option",{attrs:{label:"分钟",value:"minute"}}),e._v(" "),i("el-option",{attrs:{label:"小时",value:"hour"}}),e._v(" "),i("el-option",{attrs:{label:"天",value:"day"}})],1)],1)],1),e._v(" "),i("span",[e._v("处理人未处理时"+e._s(3==e.form.nodeLimit?",自动同意":""))])]),e._v(" "),1==e.form.nodeLimit?i("span",{staticStyle:{"font-weight":"bold"}},[e._v("自动提醒被提醒人")]):e._e(),e._v(" "),2==e.form.nodeLimit?i("span",{staticStyle:{"font-weight":"bold"}},[e._v("自动转交")]):e._e()])]):e._e(),e._v(" "),"nodeHandleType"==t.field&&2==e.form.nodeHandleType||"nodeLimit"==t.field&&[1,2].includes(e.form.nodeLimit)?i("div",{staticStyle:{"margin-top":"10px"}},[i("el-button",{attrs:{type:"primary"},on:{click:function(i){e.addUserHandler(t.field)}}},[e._v("添加人员")]),e._v(" "),i("span",[e._v("不能超过20人")]),e._v(" "),i("div",{staticClass:"user-list-wrap"},[1==e.form.nodeLimit&&"nodeLimit"==t.field?i("span",{staticClass:"user-item"},[e._v("当前处理人")]):e._e(),e._v(" "),e._l(e.form.nodeHandleUser,(function(a,n){return"nodeHandleType"==t.field?i("el-tag",{key:n,staticClass:"user-item",attrs:{size:"medium","disable-transitions":"",closable:"",type:"info"},on:{close:function(i){e.userDelete(n,t.field)}}},[e._v("\n              "+e._s(a.realname)+"\n            ")]):e._e()})),e._v(" "),e._l(e.advancedLimitTimeBO.handleUserList,(function(a,n){return"nodeLimit"==t.field?i("el-tag",{key:n,staticClass:"user-item",attrs:{size:"medium","disable-transitions":"",closable:"",type:"info"},on:{close:function(i){e.userDelete(n,t.field)}}},[e._v("\n              "+e._s(a.realname)+"\n            ")]):e._e()}))],2)],1):e._e(),e._v(" "),"nodeLimit"==t.field&&[1,2].includes(e.form.nodeLimit)?i("div",[i("div",{staticStyle:{"margin-top":"10px"}},[i("div",{staticClass:"small-title"},[e._v("指定上级")]),e._v(" "),i("el-select",{attrs:{multiple:""},model:{value:e.advancedLimitTimeBO.nodeHandleParentLevel,callback:function(t){e.$set(e.advancedLimitTimeBO,"nodeHandleParentLevel",t)},expression:"advancedLimitTimeBO.nodeHandleParentLevel"}},e._l(e.sendLevelOption,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),i("div",{staticStyle:{"margin-top":"10px"}},[i("div",{staticClass:"small-title"},[e._v("指定角色")]),e._v(" "),i("role-employee-select",{ref:"roleSelect",refInFor:!0,attrs:{multiple:"",props:{onlyShowRole:!0},clearable:""},model:{value:e.advancedLimitTimeBO.nodeHandleRole,callback:function(t){e.$set(e.advancedLimitTimeBO,"nodeHandleRole",t)},expression:"advancedLimitTimeBO.nodeHandleRole"}})],1),e._v(" "),2===e.form.nodeLimit?i("div",{staticStyle:{"margin-top":"10px"}},[i("div",{staticClass:"small-title"},[e._v("转交给多人时采用的审批方式")]),e._v(" "),i("el-radio-group",{model:{value:e.advancedLimitTimeBO.examineType,callback:function(t){e.$set(e.advancedLimitTimeBO,"examineType",t)},expression:"advancedLimitTimeBO.examineType"}},e._l(e.examineType,(function(t,a){return i("el-radio",{key:a,attrs:{label:t.value}},[e._v("\n                "+e._s(t.label)+"\n              ")])})))],1):e._e()]):e._e()],2),e._v(" "),"checkbox"==t.type?i("el-checkbox-group",{class:t.class,model:{value:e.form[t.field],callback:function(i){e.$set(e.form,t.field,i)},expression:"form[item.field]"}},e._l(t.forms,(function(t){return i("el-checkbox",{key:t.value,attrs:{label:t.value}},[e._v("\n          "+e._s(t.label)+"\n        ")])}))):e._e()],1)}))),e._v(" "),e.userDialogVisible?i("wk-dep-user-dialog",{attrs:{"user-value":e.userDialogValue,visible:e.userDialogVisible,props:{showDisableUser:!1,showDept:!1}},on:{"update:visible":function(t){e.userDialogVisible=t},change:e.selectUserChange}}):e._e()],1)},y=[],g=i("b85c"),w=(i("4d90"),i("25f0"),i("b64b"),i("caad"),i("2532"),i("a9e3"),i("2581")),T=i("94d4"),x=i("ed08"),L=i("da92"),k=i("8ed6"),_={privilegeOnlyTermination:!1},C={name:"AdvancedSetting",components:{WkDepUserDialog:w["a"],RoleEmployeeSelect:T["a"]},props:{value:{type:Object,default:function(){}},isStageFlow:{type:Boolean,default:!1},props:{type:Object,default:function(){}}},data:function(){return{cpValue:Object(x["z"])(this.value),examineType:[{label:"依次审批",value:1},{label:"会签（需所有转交人同意）",value:2},{label:"或签（一名转交人同意或拒绝即可）",value:3}],advancedLimitTimeBO:{},form:{},userDialogVisible:!1,selectedUserList:[],currentAddType:"",sendLevelOption:[]}},computed:{config:function(){return Object(k["a"])(Object(r["a"])({},_),this.props||{})},fieldList:function(){var e=[{field:"nodeHandleType",name:"异常处理",explain:"审批节点内成员离职,为空等情况的处理方式",type:"radio",forms:[{type:"radio",label:"自动同意",value:1},{type:"radio",label:"转交给指定人员处理",value:2}]},{field:"repeatHandleType",name:"审批人重复",explain:"当同一个审批人重复审批同一单据时",type:"radio",forms:[{type:"radio",label:"仅首个节点需审批，其余自动同意",value:1},{type:"radio",label:"仅连续审批时自动同意",value:2},{type:"radio",label:"每个节点都需要审批",value:3}]},{field:"rejectHandleType",name:"审批被拒后重新提交/审批",explain:"",type:"radio",forms:[{type:"radio",label:"从拒绝时指定节点依次处理",value:2}]}],t=[{type:"checkbox",label:"终止",value:1}];this.config.privilegeOnlyTermination||t.push({type:"checkbox",label:"作废",value:2},{type:"checkbox",label:"归档",value:3});var i=[{field:"modifyPermissionType",name:"修改权限",explain:"",type:"checkbox",forms:[{type:"checkbox",label:"提交申请时，员工不可修改固定审批人和审批节点",value:1},{type:"checkbox",label:"提交申请时，员工不可修改固定抄送人和抄送节点",value:2}]},{field:"isTransferable",name:"转交权限",explain:"",type:"checkbox",forms:[{type:"checkbox",label:"允许员工将流程转交给他人处理",value:1}]},{field:"isConsult",name:"征求他人意见权限",explain:"",type:"checkbox",forms:[{type:"checkbox",label:"允许员工征求他人意见权限",value:1}]},{field:"isRejectChooseFlow",name:"拒绝时驳回到任一节点权限（如果不允许，则拒绝时默认驳回到发起人）",explain:"",type:"checkbox",forms:[{type:"checkbox",label:"允许员工拒绝时选择驳回到哪一节点",value:1}]},{field:"isCreateUserWithdraw",name:"发起人撤回权限",explain:"",type:"checkbox",forms:[{type:"checkbox",label:"允许发起人撤回审批",value:1}]},{field:"nodeLimit",name:"节点限时处理",explain:"",type:"radio",forms:[{type:"radio",label:"自动提醒",value:1},{type:"radio",label:"自动转交",value:2},{type:"radio",label:"自动同意",value:3}]},{field:"privilege",name:"发起人及审核人操作权限",explain:"",type:"checkbox",class:"is-flex",forms:t}];return this.isStageFlow?e.push.apply(e,[{field:"isTransferable",name:"转交权限",explain:"",type:"checkbox",forms:[{type:"checkbox",label:"允许员工将流程转交给他人处理",value:1}]},{field:"isConsult",name:"征求他人意见权限",explain:"",type:"checkbox",forms:[{type:"checkbox",label:"允许员工征求他人意见权限",value:1}]},{field:"isRejectChooseFlow",name:"拒绝时驳回到任一节点权限（如果不允许，则拒绝时默认驳回到发起人）",explain:"",type:"checkbox",forms:[{type:"checkbox",label:"允许员工拒绝时选择驳回到哪一节点",value:1}]},{field:"isCreateUserWithdraw",name:"发起人撤回权限",explain:"",type:"checkbox",forms:[{type:"checkbox",label:"允许发起人撤回审批",value:1}]}]):e.push.apply(e,i),e},userDialogValue:function(){return(this.selectedUserList||[]).map((function(e){return e.userId}))}},watch:{form:{handler:function(){this.emitEvent()},deep:!0},advancedLimitTimeBO:{handler:function(){this.emitEvent()},deep:!0}},created:function(){for(var e=this.cpValue,t=e.nodeHandleType,i=void 0===t?1:t,a=e.repeatHandleType,n=void 0===a?3:a,l=e.rejectHandleType,s=void 0===l?2:l,o=e.limitTimeStatus,r=void 0===o?0:o,d=e.modifyPermissionType,c=void 0===d?[]:d,u=e.nodeHandleUser,m=void 0===u?[]:u,f=e.advancedLimitTimeVO,p=void 0===f?{}:f,h=e.isTransferable,v=void 0!==h&&h,b=e.isConsult,y=void 0!==b&&b,w=e.isRejectChooseFlow,T=void 0!==w&&w,x=e.isCreateUserWithdraw,L=void 0!==x&&x,k=e.privilege,_=isNaN(k)?"000":k.toString(2).padStart(3,"0"),C=[],S=0;S<_.length;S++)"1"==_[S]&&C.push(S+1);if(this.form={nodeHandleType:i,repeatHandleType:n,rejectHandleType:s,limitTimeStatus:r,nodeLimit:(null===p||void 0===p?void 0:p.handleType)||3,modifyPermissionType:c||[],nodeHandleUser:m||[],isTransferable:"boolean"===typeof v&&v,isConsult:"boolean"===typeof y&&y,isRejectChooseFlow:"boolean"===typeof T&&T,isCreateUserWithdraw:"boolean"===typeof L&&L,privilege:C},2!=this.form.rejectHandleType&&(this.form.rejectHandleType=2),p&&Object.keys(p).length){var O,F=p.handleType,B=p.examineType,$=p.limitTimeUnit,H=void 0===$?"minute":$,j=p.limitTime,U=p.handleUserList,I=[],E=[],R=[],N=Object(g["a"])(U);try{for(N.s();!(O=N.n()).done;){var P=O.value,D=P.type,z=P.dataList;0===D?I=z:1===D?E=z.map((function(e){return e.parentLevel})):2===D&&(R=z.map((function(e){return e.roleId})))}}catch(V){N.e(V)}finally{N.f()}this.advancedLimitTimeBO={nodeHandleParentLevel:E,nodeHandleRole:R,handleType:F,examineType:B,limitTimeUnit:H,limitTime:j,handleUserList:I}}this.getSuperLevel()},methods:{getSuperLevel:function(){for(var e=1;e<=20;e++){var t="第".concat(e,"级上级");1===e?this.sendLevelOption.push({label:"直属上级",value:e}):this.sendLevelOption.push({label:t,value:e})}},nodeLimitChange:function(e){e&&(this.form.nodeLimit=3,this.advancedLimitTimeBO.handleType=3,this.$set(this.advancedLimitTimeBO,"examineType",1),this.$set(this.advancedLimitTimeBO,"limitTimeUnit","minute"))},selectUserChange:function(e,t,i){i.length>0?"nodeHandleType"==this.currentAddType?this.form["nodeHandleUser"]=i:"nodeLimit"==this.currentAddType&&this.$set(this.advancedLimitTimeBO,"handleUserList",i):this.selectedUserList=[]},userDelete:function(e,t){"nodeHandleType"==t?this.form.nodeHandleUser.splice(e,1):"nodeLimit"==t&&this.advancedLimitTimeBO.handleUserList.splice(e,1),this.$forceUpdate()},addUserHandler:function(e){this.currentAddType=e,"nodeHandleType"==e?this.selectedUserList=this.form.nodeHandleUser:"nodeLimit"==e&&(this.selectedUserList=this.advancedLimitTimeBO.handleUserList),this.userDialogVisible=!0},radioChange:function(e,t){2==e&&this.$set(this.advancedLimitTimeBO,"examineType",1),"nodeLimit"==t&&this.$set(this.advancedLimitTimeBO,"handleType",e)},emitEvent:function(){var e,t,i,a=Object(x["z"])(this.form),n=Object(x["z"])(this.advancedLimitTimeBO);this.isStageFlow||(a.nodeHandleUser=null===(i=a.nodeHandleUser)||void 0===i?void 0:i.map((function(e){return e.userId})));if(n.handleUserList=null===(e=n.handleUserList)||void 0===e?void 0:e.map((function(e){return e.userId})),a.advancedLimitTimeBO=n,(null===(t=this.form.privilege)||void 0===t?void 0:t.length)>0){for(var l="",s=0;s<=3;s++)this.form.privilege.includes(s)?l+="1":l+="0";a.privilege=parseInt(l,2)}else a.privilege=0;delete a.nodeLimit,this.$emit("input",a)},timeChange:function(e){var t=this.advancedLimitTimeBO.limitTimeUnit;isNaN(e)||e.includes(".")?this.$set(this.advancedLimitTimeBO,"limitTime",0):"minute"==t&&e>L["a"].times(60,24,30)?this.$set(this.advancedLimitTimeBO,"limitTime",L["a"].times(60,24,30)):"hour"==t&&e>L["a"].times(24,30)?this.$set(this.advancedLimitTimeBO,"limitTime",L["a"].times(24,30)):"day"==t&&e>30&&this.$set(this.advancedLimitTimeBO,"limitTime",30)},timeTypeChange:function(e){var t=Number(this.advancedLimitTimeBO.limitTime);"minute"==e&&t>L["a"].times(60,24,30)?this.$set(this.advancedLimitTimeBO,"limitTime",L["a"].times(60,24,30)):"hour"==e&&t>L["a"].times(24,30)?this.$set(this.advancedLimitTimeBO,"limitTime",L["a"].times(24,30)):"day"==e&&t>30&&this.$set(this.advancedLimitTimeBO,"limitTime",30)}}},S=C,O=(i("77a6"),i("2877")),F=Object(O["a"])(S,b,y,!1,null,"617423a2",null),B=F.exports,$={name:"BaseInfoSet",components:{CreateSections:p["a"],WkForm:h["a"],WkUserDepDialogSelect:v["a"],AdvancedSetting:B},props:{advancedProps:Object,fields:Array,fieldsForm:Object,fieldsRules:Object,examine:{type:Boolean,default:!1},isStageFlow:{type:Boolean,default:!1}},data:function(){return{loading:!1}},computed:{form:function(){return this.$refs.wkBaseFrom.instance}},mounted:function(){},methods:{validate:function(){var e=this;return new Promise((function(t){e.form.validate((function(i){i||e.$message.error("请完善基本信息"),t(i)}))}))},formChange:function(e,t,i){this.$emit("change",e,t,i)},userDepSelectChange:function(e,t,i){var a=e[2],n=e[3];this.$emit("change",t,i,{userList:a,deptList:n})},hidenView:function(){this.$emit("hiden-view")}}},H=$,j=(i("6166"),Object(O["a"])(H,m,f,!1,null,"80ec9072",null)),U=j.exports,I=i("43b6"),E=i("0730"),R=i("3817"),N={name:"BusinessApproveFlowCreate",components:{WkBackgroudTabs:u["a"],BaseInfoSet:U,WkApproveFlow:I["a"]},filters:{},mixins:[E["a"],R["a"]],props:{moduelType:String,isCopy:{type:Boolean,default:!1},labelList:Array,detail:Object},data:function(){return{height:document.documentElement.clientHeight-100,tabs:[{label:"1.配置基础信息",value:"base"},{label:"2.配置流程",value:"flow"}],tabIndex:"base",sendNode:{name:"发起人",content:"具有新建权限的员工"},fields:[],fieldsForm:{},fieldsRules:{},flowList:[],conditionFields:null,invoiceTypeList:[]}},computed:{advancedProps:function(){return{privilegeOnlyTermination:"hrmExamine"===this.moduelType}},approveFlowConfig:function(){var e=this,t={conditionSelectRequest:l["n"],conditionSelectParams:{label:this.fieldsForm.label},conditionSelectList:null,nodeFieldSetShow:!0,nodeFieldSetRequestFun:null};if(!this.moduelType)return t;if("customerExamine"===this.moduelType){var i=this.fieldsForm.label,a={1:6,2:7,3:18},n=a[i];t.nodeFieldItemParamsFun=function(e){e.label=n,"detail_table"===e.formType&&e.fieldExtendList&&e.fieldExtendList.forEach((function(e){e.label=n}))},t.nodeFieldSetRequestFun=function(){return new Promise((function(t,i){Object(c["b"])(n).then((function(i){var a=i.data;if(18==n){var l=a.find((function(e){return"contract_money"===e.fieldName||"contractMoney"===e.fieldName}));l&&e.$set(l,"hideEdit",!0)}t(a)})).catch((function(){i([])}))}))}}else if("jxcExamine"===this.moduelType){var s=this.fieldsForm.label;t.nodeFieldItemParamsFun=function(e){e.label=s,"detail_table"===e.formType&&e.fieldExtendList&&e.fieldExtendList.forEach((function(e){e.label=s}))},t.nodeFieldSetRequestFun=function(){return new Promise((function(e,t){var i={5:3,6:4,7:5,8:6,9:9,10:10,11:11,12:12}[s];Object(c["e"])(i).then((function(t){e(t.data)})).catch((function(){t([])}))}))}}else"hrmExamine"===this.moduelType&&(t.nodeFieldSetShow=!1,t.examineTypeFilterFun=function(e){return e.filter((function(e){return 8!==e.value}))});return t},examineId:function(){return this.detail?this.detail.examineId:null}},created:function(){this.detail&&3===this.detail.label&&this.getInvoiceTypeList(),this.getBaseField(),this.examineId?this.getFlowList(this.examineId):this.flowList=[Object(x["z"])(I["b"])]},mounted:function(){var e=this;this.$el.style.zIndex=Object(x["p"])(),document.body.appendChild(this.$el),window.onresize=function(){e.height=document.documentElement.clientHeight-100}},destroyed:function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},methods:{getInvoiceTypeList:function(){var e=this;Object(d["g"])().then((function(t){e.invoiceTypeList=t.data||[]}))},getFlowList:function(e){var t=this;Object(l["l"])({examineId:e}).then((function(e){var i=e.data||[],a=[];t.getListInfo(i,a),t.flowList=a})).catch((function(){}))},validateSetting:function(e){this.requestConditionFields().then((function(t){var i=t.find((function(t){return t.fieldName===e.fieldName}));e.setting=i?i.setting:[]}))},requestConditionFields:function(){var e=this,t=this.approveFlowConfig,i=t.conditionSelectRequest,a=t.conditionSelectParams,n=t.conditionSelectList;return n?Promise.resolve(n):this.conditionFields?Promise.resolve(this.conditionFields):new Promise((function(t,n){i(a).then((function(i){var a=i.data||[];e.conditionFields=a,t(a)})).catch((function(){t([])}))}))},getBaseField:function(){var e=[];e.push({field:"examineName",formType:"text",isNull:1,name:"审批流名称",setting:[],inputTips:"",value:this.detail?this.detail.examineName:""}),e.push({field:"label",formType:"select",isNull:0,name:"关联对象",setting:this.labelList,value:this.detail?this.detail.label:this.labelList&&this.labelList.length>0?this.labelList[0].value:""}),e.push({field:"managerList",formType:"user",name:"流程管理员",setting:[],radio:!1,value:this.detail?this.detail.managerList:1}),e.push({field:"remarks",formType:"textarea",isNull:0,name:"流程说明",maxlength:200,setting:[],placeholder:"（请填写相关注意事项，方便员工在申请时查阅，限制输入200字）",value:this.detail?this.detail.remarks:""}),this.handleFields(e)},handleFields:function(e){var t=this,i={},a={};e.forEach((function(e){"userDep"===e.formType?(a.userList=[],a.deptList=[]):(i[e.field]=t.getRules(e),a[e.field]=e.value)})),a.advancedConfigBO=this.detail&&this.detail.advancedConfigVO||{},this.fields=Object(x["z"])(e),this.fieldsForm=a,this.fieldsRules=i,this.getUserFieldList(this.fieldsForm.label)},formChange:function(e,t,i){3===i&&0===this.invoiceTypeList.length&&this.getInvoiceTypeList(),"label"===e.field&&(this.flowList=[Object(x["z"])(I["b"])],this.getUserFieldList(this.fieldsForm.label))},sendClick:function(){var e=this,t=this.$refs.baseInfoSet,i=t.$refs.advancedSetting.$refs.advancedSettingFrom;this.$refs.baseInfoSet.validate().then((function(t){i.validate((function(i){if(t&&i){var a=e.$refs.wkApproveFlow.getParams();if(a.isError)e.$message.error("请完善信息");else{var n,l,s,o,d,c,u,m=Object(r["a"])(Object(r["a"])({},e.fieldsForm),{},{dataList:a.list}),f=m.advancedConfigBO,p=m.advancedConfigBO.advancedLimitTimeBO,h=f.limitTimeStatus;if(!(2!=f.nodeHandleType||null!==(n=f.nodeHandleUser)&&void 0!==n&&n.length)||!(2!=p.handleType||null!==(l=p.handleUserList)&&void 0!==l&&l.length||null!==(s=p.nodeHandleParentLevel)&&void 0!==s&&s.length||null!==(o=p.nodeHandleRole)&&void 0!==o&&o.length)&&h)return void e.$message.error("配置基础信息中的添加人员不可为空");if(2==f.nodeHandleType&&(null===(d=f.nodeHandleUser)||void 0===d?void 0:d.length)>20||1==p.handleType&&(null===(c=p.handleUserList)||void 0===c?void 0:c.length)>20&&h||2==p.handleType&&(null===(u=p.handleUserList)||void 0===u?void 0:u.length)>20&&h)return void e.$message.error("人员不能超过20人");e.examineId&&!e.isCopy&&(m.examineId=e.examineId),e.submiteRequest(m)}}else e.$message.error("请完善信息")}))}))},submiteRequest:function(e){var t=this;Object(l["i"])(e).then((function(e){t.$message.success("创建成功"),t.$emit("success"),t.closeClick()})).catch((function(){}))},closeClick:function(){this.$emit("close")}}},P=N,D=(i("05d0"),Object(O["a"])(P,s,o,!1,null,"7e99dc2c",null)),z=D.exports,V=i("f468"),A={name:"SystemExamine",components:{XrHeader:V["a"],BusinessApproveFlowCreate:z},mixins:[],data:function(){return{loading:!1,tableHeight:document.documentElement.clientHeight-220,list:[],fieldList:[{prop:"examineName",label:"审批流名称",width:150},{prop:"label",label:"关联对象",width:150},{prop:"advancedConfigVO",label:"审批被拒后重新提交/审批",width:150},{prop:"updateUserName",label:"最后修改人",width:150},{prop:"updateTime",label:"最后修改时间",width:150},{prop:"status",label:"状态",width:100}],currentPage:1,pageSize:20,pageSizes:[10,20,30,40],currentRoute:null,total:0,rowDetail:null,isCopyCreate:!1,createShow:!1}},computed:{currentRouteName:function(){return this.currentRoute?this.currentRoute.name:""},labelList:function(){return this.currentRouteName&&{customerExamine:[{name:"合同",value:1},{name:"回款",value:2},{name:"发票",value:3}],hrmExamine:[{name:"薪资",value:4}],jxcExamine:[{name:"采购审批",value:5},{name:"采购退货审批",value:6},{name:"销售审批",value:7},{name:"销售退货审批",value:8},{name:"付款审批",value:9},{name:"回款审批",value:10},{name:"盘点审批",value:11},{name:"调拨审批",value:12}]}[this.currentRouteName]||[]}},watch:{"$route.name":{handler:function(){this.currentRoute=this.$route,this.getList()},immediate:!0}},mounted:function(){var e=this;window.onresize=function(){e.tableHeight=document.documentElement.clientHeight-220}},methods:{getList:function(){var e=this;this.loading=!0,Object(l["o"])({label:{customerExamine:1,hrmExamine:5,jxcExamine:6}[this.currentRouteName],page:this.currentPage,limit:this.pageSize}).then((function(t){e.list=t.data.list,e.total=t.data.totalRow,e.loading=!1})).catch((function(){e.loading=!1}))},fieldFormatter:function(e,t){if("label"===t.property){var i=this.labelList.find((function(t){return t.value===e.label}));return i?i.name:"--"}if("userList"===t.property){var a=e["deptList"]||[],n=a.map((function(e){return e.name})).join("、"),l=e["userList"]||[],s=l.map((function(e){return e.realname})).join("、");n&&s&&(n+="、");var o=n+s;return o||"全公司"}return"status"===t.property?2===e[t.property]?"停用":"启用":"advancedConfigVO"===t.property?{2:"从拒绝时指定节点依次处理"}[e[t.property].rejectHandleType]:e[t.property]},addExamine:function(){this.isCopyCreate=!1,this.rowDetail=null,this.createShow=!0},handleSizeChange:function(e){this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.currentPage=e,this.getList()},handleClick:function(e,t){var i=this;"edit"===e?(this.isCopyCreate=!1,this.rowDetail=t.row,this.createShow=!0):"delete"===e?this.$confirm("您确定要删除该审批流?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(l["p"])({examineId:t.row["examineId"],status:3}).then((function(e){i.list.splice(t.$index,1),0===i.list.length&&(i.currentPage=i.currentPage-1>0?i.currentPage-1:1),i.getList(),i.$message({type:"success",message:"操作成功"})})).catch((function(){}))})).catch((function(){})):"change"===e?this.$confirm("您确定要"+(2===t.row["status"]?"启用":"停用")+"该审批流?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(l["p"])({examineId:t.row["examineId"],status:2===t.row["status"]?1:2}).then((function(e){i.$message({type:"success",message:"操作成功"}),i.getList()})).catch((function(){}))})).catch((function(){})):"copy"===e&&(this.isCopyCreate=!0,this.rowDetail=t.row,this.createShow=!0)},getLableIcon:function(e){return{1:"wk wk-contract",2:"wk wk-receivables",3:"wk wk-invoice",4:"wk wk-icon-pay-solid",5:"wk wk-icon-shop-cart",6:"wk wk-drafts",7:"wk wk-record",8:"wk wk-approval-13",9:"wk wk-icon-category-note",10:"wk wk-l-record",11:"wk wk-icon-search-note",12:"wk wk-approval-11"}[e]}}},W=A,q=(i("33ca"),Object(O["a"])(W,a,n,!1,null,"604ecc9a",null));t["default"]=q.exports}}]);