(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-47648fd1"],{"0828":function(e,t,a){},"0942":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var i=a("b775");function s(e){return Object(i["a"])({url:"hrmActionRecord/queryRecordList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}},"0af2":function(e,t,a){},"0fe0":function(e,t,a){"use strict";a("ff8d")},"11a7":function(e,t,a){},1539:function(e,t,a){"use strict";a("6fc6")},2602:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"performance-index",attrs:{id:"employee-main-container"}},[a("xr-header",{attrs:{"ft-top":"0",label:"考核计划"}},[a("template",{slot:"ft"},[e.createAuth?a("el-button",{staticStyle:{"margin-right":"8px"},attrs:{type:"primary"},on:{click:e.createClick}},[e._v("新建KPI计划")]):e._e()],1)],2),e._v(" "),a("div",{staticClass:"main-body"},[a("div",{directives:[{name:"empty",rawName:"v-empty",value:!e.viewListAuth,expression:"!viewListAuth"}],staticClass:"main-list",attrs:{"xs-empty-icon":"nopermission","xs-empty-text":"暂无权限"}},[a("div",{staticClass:"main-list__body"},[a("wk-table-header",{attrs:{search:e.search,props:e.wkHeaderProps,"filter-header-props":e.wkHeaderProps.filterHeaderProps},on:{"update:search":function(t){e.search=t},"event-change":e.tableHeaderHandle},scopedSlots:e._u([{key:"custom",fn:function(t){return[a("div",{staticClass:"custom-scene"},[a("span",{staticClass:"label"},[e._v("显示：")]),e._v(" "),e._l(e.sceneOptions,(function(t,i){return a("el-button",{key:i,attrs:{title:t.label,type:t.value===e.activeTab?"selected":null,icon:t.icon},on:{click:function(a){e.tabsClick(t)}}},[e._v("\n                "+e._s(t.label)+"\n                "),t.num&&"0"!=t.num?a("span",{staticClass:"values-span",class:{selected:t.value===e.activeTab}},[e._v("\n                  "+e._s(t.num)+"\n                ")]):e._e()])}))],2)]}}])}),e._v(" "),a("el-table",{staticClass:"n-table--border el-table-header--white",staticStyle:{width:"100%","margin-top":"15px"},attrs:{id:"crm-table","row-height":50,data:e.list,height:e.tableHeight,"cell-class-name":e.cellClassName,"use-virtual":"",stripe:"","highlight-current-row":""},on:{"row-click":e.handleRowClick}},[e._l(e.fieldList,(function(t,i){return a("el-table-column",{key:i,attrs:{fixed:0==i,prop:t.field,label:t.name,"min-width":t.width,formatter:e.tableFieldFormatter,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(i){var s=i.row,l=i.column;return["appraisalCycle"==t.field?a("span",[e._v(e._s(s.quarter?s.appraisalCycle+s.quarter:s.appraisalCycle))]):"appraisalCycleType"==t.field?a("span",[e._v(e._s(e.appraisalCycleType[s[l.property]]))]):a("span",[e._v(" "+e._s(s[l.property]?s[l.property]:"--"))])]}}])})})),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[4==e.activeTab?a("div",[e.querySettingAuth?a("el-button",{attrs:{type:"text"},on:{click:function(t){e.handleTypeClick("check",i)}}},[e._v("\n                  查看考核设置\n                ")]):e._e(),e._v(" "),e.delOfFileAuth?a("el-button",{attrs:{type:"text"},on:{click:function(t){e.handleDelClick(i)}}},[e._v("\n                  删除\n                ")]):e._e()],1):a("el-dropdown",{attrs:{trigger:"click"},on:{command:function(t){e.handleTypeClick(t,i)}}},[a("i",{staticClass:"el-icon-more table-more"}),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.getRowDropdownItems(i),(function(t,i){return a("el-dropdown-item",{key:i,attrs:{command:t.command}},[e._v(e._s(t.label))])})))],1)]}}])})],2)],1),e._v(" "),a("div",{staticClass:"p-contianer"},[a("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])]),e._v(" "),e.isCreate?a("kpi-assessment-plan-create",{attrs:{"inspection-detial":e.inspectionDetial},on:{close:function(t){e.isCreate=!1},createSuccess:e.refreshList}}):e._e(),e._v(" "),a("employees-view",{attrs:{id:e.employeesViewData.appraisalId,visible:e.employeesViewShow,status:e.employeesViewData.status},on:{"update:visible":function(t){e.employeesViewShow=t}}}),e._v(" "),e.showDview?a("not-started-detail",{attrs:{id:e.rowID,detail:e.rowData},on:{handle:e.detailHandle,close:function(t){e.showDview=!1},success:e.refreshList}}):e._e(),e._v(" "),e.showOngoingDview?a("ongoing-detail",{attrs:{id:e.rowOngoingId,detail:e.rowOngoingData,"is-result":e.isResult,"query-employee-appraisal-auth":e.queryEmployeeAppraisalAuth},on:{handle:e.detailHandle,close:function(t){e.showOngoingDview=!1},success:e.refreshList}}):e._e()],1)},s=[],l=a("5530"),n=(a("d3b7"),a("159b"),a("ac1f"),a("841c"),a("14d9"),a("3c65"),a("99af"),a("fb6a"),a("a15b"),a("caad"),a("7195")),r=a("5d2e"),o=a("f468"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,title:"详情",top:"10vh",width:"80%"},on:{close:e.handleCancel}},[a("div",{staticClass:"filter-div"},[e.hasFilterContent?a("el-button",{attrs:{type:"text"},on:{click:e.resetFilter}},[e._v("清除筛选")]):e._e(),e._v(" "),a("wk-popover-filter",{staticStyle:{"margin-right":"5px"},attrs:{"field-from":e.filterObj,"field-list":e.filterList,"has-content":e.hasFilterContent,width:"80%",placement:"bottom"},on:{"update:fieldFrom":function(t){e.filterObj=t},sure:e.refreshList,reset:e.resetFilter}})],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"n-table--border el-table-header--white",staticStyle:{width:"100%"},attrs:{id:"crm-table","row-height":40,data:e.list,height:e.tableHeight,"use-virtual":"",stripe:"","highlight-current-row":""},on:{"row-click":e.handleRowClick}},[a("el-table-column",{attrs:{prop:"index",label:"序号",width:"80","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.$index+1)+"\n      ")]}}])}),e._v(" "),e._l(e.fieldList,(function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.fieldName,label:t.name,"min-width":t.width,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return["employeeName"===t.column.property?[a("span",{staticClass:"can-visit--underline"},[e._v(e._s(e.fieldFormatter(t.row,t.column)))]),1==t.row.isDel?a("span",{staticStyle:{color:"#6b778c"}},[e._v("（已删除）")]):e._e()]:[e._v("\n          "+e._s(e.fieldFormatter(t.row,t.column))+"\n        ")]]}}])})}))],2),e._v(" "),a("div",{staticClass:"p-contianer"},[a("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),e.detailShow?a("employee-confirm-performance",{attrs:{id:e.rowId,"handle-type":"evaluato-view"},on:{close:function(t){e.detailShow=!1}}}):e._e()],1)},u=[],d=(a("a9e3"),a("b64b"),a("f48e")),p=a("0f4c"),m=a("9011"),f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"opacity-fade"}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"eep",style:{"z-index":e.zIndex}},[e.form?i("el-card",{staticClass:"eep-con"},[i("div",{staticClass:"eep-header"},[e._v("\n        "+e._s(e.title)+"\n        "),i("div",{staticClass:"eep-header__ft"},["confirm"==e.handleType?[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.debouncedSubmitConfirmClick(!1)}}},[e._v("同意")]),e._v(" "),e.nextList&&e.nextList.length>1&&e.nextIndex<e.nextList.length-1?i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.debouncedSubmitConfirmClick(!0)}}},[e._v("同意并确认下一个")]):e._e(),e._v(" "),i("el-button",{on:{click:e.rejectClick}},[e._v("驳回目标")])]:"evaluato"==e.handleType?[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.debouncedSubmitEvaluatoClick(!1)}}},[e._v("提交")]),e._v(" "),e.nextList&&e.nextList.length>1&&e.nextIndex<e.nextList.length-1?i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.debouncedSubmitEvaluatoClick(!0)}}},[e._v("提交并确认下一个")]):e._e(),e._v(" "),i("el-button",{on:{click:function(t){e.rejectClick("target")}}},[e._v("驳回目标")]),e._v(" "),e.rejectShow?i("el-button",{on:{click:function(t){e.rejectClick("evaluato")}}},[e._v("驳回评定")]):e._e()]:e._e(),e._v(" "),i("el-button",{on:{click:e.closeClick}},[e._v("关闭")])],2)]),e._v(" "),i("div",{staticClass:"eep-body"},[i("el-form",{ref:"form",staticClass:"eep-left",attrs:{model:e.form,"validate-on-rule-change":!1,"hide-required-asterisk":""}},[i("reminder",{staticClass:"xr-reminder",attrs:{content:e.form.description}}),e._v(" "),e.detailAuth?i("div",{staticClass:"employee"},[i("div",{staticClass:"employee__label"},[e._v("\n              考核人\n            ")]),e._v(" "),i("div",{staticClass:"employee__name"},[e._v("\n              "+e._s(e.detailData.employeeName)+"\n            ")]),e._v(" "),i("flexbox",{staticClass:"employee__detail"},[i("div",{staticClass:"employee-section"},[i("flexbox",{staticStyle:{"margin-bottom":"15px"},attrs:{align:"stretch"}},[i("flexbox-item",{staticClass:"employee-item"},[i("div",{staticClass:"employee-item__label"},[e._v("目标确认人")]),e._v(" "),i("div",{staticClass:"employee-item__value"},[e._v(e._s(e.getEmployeeNames(e.detailData.confirmorsList)))])]),e._v(" "),i("flexbox-item",{staticClass:"employee-item"},[i("div",{staticClass:"employee-item__label"},[e._v("结果评定人")]),e._v(" "),i("div",{staticClass:"employee-item__value"},[e._v(e._s(e.getEmployeeNames(e.detailData.evaluatorsList)))])])],1),e._v(" "),i("div",{staticClass:"employee-item"},[i("div",{staticClass:"employee-item__label"},[e._v("结果确认人")]),e._v(" "),i("div",{staticClass:"employee-item__value"},[e._v(e._s(e.getEmployeeNames(e.detailData.resultConfirmors)))])])],1),e._v(" "),i("wk-circle-tag",{attrs:{label:e.getEmployeeLabelName(),des:6==e.detailData.status?e.detailData.score+"分":"",bold:6==e.detailData.status}}),e._v(" "),4===e.detailData.appraisalStatus?i("img",{staticClass:"employee-icon",attrs:{width:"120px",src:a("5815")}}):5===e.detailData.status?i("img",{staticClass:"employee-icon",attrs:{width:"120px",src:a("f962")}}):e._e()],1)],1):e._e(),e._v(" "),e._l(e.form.fixedSegList,(function(t,a){return i("div",{key:"fix-"+a,staticClass:"content-section"},[i("div",{staticClass:"section__handle"},[e.editScheduleShow?i("el-button",{attrs:{disabled:!e.canEditSchedule,type:"text"},on:{click:function(i){e.itemHandleClick("schedule","fixed",t,a)}}},[e._v("\n                "+e._s(null!==t.schedule&&""!==t.schedule||!e.canEditSchedule?"进度"+(t.schedule||0)+"%":"添加进度"))]):e._e(),e._v(" "),i("el-button",{attrs:{type:"text",disabled:""}},[e._v("\n                "+e._s("权重"+(t.weight||0)+"%")+"\n              ")])],1),e._v(" "),i("div",{staticClass:"item-section"},[i("div",{staticClass:"el-row"},[e._v("\n                "+e._s(t.segName)+"\n              ")]),e._v(" "),i("div",e._l(t.items,(function(t,a){return i("div",{key:a,staticClass:"el-row",staticStyle:{"padding-left":"140px"}},[i("div",{staticClass:"sub-input-value"},[e._v(e._s(t.itemName))])])}))),e._v(" "),i("div",[e.evaluatoWriteShow?i("el-row",{staticClass:"write-score",attrs:{type:"flex"}},[i("el-col",{staticClass:"write-score-item",attrs:{span:8}},[i("flexbox",[i("div",{staticClass:"label"},[e._v("评分")]),e._v(" "),i("el-form-item",{attrs:{prop:"fixedSegList["+a+"].score",rules:e.getScoreRules(),label:""}},[i("el-input",{directives:[{name:"wk-number",rawName:"v-wk-number"}],attrs:{type:"text"},on:{blur:e.scoreInputBlur},model:{value:t.score,callback:function(a){e.$set(t,"score",a)},expression:"item.score"}})],1)],1)],1),e._v(" "),i("el-col",{staticClass:"write-score-item",attrs:{span:16}},[i("flexbox",[i("div",{staticClass:"label"},[e._v("评语")]),e._v(" "),i("el-form-item",{attrs:{label:""}},[i("el-input",{attrs:{placeholder:"请填写评语",type:"text"},model:{value:t.evaluate,callback:function(a){e.$set(t,"evaluate",a)},expression:"item.evaluate"}})],1)],1)],1)],1):e._e(),e._v(" "),e._l(t.evaluatoSegList,(function(t,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.status,expression:"evaluato.status !== 0"}],key:a,staticClass:"history-score"},[i("el-row",{staticClass:"history-score-item",attrs:{type:"flex"}},[i("el-col",{attrs:{span:8}},[i("span",{staticClass:"label"},[e._v("评分：")]),e._v(" "),i("span",{staticClass:"laebl-value"},[e._v(e._s(t.score))])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("span",{staticClass:"label"},[e._v("评定人：")]),e._v(" "),i("span",{staticClass:"laebl-value"},[e._v(e._s(t.employeeName))])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("span",{staticClass:"label"},[e._v("时间：")]),e._v(" "),i("span",{staticClass:"laebl-value"},[e._v(e._s(e.getYMDTime(t.createTime)))])])],1),e._v(" "),i("flexbox",{staticClass:"history-score-item"},[i("div",{staticClass:"label"},[e._v("评语：")]),e._v(" "),i("div",{staticClass:"laebl-value"},[e._v(e._s(t.evaluate))])])],1)}))],2)])])})),e._v(" "),e._l(e.form.noFixedSegList,(function(t,a){return i("div",{key:a,staticClass:"section"},[i("div",{staticClass:"section__handle"},[e.editScheduleShow?i("el-button",{attrs:{disabled:!e.canEditSchedule,type:"text"},on:{click:function(i){e.itemHandleClick("schedule","noFixed",t,a)}}},[e._v("\n                "+e._s(null!==t.schedule&&""!==t.schedule||!e.canEditSchedule?"进度"+t.schedule+"%":"添加进度"))]):e._e(),e._v(" "),i("el-button",{attrs:{type:"text",disabled:""}},[e._v("\n                "+e._s("权重"+(t.weight||0)+"%")+"\n              ")])],1),e._v(" "),i("div",{staticClass:"item-section is-no-fix"},[i("el-row",{staticClass:"item-row",attrs:{type:"flex"}},[i("el-col",{attrs:{span:23}},[i("flexbox",{attrs:{align:"stretch"}},[i("el-tooltip",{attrs:{content:t.segName,placement:"top"}},[i("div",{staticClass:"div-label"},[e._v(e._s(t.segName))])]),e._v(" "),i("div",{staticClass:"div-body"},[e._v(e._s(t.value))])],1)],1),e._v(" "),i("el-col",{staticClass:"is-close",attrs:{span:1}})],1),e._v(" "),i("div",e._l(t.items,(function(t,s){return i("el-row",{key:a+"-"+s,staticClass:"item-row",attrs:{type:"flex"}},[i("el-col",{attrs:{span:23}},[i("flexbox",{attrs:{align:"stretch"}},[i("div",{staticClass:"sub-input sub-label"},[e._v(e._s(t.itemName))]),e._v(" "),i("div",{staticClass:"sub-label-content div-body"},[e._v(e._s(t.value))])])],1),e._v(" "),i("el-col",{staticClass:"is-close",attrs:{span:1}})],1)}))),e._v(" "),i("div",[e.evaluatoWriteShow?i("el-row",{staticClass:"write-score",attrs:{type:"flex"}},[i("el-col",{staticClass:"write-score-item",attrs:{span:8}},[i("flexbox",[i("div",{staticClass:"label"},[e._v("评分")]),e._v(" "),i("el-form-item",{attrs:{prop:"noFixedSegList["+a+"].score",rules:e.getScoreRules(),label:""}},[i("el-input",{directives:[{name:"wk-number",rawName:"v-wk-number"}],attrs:{type:"text"},on:{blur:e.scoreInputBlur},model:{value:t.score,callback:function(a){e.$set(t,"score",a)},expression:"item.score"}})],1)],1)],1),e._v(" "),i("el-col",{staticClass:"write-score-item",attrs:{span:16}},[i("flexbox",[i("div",{staticClass:"label"},[e._v("评语")]),e._v(" "),i("el-form-item",{attrs:{label:""}},[i("el-input",{attrs:{placeholder:"请填写评语",type:"text"},model:{value:t.evaluate,callback:function(a){e.$set(t,"evaluate",a)},expression:"item.evaluate"}})],1)],1)],1)],1):e._e(),e._v(" "),e._l(t.evaluatoSegList,(function(t,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.status,expression:"evaluato.status !== 0"}],key:a,staticClass:"history-score"},[i("el-row",{staticClass:"history-score-item",attrs:{type:"flex"}},[i("el-col",{attrs:{span:8}},[i("span",{staticClass:"label"},[e._v("评分：")]),e._v(" "),i("span",{staticClass:"laebl-value"},[e._v(e._s(t.score))])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("span",{staticClass:"label"},[e._v("评定人：")]),e._v(" "),i("span",{staticClass:"laebl-value"},[e._v(e._s(t.employeeName))])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("span",{staticClass:"label"},[e._v("时间：")]),e._v(" "),i("span",{staticClass:"laebl-value"},[e._v(e._s(e.getYMDTime(t.createTime)))])])],1),e._v(" "),i("flexbox",{staticClass:"history-score-item"},[i("div",{staticClass:"label"},[e._v("评语：")]),e._v(" "),i("div",{staticClass:"laebl-value"},[e._v(e._s(t.evaluate))])])],1)}))],2)],1)])})),e._v(" "),e.evaluatoResultShow||e.evaluatoWriteShow?i("div",{staticClass:"result"},[i("div",{staticClass:"result__label"},[e._v("评价结果")]),e._v(" "),e.evaluatoWriteShow?i("div",{staticClass:"result__body"},[i("flexbox",[i("flexbox",{staticStyle:{flex:"1"}},[i("div",{staticClass:"label"},[e._v("综合评分")]),e._v(" "),i("el-form-item",{attrs:{rules:e.getScoreRules(),prop:"score",label:""}},[i("el-input",{directives:[{name:"wk-number",rawName:"v-wk-number"}],attrs:{type:"text"},on:{input:e.debouncedQueryLevelByScore},model:{value:e.form.score,callback:function(t){e.$set(e.form,"score",t)},expression:"form.score"}})],1)],1),e._v(" "),i("flexbox",{staticStyle:{flex:"1","margin-left":"50px"}},[i("div",{staticClass:"label"},[e._v("等级")]),e._v(" "),i("el-form-item",{attrs:{rules:{required:!0,message:"请选择",trigger:"change"},prop:"levelId",label:""}},[i("el-select",{model:{value:e.form.levelId,callback:function(t){e.$set(e.form,"levelId",t)},expression:"form.levelId"}},e._l(e.levelOptions,(function(e){return i("el-option",{key:e.levelId,attrs:{label:e.levelName,value:e.levelId}})})))],1)],1)],1),e._v(" "),i("flexbox",[i("div",{staticClass:"label"},[e._v("综合评语")]),e._v(" "),i("el-form-item",{attrs:{prop:"evaluate",label:""}},[i("el-input",{attrs:{autosize:{minRows:3},maxlength:800,placeholder:"您可以从如下角度进行综合自评：1、阶段时间内的主要成绩 2、阶段时间内的不足之处 3、下一阶段得从哪些方面努力",type:"textarea",resize:"none"},model:{value:e.form.evaluate,callback:function(t){e.$set(e.form,"evaluate",t)},expression:"form.evaluate"}})],1)],1)],1):e._e(),e._v(" "),e._l(e.form.evaluatoResultList,(function(t,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.status,expression:"evaluato.status !== 0"}],key:a,staticClass:"history-score"},[i("div",{staticClass:"history-score__title"},[e._v(e._s(t.employeeName+"的评价结果"))]),e._v(" "),i("el-row",{staticClass:"history-score-item",attrs:{type:"flex"}},[i("el-col",{attrs:{span:8}},[i("span",{staticClass:"label"},[e._v("综合评分：")]),e._v(" "),i("span",{staticClass:"laebl-value"},[e._v(e._s(t.score))])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("span",{staticClass:"label"},[e._v("等级：")]),e._v(" "),i("span",{staticClass:"laebl-value"},[e._v(e._s(t.levelName))])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("span",{staticClass:"label"},[e._v("时间：")]),e._v(" "),i("span",{staticClass:"laebl-value"},[e._v(e._s(e.getYMDTime(t.createTime)))])])],1),e._v(" "),i("flexbox",{staticClass:"history-score-item"},[i("div",{staticClass:"label"},[e._v("评语：")]),e._v(" "),i("div",{staticClass:"laebl-value"},[e._v(e._s(t.evaluate))])])],1)}))],2):e._e()],2),e._v(" "),i("div",{staticClass:"eep-right"},[i("div",{staticClass:"epp-right__header"},[e._v("\n            考核记录\n          ")]),e._v(" "),i("performance-history",{ref:"performanceHistory",staticClass:"epp-right__body",attrs:{id:e.id}})],1)],1)]):e._e(),e._v(" "),i("reject-dialog",{attrs:{id:e.id,"handle-type":e.rejectData.type,des:e.rejectData.des,visible:e.rejectDialogShow},on:{"update:visible":function(t){e.rejectDialogShow=t},change:e.rejectChange}}),e._v(" "),i("schedule-edit-dialog",{attrs:{id:e.dialogEditData.item?e.dialogEditData.item.segId:"",visible:e.scheduleEditShow},on:{"update:visible":function(t){e.scheduleEditShow=t},change:e.scheduleChange}})],1)])},h=[],v=(a("4de4"),a("a4d3"),a("e01a"),a("7db0"),a("d81d"),a("d9e2"),a("b680"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"rc-cont"},e._l(e.list,(function(t,i){return a("flexbox",{key:i,staticClass:"ha-cont",attrs:{align:"stretch",justify:"flex-start"}},[a("div",{staticClass:"ha-week"},[a("div",[e._v(e._s(e.getYMDFormaterTime(t.createTime)))]),e._v(" "),a("div",[e._v(e._s(e.getWeekFormaterTime(t.createTime)))])]),e._v(" "),a("div",{staticClass:"ha-circle"}),e._v(" "),a("div",{staticClass:"ha-time"},[e._v(e._s(e.getTimeFormaterTime(t.createTime)))]),e._v(" "),a("div",{staticClass:"ha-name"},[e._v(e._s(t.realname))]),e._v(" "),a("div",{staticClass:"ha-content"},e._l(t.content,(function(t,i){return a("p",{key:i},[e._v(e._s(t))])}))),e._v(" "),a("div",{staticClass:"ha-line"})])})))}),g=[],b=a("0942"),y=a("ed08"),_={name:"PerformanceHistory",components:{},props:{id:[String,Number]},data:function(){return{loading:!1,list:[]}},computed:{},watch:{id:function(e){this.list=[],this.getDetail()}},mounted:function(){this.getDetail()},activated:function(){},deactivated:function(){},methods:{getDetail:function(){var e=this;this.loading=!0,Object(b["a"])({type:4,typeId:this.id}).then((function(t){e.loading=!1;var a=t.data||[];a.forEach((function(e){e.content=e.content?JSON.parse(e.content):[]})),e.list=a})).catch((function(){e.loading=!1}))},getYMDFormaterTime:function(e){return Object(y["E"])(e)},getWeekFormaterTime:function(e){return Object(y["E"])(e,"dddd")},getTimeFormaterTime:function(e){return Object(y["E"])(e,"H:mm")}}},w=_,S=(a("adcc"),a("2877")),C=Object(S["a"])(w,v,g,!1,null,"8bf0a130",null),x=C.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{ref:"wkDialog",attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,title:"编辑进度",width:"500px"},on:{close:e.handleCancel}},[a("div",{staticClass:"form-add-dialog-body"},[a("el-form",{ref:"scheduleForm",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"进度"}},[a("el-slider",{model:{value:e.form.schedule,callback:function(t){e.$set(e.form,"schedule",t)},expression:"form.schedule"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"explainDesc",label:"完成情况"}},[a("el-input",{attrs:{autosize:{minRows:3},maxlength:800,type:"textarea",resize:"none"},model:{value:e.form.explainDesc,callback:function(t){e.$set(e.form,"explainDesc",t)},expression:"form.explainDesc"}})],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("保存")]),e._v(" "),a("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("取消")])],1)])},T=[],O=a("9dba"),L={name:"ScheduleEditDialog",components:{},mixins:[O["a"]],props:{id:[String,Number],visible:{type:Boolean,required:!0,default:!1}},data:function(){return{loading:!1,form:{}}},computed:{},watch:{visible:{handler:function(e){e&&(this.form={schedule:0})},immediate:!0}},mounted:function(){},methods:{handleCancel:function(){this.$emit("update:visible",!1)},handleConfirm:function(){var e=this;this.loading=!0,this.form.segId=this.id,Object(d["h"])(this.form).then((function(t){e.$message.success("操作成功"),e.$emit("change",e.form.schedule),e.handleCancel(),e.loading=!1})).catch((function(){e.loading=!1}))}}},F=L,N=(a("e414"),Object(S["a"])(F,k,T,!1,null,"ace5a12c",null)),I=N.exports,D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{ref:"wkDialog",attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,title:e.title,width:"500px"},on:{close:e.handleCancel}},[a("div",{staticClass:"form-add-dialog-body"},[e.des?a("div",{staticClass:"form-des"},[e._v(e._s(e.des))]):e._e(),e._v(" "),a("el-form",{ref:"rejectForm",attrs:{rules:e.rules,model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"rejectReason",label:"驳回原因"}},[a("el-input",{attrs:{autosize:{minRows:3},maxlength:800,type:"textarea",resize:"none"},model:{value:e.form.rejectReason,callback:function(t){e.$set(e.form,"rejectReason",t)},expression:"form.rejectReason"}})],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("保存")]),e._v(" "),a("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("取消")])],1)])},j=[],$={name:"RejectDialog",components:{},mixins:[O["a"]],props:{handleType:String,id:[String,Number],des:String,visible:{type:Boolean,required:!0,default:!1}},data:function(){return{loading:!1,form:{},rules:{rejectReason:[{required:!0,message:"请输入",trigger:"blur"}]}}},computed:{title:function(){return"evaluato"==this.handleType?"驳回评定":"驳回目标"}},watch:{visible:{handler:function(e){e&&(this.form={rejectReason:""})},immediate:!0}},mounted:function(){},methods:{handleCancel:function(){this.form={rejectReason:""},this.$refs.rejectForm&&this.$refs.rejectForm.clearValidate(),this.$emit("update:visible",!1)},handleConfirm:function(){var e=this;this.$refs.rejectForm.validate((function(t){if(t){e.loading=!0;var a=d["g"],i={employeeAppraisalId:e.id,rejectReason:e.form.rejectReason};"target"==e.handleType||"evaluato"==e.handleType?(a=d["f"],i.status={target:2,evaluato:3}[e.handleType]):i.status=2,a(i).then((function(t){e.$message.success("操作成功"),e.$emit("change"),e.handleCancel(),e.loading=!1})).catch((function(){e.loading=!1}))}}))}}},P=$,E=(a("f3df"),Object(S["a"])(P,D,j,!1,null,"72135454",null)),A=E.exports,B=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wk-circle-tag",style:{width:e.width+"px",height:e.width+"px",borderRadius:e.width/2+"px",borderColor:e.bold?"#2362FB":"#CCD4DC"}},[a("flexbox",{staticClass:"wk-circle-tag__content",style:{borderColor:e.bold?"#2362FB":"#CCD4DC"},attrs:{orient:"vertical",align:"center",justify:"center"}},[a("div",{staticClass:"label text-one-line",class:{"is-bold":e.bold},style:{color:e.bold?"#2362FB":"#6B778C",fontSize:e.bold?"16px":"12px"}},[e._v(e._s(e.label))]),e._v(" "),e.des?a("div",{staticClass:"des text-one-line"},[e._v(e._s(e.des))]):e._e()])],1)},R=[],q=a("7a1a"),V="FitText",H=function(){var e=this[V],t=e.el,a=e.option,i=a.fontSize;t.style.fontSize=i+"px";var s=t.scrollWidth;while(t.scrollWidth>t.clientWidth){if(s=t.scrollWidth,i-=.2,t.style.fontSize=i+"px",s<=t.clientWidth){t.style.overflowX="visible";break}if(i<=12){t.style.overflowX="hidden",t.style.overflowY="hidden",t.style.textOverflow="ellipsis";break}}},z={name:"FitText",bind:function(e,t,a){var i=t.value||{fontSize:14},s=Object(q["debounce"])(300,H.bind(e));e[V]={el:e,option:i,debouncedResize:s},window.addEventListener("resize",s)},inserted:function(e,t,a){var i=e[V].debouncedResize;i()},update:function(e,t,a){var i=e[V].debouncedResize;i()},unbind:function(e){var t=e[V].debouncedResize;window.removeEventListener("resize",t)}},U={name:"WkCircleTag",directives:{FitText:z},components:{},props:{width:{type:[String,Number],default:90},bold:{type:Boolean,default:!0},label:[String,Number],des:[String,Number]},data:function(){return{}},computed:{},watch:{},mounted:function(){},beforeDestroy:function(){},methods:{}},W=U,M=(a("f35d"),Object(S["a"])(W,B,R,!1,null,"3e658047",null)),Y=M.exports,Q=a("8f37"),J={1:"目标待填写",2:"目标待确认",3:"结果待评定",4:"结果待确认",5:"考核终止",6:"考核完成"};function K(e){var t=Object.keys(e);return t.map((function(t){return{label:e[t],value:parseInt(t)}}))}var X={statusValue:J,getValueList:K},G=a("2f62"),Z={name:"EmployeeConfirmPerformance",components:{PerformanceHistory:x,ScheduleEditDialog:I,RejectDialog:A,Reminder:Q["a"],WkCircleTag:Y},props:{nextList:Array,nextIndex:Number,handleType:String,id:[String,Number]},data:function(){return{loading:!1,zIndex:Object(y["p"])(),detailData:null,form:null,rejectData:{type:"",des:""},rejectDialogShow:!1,scheduleEditShow:!1,dialogEditData:{},levelOptions:[]}},computed:Object(l["a"])(Object(l["a"])({},Object(G["b"])(["hrm"])),{},{detailAuth:function(){return this.appraisalAuth&&this.appraisalAuth.read||this.detailData&&(4===this.detailData.appraisalStatus||5===this.detailData.status)},title:function(){return"绩效目标"},evaluatoWriteShow:function(){return"evaluato"==this.handleType&&!this.isDisableHandle},isDisableHandle:function(){return 4===this.detailData.appraisalStatus||5===this.detailData.status},evaluatoResultShow:function(){return!!this.detailData&&((3==this.detailData.status||4==this.detailData.status||6==this.detailData.status||5==this.detailData.status)&&this.detailData.evaluatoResultList&&this.detailData.evaluatoResultList.length>0)},editScheduleShow:function(){return this.detailData&&1!=this.detailData.status&&2!=this.detailData.status},finalResultShow:function(){return this.detailData&&6==this.detailData.status},canEditSchedule:function(){return"schedule"==this.handleType&&this.detailData&&3==this.detailData.status&&(1==this.detailData.appraisalStatus||2==this.detailData.appraisalStatus)},rejectShow:function(){if(this.detailData&&this.detailData.evaluatoResultList&&this.detailData.evaluatoResultList.length>0){var e=this.detailData.evaluatoResultList.filter((function(e){return 1===e.status}));return e.length>0}return!1}}),watch:{id:{handler:function(e){e&&(this.detailData=null,this.form=null,this.getDetail())},immediate:!0}},mounted:function(){this.debouncedQueryLevelByScore=Object(q["debounce"])(500,this.queryLevelByScore),this.debouncedSubmitConfirmClick=Object(q["debounce"])(300,this.submitConfirmClick),this.debouncedSubmitEvaluatoClick=Object(q["debounce"])(300,this.submitEvaluatoClick)},methods:{getDetail:function(){var e=this;"evaluato"==this.handleType&&this.getLevelList(),this.loading=!0,Object(d["b"])(this.id).then((function(t){var a=t.data||{};e.detailData=Object(y["z"])(a);var i={},s=a.tableTemp;i.description=s.description,i.isEmpWeight=s.isEmpWeight;var l=a.fixedSegList||[];l.forEach((function(e){var t=e.evaluatoSegList.find((function(e){return 0===e.status}));t&&(e.score=t.score,e.evaluate=t.evaluate)})),i.fixedSegList=l;var n=a.noFixedSegList||[];n.forEach((function(e){var t=e.evaluatoSegList.find((function(e){return 0===e.status}));t&&(e.score=t.score,e.evaluate=t.evaluate)})),i.noFixedSegList=n||[];var r=a.evaluatoResultList||[],o=r.find((function(e){return 0===e.status}));o&&(i.score=o.score,i.levelId=o.levelId,i.evaluate=o.evaluate),i.evaluatoResultList=r,e.form=i,e.loading=!1})).catch((function(){e.loading=!1,e.closeClick()}))},getLevelList:function(){var e=this;Object(d["d"])(this.id).then((function(t){e.levelOptions=t.data||[]})).catch((function(){}))},itemHandleClick:function(e,t,a,i){this.dialogEditData={type:e,dataType:t,item:a,index:i},this.scheduleEditShow=!0},scheduleChange:function(e){"schedule"==this.dialogEditData.type&&(this.dialogEditData.item.schedule=e,this.$refs.performanceHistory.getDetail())},submitConfirmClick:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$confirm("您确定同意该员工的考核目标吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,Object(d["g"])({employeeAppraisalId:e.id,status:1}).then((function(a){t?e.nextIndex+1<=e.nextList.length-1?(e.$emit("nextChange",e.nextIndex+1),e.$message.success("操作成功")):(e.$message.success("操作成功，没有更多考核了"),e.closeClick()):(e.$message.success("操作成功"),e.closeClick()),e.loading=!1})).catch((function(){e.loading=!1}))})).catch((function(){}))},rejectClick:function(e){"evaluato"==this.handleType&&(this.rejectData.type=e,"target"==e?this.rejectData.des="":"evaluato"==e&&(this.rejectData.des="您将驳回上一评定人的评定结果，确定驳回吗？")),this.rejectDialogShow=!0},rejectChange:function(){this.closeClick()},submitEvaluatoClick:function(e){var t=this;this.$refs.form.validate((function(a){if(!a)return t.$message.error("请完善信息"),!1;t.loading=!0;var i={employeeAppraisalId:t.id,levelId:t.form.levelId,score:t.form.score,evaluate:t.form.evaluate,status:1},s=t.form.fixedSegList.map((function(e){return{evaluate:e.evaluate,score:e.score,segId:e.segId}})),l=t.form.noFixedSegList.map((function(e){return{evaluate:e.evaluate,score:e.score,segId:e.segId}}));i.resultEvaluatoSegBOList=s.concat(l),Object(d["f"])(i).then((function(a){e?t.nextIndex+1<=t.nextList.length-1?(t.$emit("nextChange",t.nextIndex+1),t.$message.success("操作成功")):(t.$message.success("操作成功，没有更多考核了"),t.closeClick()):(t.$message.success("操作成功"),t.closeClick()),t.loading=!1})).catch((function(){t.loading=!1}))}))},getYMDTime:function(e){return Object(y["E"])(e)},getScoreRules:function(){var e=this,t=function(t,a,i){e.detailData&&(a<0||a>parseInt(e.detailData.fullScore)||null===a||void 0===a||""===a)?i(new Error("范围在0-".concat(e.detailData.fullScore,"之间"))):i()};return{validator:t,trigger:["blur","change"]}},getEmployeeLabelName:function(){return 6==this.detailData.status?this.detailData.levelName:X.statusValue[this.detailData.status]},getEmployeeNames:function(e){return e.map((function(e){return e.employeeName})).join("，")},closeClick:function(){this.$emit("change"),this.$emit("close")},scoreInputBlur:function(){var e=this.form.fixedSegList,t=this.form.noFixedSegList,a=0;e.forEach((function(e){a=Object(y["h"])(a,((e.score||0)*(e.weight||0)/100).toFixed(2))})),t.forEach((function(e){a=Object(y["h"])(a,((e.score||0)*(e.weight||0)/100).toFixed(2))})),this.$set(this.form,"score",a),this.debouncedQueryLevelByScore()},queryLevelByScore:function(){var e=this,t=this.levelOptions.find((function(t){return t.minScore<=e.form.score&&e.form.score<=t.maxScore}));t&&this.$set(this.form,"levelId",t.levelId)}}},ee=Z,te=(a("1539"),Object(S["a"])(ee,f,h,!1,null,"647c2074",null)),ae=te.exports,ie=a("6bfe"),se=a("8b13"),le={name:"EmployeesView",components:{WkPopoverFilter:m["a"],EmployeeConfirmPerformance:ae},mixins:[],props:{status:[String,Number],id:[String,Number],visible:{type:Boolean,required:!0,default:!1}},data:function(){return{loading:!1,filterObj:{},tableHeight:this.getTableHeight(),list:[],fieldList:[{fieldName:"employeeName",name:"姓名",width:130},{fieldName:"mobile",name:"手机号",width:80},{fieldName:"jobNumber",name:"工号",width:80},{fieldName:"deptName",name:"部门",width:80},{fieldName:"employeeStatus",name:"员工状态",width:80},{fieldName:"status",name:"考核状态",width:80},{fieldName:"followUpEmployeeName",name:"跟进人",width:80},{fieldName:"score",name:"评分",width:80},{fieldName:"levelName",name:"考核结果",width:120}],currentPage:1,pageSize:15,pageSizes:[15,30,60,100],total:0,rowId:"",detailShow:!1,levelOptions:[]}},computed:{filterList:function(){return[{name:"姓名",field:"employeeName",formType:"text",setting:[]},{name:"部门",field:"deptId",formType:"structure",props:{dataType:"hrm"},request:p["e"],setting:[]},{name:"等级",field:"levelId",formType:"select",setting:this.levelOptions},{name:"考核状态",field:"status",formType:"select",setting:X.getValueList(X.statusValue)}]},hasFilterContent:function(){if(this.filterObj){for(var e=!1,t=Object.keys(this.filterObj),a=0;a<t.length;a++){var i=t[a];""!=this.filterObj[i]&&this.filterObj[i]!=[]&&null!=this.filterObj[i]&&void 0!=this.filterObj[i]&&(e=!0)}return e}return!1}},watch:{visible:{handler:function(e){e&&(this.filterObj={status:Object(ie["c"])(this.status)||isNaN(this.status)?"":parseInt(this.status)},this.getLevelList(),this.refreshList())},immediate:!0}},mounted:function(){},methods:{refreshList:function(){this.handleCurrentChange(1)},resetFilter:function(){this.filterObj={},this.refreshList()},handleSizeChange:function(e){this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.currentPage=e,this.getList()},getList:function(){var e=this;this.loading=!0;var t={page:this.currentPage,limit:this.pageSize,status:this.status,appraisalId:this.id};for(var a in this.filterObj)t[a]=this.filterObj[a];Object(n["A"])(t).then((function(t){e.list=t.data.list,e.total=t.data.totalRow,e.loading=!1})).catch((function(){e.loading=!1}))},getTableHeight:function(){var e=document.documentElement.clientHeight,t=.2*e;return e-t-240},fieldFormatter:function(e,t){if("employeeStatus"==t.property)return se["d"].statusValue[e.employeeStatus]||"--";if("status"==t.property)return X.statusValue[e.status]||"--";var a=e[t.property];return Object(ie["c"])(a)?"--":a},handleRowClick:function(e,t,a){"employeeName"==t.property&&(this.rowId=e.employeeAppraisalId,this.detailShow=!0)},handleCancel:function(){this.detailShow=!1,this.$emit("update:visible",!1)},getLevelList:function(){var e=this;Object(d["c"])(this.id).then((function(t){var a=t.data||[];a.forEach((function(e){e.label=e.levelName,e.value=e.levelId})),e.levelOptions=a})).catch((function(){}))}}},ne=le,re=(a("6535"),Object(S["a"])(ne,c,u,!1,null,"20af0375",null)),oe=re.exports,ce=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"opacity-fade"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"business-approve-flow-create"},[a("wk-backgroud-tabs",{attrs:{options:e.tabs},on:{tabClick:e.tabClick},model:{value:e.tabIndex,callback:function(t){e.tabIndex=t},expression:"tabIndex"}},[a("template",{slot:"right"},[a("el-button",{attrs:{type:"primary",disabled:e.disableStatus},on:{click:e.sendClick}},[e._v("保存")]),e._v(" "),a("i",{staticClass:"el-icon-close create-close",on:{click:e.closeClick}})],1)],2),e._v(" "),a("base-info-set",{directives:[{name:"show",rawName:"v-show",value:"base"===e.tabIndex,expression:"tabIndex === 'base'"}],ref:"baseInfoSet",attrs:{verify:e.verify,status:e.status,"base-form":e.fieldsForm.baseForm,"target-template-name":e.targetTemplateName},on:{pass:e.tabPass}}),e._v(" "),a("indicator-settings",{directives:[{name:"show",rawName:"v-show",value:"target"===e.tabIndex,expression:"tabIndex === 'target'"}],attrs:{"taget-form":e.fieldsForm.appraisalPlanQuotaSettingBO,"template-id":e.fieldsForm.baseForm.appraisalTemplateId,verify:e.verify,status:e.status},on:{pass:e.tabPass}}),e._v(" "),a("workflow-setting",{directives:[{name:"show",rawName:"v-show",value:"flow"===e.tabIndex,expression:"tabIndex === 'flow'"}],attrs:{verify:e.verify,status:e.status,"flow-form":e.fieldsForm.appraisalPlanProcessSettingBO},on:{pass:e.tabPass}}),e._v(" "),a("result-set",{directives:[{name:"show",rawName:"v-show",value:"result"===e.tabIndex,expression:"tabIndex === 'result'"}],attrs:{verify:e.verify,status:e.status,"result-form":e.fieldsForm.appraisalEmployeeResultSettingBO,"result-template-id":e.resultTemplateId},on:{pass:e.tabPass}})],1)])},ue=[],de=(a("a434"),a("2532"),a("25f0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("flexbox",{staticClass:"wk-backgroud-tabs",staticStyle:{width:"auto"},attrs:{justify:"space-between",align:"center"}},[a("flexbox",{staticStyle:{"z-index":"1",width:"auto"},attrs:{align:"center"}},[e._t("left")],2),e._v(" "),a("div",{staticClass:"wk-tabs__wrap"},[a("div",{staticClass:"wk-tabs"},e._l(e.options,(function(t,i){return a("div",{key:i,staticClass:"wk-tabs__item",class:{active:t.value===e.value},on:{click:function(a){e.tabsClick(t,i)}}},[e._v("\n        "+e._s(t.label)),t.helpType?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":t.helpType,"data-id":t.helpId},on:{click:function(e){e.stopPropagation()}}}):e._e()])})))]),e._v(" "),a("flexbox",{staticStyle:{"z-index":"1",width:"auto"},attrs:{align:"center"}},[e._t("right")],2)],1)}),pe=[],me={name:"WkBackgroudTabs",components:{},props:{value:[String,Number],options:Array},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{tabsClick:function(e,t){this.$emit("tabClick",e.value)}}},fe=me,he=(a("e9153"),Object(S["a"])(fe,de,pe,!1,null,"224c4cbc",null)),ve=he.exports,ge=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"base-info-set",staticStyle:{padding:"0 20px",overflow:"auto"},attrs:{"body-style":{height:"100%"}}},[a("el-form",{ref:"baseForm",attrs:{model:e.baseForm,"label-position":"top"}},[a("create-sections",{attrs:{title:"考核范围及考核指标"}}),e._v(" "),a("el-form-item",{attrs:{label:"考核范围",rules:{required:!0}}},[e._l(e.baseForm.inspectionScope,(function(t,i){return a("div",{key:i,staticStyle:{display:"flex","align-items":"center","margin-bottom":"15px"}},[a("el-form-item",{staticStyle:{"margin-right":"10px"},attrs:{prop:"inspectionScope["+i+"].type",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-select",{staticClass:"el-select-active",staticStyle:{width:"180px"},attrs:{disabled:e.disabled},on:{change:function(t){e.inspectionScopeChange(t,i)}},model:{value:t.type,callback:function(a){e.$set(t,"type",a)},expression:"item.type"}},e._l(e.inspectionScopeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})))],1),e._v(" "),2==t.type?a("el-form-item",{staticStyle:{"margin-right":"10px"},attrs:{prop:"inspectionScope["+i+"].employType",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-select",{staticStyle:{width:"180px"},attrs:{disabled:e.disabled?e.disabled:""==t.type},on:{change:function(a){e.hireFormChange(a,i,t)}},model:{value:t.employType,callback:function(a){e.$set(t,"employType",a)},expression:"item.employType"}},e._l(e.hireFormOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,disabled:e.disabled,value:e.value}})})))],1):e._e(),e._v(" "),2==t.type?a("el-form-item",{attrs:{prop:"inspectionScope["+i+"].employeeStatus",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-select",{staticStyle:{width:"180px"},attrs:{disabled:e.disabled?e.disabled:""==t.type,multiple:""},model:{value:t.employeeStatus,callback:function(a){e.$set(t,"employeeStatus",a)},expression:"item.employeeStatus"}},e._l(e.getEmploySubOptions(t),(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1):e._e(),e._v(" "),1==t.type||""==t.type?a("el-form-item",{attrs:{prop:"inspectionScope["+i+"]",rules:e.userDepRules}},[a("wk-user-dep-select",{attrs:{props:{dataType:"hrm",isKpi:!0},disabled:e.disabled?e.disabled:""==t.type,"dep-value":e.baseForm.inspectionScope[i].deptIds,"user-value":e.baseForm.inspectionScope[i].employeeIds},on:{change:function(t){e.selectUserDepChange(arguments,i)}}})],1):e._e(),e._v(" "),e.baseForm.inspectionScope.length>1&&!e.disabled?a("i",{staticClass:"el-icon-error",staticStyle:{"margin-left":"5px",color:"red"},on:{click:function(t){e.deleteItemClick(i)}}}):e._e()],1)})),e._v(" "),a("el-button",{attrs:{type:"text",disabled:3==e.baseForm.inspectionScope.length||e.disabled},on:{click:e.addInspectionScope}},[e._v("+添加")])],2),e._v(" "),a("el-form-item",{attrs:{label:"考核指标模板",prop:"appraisalTemplateId",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("div",{staticStyle:{display:"flex"}},[a("el-button",{attrs:{type:"primary",disabled:e.disabled},on:{click:function(t){e.selectTemplateShow=!0}}},[e._v("选择模板")]),e._v(" "),a("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.selectTemplateName,expression:"selectTemplateName"}],staticClass:"item",attrs:{effect:"dark",content:e.selectTemplateName,placement:"top-start"}},[a("div",{ref:"templateName",staticClass:"template-tag"},[a("span",{staticClass:"template-tag-overflow"},[e._v(e._s(e.selectTemplateName))]),e._v(" "),e.disabled?e._e():a("i",{staticClass:"wk wk-close",on:{click:e.handleClose}})])])],1)]),e._v(" "),a("create-sections",{staticStyle:{"margin-top":"20px"},attrs:{title:"基础信息"}}),e._v(" "),e._l(e.baseOtherFieldList,(function(t,i){return a("el-form-item",{key:i,attrs:{label:t.name,prop:t.fieldName,rules:t.rules},scopedSlots:e._u([{key:"default",fn:function(i){return["appraisalPlanName"==t.fieldName?a("el-input",{staticStyle:{width:"400px"},attrs:{disabled:e.disabled},model:{value:e.baseForm[t.field],callback:function(a){e.$set(e.baseForm,t.field,a)},expression:"baseForm[item.field]"}}):e._e(),e._v(" "),"appraisalCycleType"==t.fieldName?a("el-select",{attrs:{disabled:e.disabled},on:{change:e.appraisalCycleTypeChange},model:{value:e.baseForm[t.field],callback:function(a){e.$set(e.baseForm,t.field,a)},expression:"baseForm[item.field]"}},e._l(t.setting,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):e._e(),e._v(" "),"appraisalCycle"==t.field?a("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"400px"}},[a("el-form-item",{attrs:{prop:"appraisalCycle",rules:{required:!0,message:"请选择",trigger:"change"}}},["appraisalCycle"==t.field?a("el-date-picker",{style:2!=e.baseForm.appraisalCycleType?"width:100%":"width:200px",attrs:{disabled:e.disabled,"value-format":e.datePickerTypeFormat[e.baseForm.appraisalCycleType],type:e.datePickerType[e.baseForm.appraisalCycleType],"range-separator":6==e.baseForm.appraisalCycleType?"至":"","start-placeholder":6==e.baseForm.appraisalCycleType?"开始日期":"","end-placeholder":6==e.baseForm.appraisalCycleType?"结束日期":"",placeholder:"请选择"},model:{value:e.baseForm[t.field],callback:function(a){e.$set(e.baseForm,t.field,a)},expression:"baseForm[item.field]"}}):e._e()],1),e._v(" "),2==e.baseForm.appraisalCycleType?a("el-form-item",{attrs:{prop:"quarter",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-select",{staticStyle:{width:"180px"},attrs:{disabled:e.disabled},model:{value:e.baseForm["quarter"],callback:function(t){e.$set(e.baseForm,"quarter",t)},expression:"baseForm['quarter']"}},e._l([{label:"第一季度",value:"第一季度"},{label:"第二季度",value:"第二季度"},{label:"第三季度",value:"第三季度"},{label:"第四季度",value:"第四季度"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1):e._e()],1):e._e(),e._v(" "),"textarea"==t.formType?a("wk-textarea",{staticStyle:{width:"400px"},attrs:{rows:3,disabled:e.disabled,autosize:{minRows:3},maxlength:"200",resize:"none",type:"textarea"},model:{value:e.baseForm[t.fieldName],callback:function(a){e.$set(e.baseForm,t.fieldName,a)},expression:"baseForm[item.fieldName]"}}):e._e()]}}])})}))],2),e._v(" "),a("select-template-dialog",{directives:[{name:"show",rawName:"v-show",value:e.selectTemplateShow,expression:"selectTemplateShow"}],attrs:{"select-template-show":e.selectTemplateShow,"select-template-name":e.selectTemplateName,status:e.status},on:{select:e.handelSelect,close:function(t){e.selectTemplateShow=!1}}})],1)},be=[],ye=a("10ff"),_e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"选择模板",visible:e.selectTemplateShow,"close-on-click-modal":!1,width:"70%","append-to-body":"","before-close":e.close,"modal-append-to-body":!1},on:{"update:visible":function(t){e.selectTemplateShow=t}}},[a("div",{staticClass:"dialog-header"},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入考核指标名称","suffix-icon":"el-icon-search"},nativeOn:{keyup:function(t){return!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getList(t)}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.createTemplate}},[e._v("新建模板")])],1),e._v(" "),a("div",{staticClass:"dialog-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{height:"550",data:e.tableData,"tooltip-effect":"dark"},on:{select:e.select,"select-all":e.onSelectAll,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),e._l(e.fieldList,(function(e,t){return a("el-table-column",{key:t,attrs:{"show-overflow-tooltip":"",label:e.label,prop:e.prop}})}))],2)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.close}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handlerSubmit}},[e._v("确 定")])],1),e._v(" "),e.createTemplateShow?a("assessment-template-create",{attrs:{"indicator-template":{}},on:{close:e.createTemplateSuccess}}):e._e()],1)},we=[],Se=a("e2cc"),Ce=a("0677"),xe={name:"SelectTemplateDialog",components:{assessmentTemplateCreate:Ce["a"]},props:{selectTemplateShow:Boolean,selectTemplateName:String,status:[String,Number]},data:function(){return{loading:!1,search:"",tableData:[],fieldList:[{label:"名称",prop:"templateName"},{label:"考核维度",prop:"dimensionNum"},{label:"考核指标(项)",prop:"quotaNum"},{label:"合计(分)",prop:"upperLimitScore"},{label:"考核指标说明",prop:"templateIllustrate"}],selectData:[],createTemplateShow:!1}},watch:{selectTemplateShow:function(e){var t=this;e&&this.selectTemplateName&&this.tableData.forEach((function(e){e.templateName==t.selectTemplateName&&t.$nextTick((function(){t.$refs.multipleTable.toggleRowSelection(e,!0)}))}))}},created:function(){this.getList()},methods:{getList:function(e){var t=this;this.loading=!0;var a={templateName:this.search,pageType:0};Object(Se["c"])(a).then((function(a){t.tableData=a.data.list||[],e&&t.tableData.forEach((function(e){e.templateName==t.selectTemplateName&&t.$nextTick((function(){t.$refs.multipleTable.toggleRowSelection(e,!0)}))})),t.loading=!1})).catch((function(){t.loading=!1}))},handleSelectionChange:function(e){this.selectData=e},select:function(e,t){this.$refs.multipleTable.clearSelection(),0!==e.length&&this.$refs.multipleTable.toggleRowSelection(t,!0)},onSelectAll:function(){this.$refs.multipleTable.clearSelection()},handlerSubmit:function(){this.selectData.length?(this.$emit("select",1==this.selectData.length?this.selectData[0]:this.selectData[1]),this.$message.success("选择模板成功"),this.close()):this.$message.error("请选择考核模板")},createTemplate:function(){this.createTemplateShow=!0},createTemplateSuccess:function(){this.createTemplateShow=!1,this.getList("createTemplate")},close:function(){this.$emit("close")}}},ke=xe,Te=(a("c2e1"),Object(S["a"])(ke,_e,we,!1,null,"09950e54",null)),Oe=Te.exports,Le=a("5824"),Fe=a("8cf0"),Ne=a("0730"),Ie=a("2046"),De={name:"BaseInfoSet",components:{CreateSections:ye["a"],SelectTemplateDialog:Oe,WkTextarea:Le["a"],WkUserDepSelect:Fe["a"]},mixins:[Ne["a"],Ie["a"]],inject:{disabled:{default:!1}},props:{baseForm:Object,verify:Object,targetTemplateName:String,status:[String,Number]},data:function(){var e=function(e,t,a){t&&(t.employeeIds&&t.employeeIds.length||t.deptIds&&t.deptIds.length)?a():a(new Error("请选择"))};return{loading:!1,queryInspectionDeptEmployeeListFn:n["E"],appraisalCycleTypeList:[{label:"月度",value:1},{label:"季度",value:2},{label:"上半年",value:3},{label:"下半年",value:4},{label:"全年",value:5},{label:"其他",value:6}],baseOtherForm:{appraisalCycleType:1},baseFormRules:{},baseOtherFieldList:[],inspectionScopeOptions:[{label:"员工部门",value:1,disabled:!1},{label:"聘用形式",value:2,disabled:!1}],hireFormOptions:[{label:"正式",value:1,disabled:!1},{label:"非正式",value:2,disabled:!1}],datePickerType:{1:"month",2:"year",3:"year",4:"year",5:"year",6:"daterange"},datePickerTypeFormat:{1:"yyyy-MM",2:"yyyy",3:"yyyy",4:"yyyy",5:"yyyy",6:"yyyy-MM-dd"},selectTemplateName:"",depUserViewDialogShow:!1,selectTemplateShow:!1,userDepRules:{required:!0,validator:e,trigger:"change"}}},computed:{titleContent:function(){return Object.keys(this.resultsTemplate).length?"编辑":"新建"}},watch:{"baseForm.inspectionScope":{handler:function(e){var t=this,a=0;e.forEach((function(e){2==e.type&&(a+=1)})),e.forEach((function(e,i){1==e.type?t.inspectionScopeOptions[e.type-1].disabled=!0:2==e.type&&(e.employType&&(t.hireFormOptions[e.employType-1].disabled=!0),2==a&&(t.inspectionScopeOptions[e.type-1].disabled=!0))}))},immediate:!0,deep:!0},verify:{handler:function(e){var t=this;"base"!=e.tab||e.pass||this.$refs.baseForm.validate((function(a){a?t.$emit("pass",e.next,e.tab,e.type):t.$message.error("请完善表单信息")}))},deep:!0},targetTemplateName:{handler:function(e){e&&(this.selectTemplateName=e)},immediate:!0}},created:function(){this.getField()},methods:{getField:function(){var e=this;this.baseOtherFieldList=[{name:"考核计划名称",field:"appraisalPlanName",fieldName:"appraisalPlanName",formType:"text",rules:[{required:!0,message:"考核计划名称不能为空",trigger:["change","blur"]},{max:50,message:"最多输入50个汉字、英文、数字",trigger:["change","blur"]}]},{name:"考核周期类型",field:"appraisalCycleType",fieldName:"appraisalCycleType",formType:"select",setting:this.appraisalCycleTypeList,rules:{required:!0,message:"考核周期类型不能为空",trigger:"change"}},{name:"考核周期",field:"appraisalCycle",rules:{required:!0}},{name:"考核说明",field:"appraisalIllustrate",fieldName:"appraisalIllustrate",formType:"textarea"}];var t={};this.baseOtherFieldList.forEach((function(a){"select"==a.formType?t[a.field]={required:!0,message:"请选择",trigger:"change"}:"appraisalCycle"==a.fieldName?t[a.field]={required:!0}:t[a.field]=e.getRules(a)})),this.baseFormRules=t},selectUserDepChange:function(e,t){this.$set(this.baseForm.inspectionScope[t],"employeeIds",e[0]),this.$set(this.baseForm.inspectionScope[t],"deptIds",e[1]),this.$refs.baseForm.validateField("inspectionScope[".concat(t,"]"))},appraisalCycleTypeChange:function(){this.$set(this.baseForm,"appraisalCycle",""),this.$set(this.baseForm,"quarter","")},getEmploySubOptions:function(e){return e.employType&&1==e.employType?[{label:"正式",value:1},{label:"试用",value:2}]:e.employType&&2==e.employType?[{label:"实习",value:3},{label:"兼职",value:4},{label:"劳务",value:5},{label:"顾问",value:6},{label:"返聘",value:7},{label:"外包",value:8}]:[]},addInspectionScope:function(){this.baseForm.inspectionScope.push({type:"",value:""})},deleteItemClick:function(e){var t=this;this.baseForm.inspectionScope[e].employType&&(this.hireFormOptions[this.baseForm.inspectionScope[e].employType-1].disabled=!1),this.baseForm.inspectionScope.splice(e,1),this.baseForm.inspectionScope.forEach((function(e){t.inspectionScopeOptions.forEach((function(t){e.type!=t.value&&(t.disabled=!1)}))}))},handelSelect:function(e){this.$set(this.baseForm,"appraisalTemplateId",e.templateId),this.selectTemplateName=e.templateName,this.$refs.baseForm.validateField("appraisalTemplateId")},handleClose:function(){this.$set(this.baseForm,"appraisalTemplateId",""),this.selectTemplateName="",this.$refs.baseForm.validateField("appraisalTemplateId")},inspectionScopeChange:function(e,t){var a=this,i=0;this.baseForm.inspectionScope.forEach((function(e){2==e.type&&(i+=1)})),this.baseForm.inspectionScope.forEach((function(t){t.type==e&&1==e&&2!=i?a.inspectionScopeOptions[e].disabled=!1:t.type==e&&2==e&&(a.inspectionScopeOptions[0].disabled=!1)}))},hireFormChange:function(e,t,a){this.hireFormOptions.forEach((function(t){t.value==e?t.disabled=!0:t.disabled=!1})),a.employeeStatus&&(a.employeeStatus=[])}}},je=De,$e=(a("eac4"),Object(S["a"])(je,ge,be,!1,null,"4362ea9d",null)),Pe=$e.exports,Ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"base-info-set",staticStyle:{padding:"0 20px",overflow:"auto"}},[a("el-form",{ref:"baseForm",staticStyle:{"padding-right":"70%"},attrs:{model:e.tagetForm,"label-position":"top",rules:e.fieldsRules}},[a("wk-form-items",{attrs:{"field-from":e.tagetForm,disabled:e.disabled,"field-list":e.fields},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.data;return[i&&"radioType"==i.formType?a("el-radio",{attrs:{disabled:e.disabled,label:1},model:{value:e.tagetForm[i.fieldName],callback:function(t){e.$set(e.tagetForm,i.fieldName,t)},expression:"tagetForm[data.fieldName]"}},[e._v("\n          加权计算\n          "),a("span",{staticStyle:{"font-size":"12px",color:"#5e6c84"}},[e._v("总分=评分 X 维度权重 X 指标权重，再累加")])]):e._e(),e._v(" "),i&&"integer"==i.formType?a("el-input",{attrs:{disabled:e.disabled,placeholder:""},on:{input:function(t){e.tagetForm[i.fieldName]=e.tagetForm[i.fieldName].replace(/[^\d]/g,"")}},model:{value:e.tagetForm[i.fieldName],callback:function(t){e.$set(e.tagetForm,i.fieldName,t)},expression:"tagetForm[data.fieldName]"}}):e._e()]}}])})],1),e._v(" "),a("div",[a("div",{staticClass:"other"},[a("span",[e._v("\n        当前维度权重合计:\n        "),a("span",{style:e.dimensionWeightSum>100?"color:red":"color:#ffb55f"},[e._v("\n          "+e._s(e.dimensionWeightSum)),"--"!=e.dimensionWeightSum?a("span",[e._v("%")]):e._e()])]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disabled},on:{click:function(t){e.examineShow=!0}}},[e._v("\n        新增考核维度\n      ")])],1),e._v(" "),e.assessmentDimensionList&&e.assessmentDimensionList.length>0?a("assessment-dimension",{ref:"assessmentForm",attrs:{"assessment-dimension-list":e.assessmentDimensionList,"quota-item":e.quotaItem},on:{editAssess:e.editAssess}}):e._e()],1),e._v(" "),e.examineShow?a("el-dialog",{attrs:{width:"900",visible:e.examineShow,"append-to-body":"","custom-class":"drawer","before-close":e.close},on:{"update:visible":function(t){e.examineShow=t}}},[a("el-form",{ref:"examineForm",attrs:{model:e.examineFieldsForm,"label-position":"top",rules:e.examineFieldsRules}},[a("wk-form-items",{attrs:{"field-from":e.examineFieldsForm,"field-list":e.examineFields},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.data;return[i&&"check"==i.formType?a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.examineFieldsForm[i.fieldName],callback:function(t){e.$set(e.examineFieldsForm,i.fieldName,t)},expression:"examineFieldsForm[data.fieldName]"}},[e._v("允许员工填写 勾选后，员工在制定指标时可以为当前考核维度添加指标")]):e._e()]}}])})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.examineShow=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.examineCreate}},[e._v("确 定")])],1)],1):e._e()],1)},Ae=[],Be=a("2909"),Re=(a("e9c4"),a("215e")),qe=a("05b4"),Ve={name:"IndicatorSettings",components:{WkFormItems:Re["default"],AssessmentDimension:qe["a"]},mixins:[Ne["a"],Ie["a"]],inject:{disabled:{default:!1}},props:{tagetForm:Object,verify:Object,templateId:String,status:[String,Number]},data:function(){return{loading:!1,height:document.documentElement.clientHeight-100,fields:[],fieldsRules:{},examineFields:[],examineFieldsForm:{},examineFieldsRules:{},examineShow:!1,quoteTypeList:[],assessmentDimensionList:[],quotaItem:{},examineType:"create",examineIndex:void 0,flag:!1}},computed:{dimensionWeightSum:function(){var e=0;return this.assessmentDimensionList&&!this.assessmentDimensionList.length?"--":(this.assessmentDimensionList.forEach((function(t){e+=t.dimensionWeight})),e)}},watch:{examineShow:function(e){e||(this.examineFieldsForm={quotaType:1})},verify:{handler:function(e){var t=this;if("target"==e.tab&&!e.pass){var a=!0,i=!0,s=!0,n=!0;this.$refs.baseForm.validate((function(r){if(t.$refs.assessmentForm&&t.$refs.assessmentForm.$refs.form){for(var o in t.$refs.assessmentForm.tableForm)1==t.$refs.assessmentForm.tableForm[o].length&&(i=!1),t.assessmentDimensionList.forEach((function(e){if(!e.isAllowEdit){var a=0;t.$refs.assessmentForm.tableForm["table"+e.key].forEach((function(e){a+=e.quotaWeight||0})),100!=a&&(s=!1)}}));var c=[];t.$refs.assessmentForm.$refs.form.forEach((function(e){e.validate((function(e){if(!(e&&r&&i&&s)&&(n=!1,a)){var l=i?s?"请完善信息":"指标权重总和需等于100%":"至少添加一条指标项";t.$message.error(l),a=!1}}))})),r&&i&&s&&n&&(t.assessmentDimensionList.forEach((function(e,a){c.push(Object(l["a"])(Object(l["a"])({},e),{},{quotaSettingDimensionQuotaBOList:t.$refs.assessmentForm.tableForm["table"+e.key].filter((function(e){return Object.keys(e).length}))}))})),t.tagetForm.quotaSettingDimensionBOList=c,t.$emit("pass",e.next,e.tab,e.type))}else t.assessmentDimensionList.length?t.$message.error("请完善信息"):t.$message.error("至少添加一条考核维度")}))}},deep:!0},templateId:function(e){e&&(this.flag&&2==this.status&&this.status||!this.status)&&this.setTemplate(e)}},created:function(){this.getTypeList(),this.getField()},methods:{getField:function(){var e=this;if(this.fields=[{name:"总分计算",fieldName:"scoreCalculation",field:"scoreCalculation",formType:"radioType",value:"加权计算",setting:["加权计算"],isNull:1,stylePercent:100},{name:"评分上限类型",fieldName:"upperLimitType",field:"upperLimitType",formType:"select",setting:[{label:"统一上限",value:1}],isNull:1,value:1,stylePercent:100},{name:"评分上限",fieldName:"upperLimitScore",field:"upperLimitScore",formType:"integer",value:100,min:0,isNull:1,stylePercent:100}],this.examineFields=[{name:"维度名称",fieldName:"dimensionName",field:"dimensionName",formType:"text",isNull:1,stylePercent:50},{name:"指标类型",fieldName:"quotaType",field:"quotaType",formType:"select",isNull:1,setting:this.quoteTypeList,value:1,stylePercent:50},{name:"维度权重",fieldName:"dimensionWeight",field:"dimensionWeight",formType:"percent",isNull:1,max:100,min:0,stylePercent:50},{name:"备注",fieldName:"remarks",field:"remarks",formType:"textarea",maxlength:200,stylePercent:50},{name:"",fieldName:"isAllowEdit",field:"isAllowEdit",formType:"check"}],this.examineFieldsForm={quotaType:1},this.tagetForm.quotaSettingDimensionBOList&&this.tagetForm.quotaSettingDimensionBOList.length){for(var t in this.tagetForm.quotaSettingDimensionBOList.forEach((function(t,a){var i;e.quotaItem["table"+(+new Date-a)]=[],e.assessmentDimensionList.push({dimensionName:t.dimensionName,dimensionWeight:t.dimensionWeight,isAllowEdit:t.isAllowEdit,quotaType:t.quotaType,remarks:t.remarks,key:+new Date-a}),(i=e.quotaItem["table"+(+new Date-a)]).push.apply(i,Object(Be["a"])(t.quotaSettingDimensionQuotaBOList))})),this.quotaItem)this.quotaItem[t].push({});this.flag=!0}this.fields.forEach((function(t){e.fieldsRules[t.fieldName]=e.getRules(t)})),this.examineFields.forEach((function(t){e.examineFieldsRules[t.fieldName]=e.getRules(t)})),this.examineFieldsRules.dimensionName.push({max:50,message:"最多输入50个汉字、英文、数字",trigger:["blur","change"]})},setTemplate:function(e){var t=this;this.assessmentDimensionList=[],this.quotaItem={},Object(Se["d"])(e).then((function(e){var a=Object(y["z"])(e.data)||{};for(var i in t.tagetForm.scoreCalculation=a.scoreCalculation,t.tagetForm.upperLimitScore=a.upperLimitScore,t.tagetForm.upperLimitType=a.upperLimitType,a.dimensionVOList.forEach((function(e,a){var i;t.quotaItem["table"+(e.templateId+a)]=[],t.assessmentDimensionList.push({dimensionName:e.dimensionName,dimensionWeight:e.dimensionWeight,isAllowEdit:e.isAllowEdit,quotaType:e.quotaType,remarks:e.remarks,key:e.templateId+a}),(i=t.quotaItem["table"+(e.templateId+a)]).push.apply(i,Object(Be["a"])(e.achievementsQuotaVOList))})),t.quotaItem)t.quotaItem[i].push({})}))},getTypeList:function(){var e=this;Object(Se["e"])().then((function(t){t.data.forEach((function(t){e.quoteTypeList.push({label:t.quoteTypeName,value:t.quoteType})}))}))},examineCreate:function(){var e=this;this.$refs.examineForm.validate((function(t){t?"update"==e.examineType?(e.assessmentDimensionList.splice(e.examineIndex,1,JSON.parse(JSON.stringify(e.examineFieldsForm))),e.examineShow=!1,e.examineType="create"):(e.examineFieldsForm.key=+new Date,e.assessmentDimensionList.push(e.examineFieldsForm),e.examineShow=!1):e.$message.error("请完善考核维度信息")}))},close:function(){this.examineShow=!1},editAssess:function(e){this.examineShow=!0,this.examineIndex=e,this.examineType="update",this.examineFieldsForm=JSON.parse(JSON.stringify(this.assessmentDimensionList[e]))}}},He=Ve,ze=(a("2c8e"),Object(S["a"])(He,Ee,Ae,!1,null,"15348d27",null)),Ue=ze.exports,We=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"base-info-set",staticStyle:{padding:"0 20px",overflow:"auto"},attrs:{"body-style":{height:"100%"}}},[a("el-form",{ref:"form",attrs:{model:e.flowForm,"label-position":"top"}},[a("create-sections",{attrs:{title:"考核范围及考核指标"}}),e._v(" "),e._l(e.flowFormFieldList,(function(t,i){return a("el-form-item",{key:i,attrs:{label:t.label,rules:t.rules}},["quotaSettingType"==t.fieldName?a("el-radio",{attrs:{disabled:e.disabled,label:1},on:{change:e.radioChange},model:{value:e.flowForm[t.fieldName],callback:function(a){e.$set(e.flowForm,t.fieldName,a)},expression:"flowForm[item.fieldName]"}},[e._v("系统制定")]):e._e(),e._v(" "),"quotaSettingType"==t.fieldName?a("el-radio",{attrs:{disabled:e.disabled,label:2},model:{value:e.flowForm[t.fieldName],callback:function(a){e.$set(e.flowForm,t.fieldName,a)},expression:"flowForm[item.fieldName]"}},[e._v("员工填写")]):e._e(),e._v(" "),2==e.flowForm.quotaSettingType&&"targetConfirmation"==t.fieldName?a("div",[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("create-sections",{staticStyle:{"margin-right":"10px"},attrs:{title:"目标确认"}}),e._v(" "),a("el-switch",{attrs:{disabled:e.disabled,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.targetConfirmationChange},model:{value:e.flowForm[t.fieldName],callback:function(a){e.$set(e.flowForm,t.fieldName,a)},expression:"flowForm[item.fieldName]"}})],1),e._v(" "),e.flowForm["targetConfirmation"]?a("el-form-item",{attrs:{label:"目标确认人",rules:{required:!0}}},[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("el-form-item",{attrs:{prop:"processSettingTargetConfirmationBO[confirmationType]",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-select",{attrs:{disabled:e.disabled},on:{change:e.confirmationTypeChange},model:{value:e.flowForm.processSettingTargetConfirmationBO.confirmationType,callback:function(t){e.$set(e.flowForm.processSettingTargetConfirmationBO,"confirmationType",t)},expression:"flowForm.processSettingTargetConfirmationBO.confirmationType"}},e._l(e.scorerOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),1==e.flowForm.processSettingTargetConfirmationBO.confirmationType||2==e.flowForm.processSettingTargetConfirmationBO.confirmationType?a("el-form-item",{attrs:{prop:"processSettingTargetConfirmationBO[confirmationLevel]",rules:{required:!0,message:"请选择",trigger:"change"}}},[1==e.flowForm.processSettingTargetConfirmationBO.confirmationType?a("el-select",{attrs:{disabled:e.disabled},model:{value:e.flowForm.processSettingTargetConfirmationBO.confirmationLevel,callback:function(t){e.$set(e.flowForm.processSettingTargetConfirmationBO,"confirmationLevel",t)},expression:"flowForm.processSettingTargetConfirmationBO.confirmationLevel"}},e._l(e.superiorOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):e._e(),e._v(" "),2==e.flowForm.processSettingTargetConfirmationBO.confirmationType?a("el-select",{attrs:{disabled:e.disabled},model:{value:e.flowForm.processSettingTargetConfirmationBO.confirmationLevel,callback:function(t){e.$set(e.flowForm.processSettingTargetConfirmationBO,"confirmationLevel",t)},expression:"flowForm.processSettingTargetConfirmationBO.confirmationLevel"}},e._l(e.departmentOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):e._e()],1):e._e(),e._v(" "),3==e.flowForm.processSettingTargetConfirmationBO.confirmationType?a("el-form-item",{attrs:{prop:"processSettingTargetConfirmationBO[identifyingPeople]",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("wk-user-select",{staticStyle:{height:"32px","margin-left":"10px"},attrs:{disabled:e.disabled,props:{dataType:"hrm",label:"employeeName",value:"employeeId",isKpi:!0},radio:!0},model:{value:e.flowForm.processSettingTargetConfirmationBO.identifyingPeople,callback:function(t){e.$set(e.flowForm.processSettingTargetConfirmationBO,"identifyingPeople",t)},expression:"flowForm.processSettingTargetConfirmationBO.identifyingPeople"}})],1):e._e()],1)]):e._e()],1):e._e(),e._v(" "),"processSettingScoringBOList"==t.fieldName?a("div",[a("create-sections",{attrs:{title:"考核评分流程"}}),e._v(" "),a("grading-process",{ref:"grading",refInFor:!0,attrs:{type:e.flowForm.quotaSettingType,"process-setting-scoring-b-o-list":e.flowForm.processSettingScoringBOList}})],1):e._e(),e._v(" "),"resultAudit"==t.fieldName?a("div",[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("create-sections",{staticStyle:{"margin-right":"10px"},attrs:{title:"结果审核"}}),e._v(" "),a("el-switch",{attrs:{disabled:e.disabled,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.resultAuditChange},model:{value:e.flowForm[t.fieldName],callback:function(a){e.$set(e.flowForm,t.fieldName,a)},expression:"flowForm[item.fieldName]"}})],1),e._v(" "),e.flowForm[t.fieldName]?a("div",{staticStyle:{"padding-right":"73%"}},[a("p",{staticStyle:{color:"#6b778c"}},[e._v("确认说明：确认驳回后重新提交后跳过已确认的层级，返回拒绝的层级")]),e._v(" "),e._l(e.flowForm["processSettingResultAuditBOList"],(function(t,i){return a("div",{key:i},[a("div",[a("span",[e._v("第"+e._s(i+1==1?"一":i+1==2?"二":"三")+"级")]),e._v(" "),a("span",{staticClass:"level"},[e._v("选择员工"),a("span",{staticStyle:{color:"#ff7330"}},[e._v("*")])])]),e._v(" "),a("div",{staticClass:"results-level"},[a("el-form-item",{attrs:{prop:"processSettingResultAuditBOList["+i+"].auditType",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-select",{attrs:{disabled:e.disabled},on:{change:function(t){e.resultsLevelChange(t,i)}},model:{value:e.flowForm["processSettingResultAuditBOList"][i].auditType,callback:function(t){e.$set(e.flowForm["processSettingResultAuditBOList"][i],"auditType",t)},expression:"flowForm['processSettingResultAuditBOList'][sIndex].auditType"}},e._l(e.resultsAudit,(function(e,t){return a("el-option",{key:t,attrs:{disabled:e.disabled,label:e.label,value:e.value}})})))],1),e._v(" "),1==e.flowForm["processSettingResultAuditBOList"][i].auditType||2==e.flowForm["processSettingResultAuditBOList"][i].auditType?a("el-form-item",{attrs:{prop:"processSettingResultAuditBOList["+i+"].level",rules:{required:!0,message:"请选择",trigger:"change"}}},[1==e.flowForm["processSettingResultAuditBOList"][i].auditType?a("el-select",{attrs:{disabled:e.disabled},model:{value:e.flowForm["processSettingResultAuditBOList"][i].level,callback:function(t){e.$set(e.flowForm["processSettingResultAuditBOList"][i],"level",t)},expression:"flowForm['processSettingResultAuditBOList'][sIndex].level"}},e._l(e.superiorOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))):e._e(),e._v(" "),2==e.flowForm["processSettingResultAuditBOList"][i].auditType?a("el-select",{attrs:{disabled:e.disabled},model:{value:e.flowForm["processSettingResultAuditBOList"][i].level,callback:function(t){e.$set(e.flowForm["processSettingResultAuditBOList"][i],"level",t)},expression:"flowForm['processSettingResultAuditBOList'][sIndex].level"}},e._l(e.departmentOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))):e._e()],1):e._e(),e._v(" "),3==e.flowForm["processSettingResultAuditBOList"][i].auditType?a("el-form-item",{attrs:{prop:"processSettingResultAuditBOList["+i+"].designatedPerson",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("wk-user-select",{staticStyle:{height:"32px"},attrs:{disabled:e.disabled,props:{dataType:"hrm",label:"employeeName",value:"employeeId",isKpi:!0},radio:!0},model:{value:e.flowForm["processSettingResultAuditBOList"][i].designatedPerson,callback:function(t){e.$set(e.flowForm["processSettingResultAuditBOList"][i],"designatedPerson",t)},expression:"flowForm['processSettingResultAuditBOList'][sIndex].designatedPerson"}})],1):e._e(),e._v(" "),e.flowForm["processSettingResultAuditBOList"][i].auditType&&!e.disabled?a("i",{staticClass:"wk wk-close",staticStyle:{color:"#97a0af",cursor:"pointer"},on:{click:function(t){e.handleClose(i,"audit")}}}):e._e()],1)])})),e._v(" "),a("el-button",{staticStyle:{"margin-top":"10px"},attrs:{disabled:3==e.flowForm["processSettingResultAuditBOList"].length||e.disabled,type:"text"},on:{click:e.addResultsAudit}},[e._v("+新增审核节点")])],2):e._e()]):e._e(),e._v(" "),"resultConfirmation"==t.fieldName?a("div",[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("create-sections",{staticStyle:{"margin-right":"10px"},attrs:{title:"结果确认"}}),e._v(" "),a("el-switch",{attrs:{disabled:e.disabled,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.appealListChange},model:{value:e.flowForm[t.fieldName],callback:function(a){e.$set(e.flowForm,t.fieldName,a)},expression:"flowForm[item.fieldName]"}})],1),e._v(" "),e.flowForm[t.fieldName]?a("div",{staticStyle:{"padding-right":"73%"}},[a("p",{staticStyle:{color:"#6b778c"}},[e._v("确认说明：保证结果的公正性，员工可发起结果确认申诉，确认人为被考核人")]),e._v(" "),a("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{label:"超期未审核",rules:{required:!0}}},[a("div",{staticStyle:{display:"flex"}},[a("el-form-item",{attrs:{prop:"overdueDays",rules:{required:!0,message:"未审核天数不能为空",trigger:["change","blur"]}}},[a("div",{staticStyle:{display:"flex"}},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("超")]),e._v(" "),a("el-input-number",{staticStyle:{width:"60px"},attrs:{disabled:e.disabled,min:1,max:100,controls:!1},model:{value:e.flowForm["overdueDays"],callback:function(t){e.$set(e.flowForm,"overdueDays",t)},expression:"flowForm['overdueDays']"}}),e._v(" "),a("span",[e._v("天")])],1)]),e._v(" "),a("el-form-item",{staticStyle:{"margin-left":"15px"},attrs:{prop:"beOverdueType",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-select",{attrs:{disabled:e.disabled},model:{value:e.flowForm["beOverdueType"],callback:function(t){e.$set(e.flowForm,"beOverdueType",t)},expression:"flowForm['beOverdueType']"}},e._l([{label:"未审批拒绝",value:1},{label:"未审批通过",value:2}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)],1)]),e._v(" "),e._l(e.flowForm["processSettingResultConfirmationBOList"],(function(t,i){return a("div",{key:i},[a("div",[a("span",[e._v("第"+e._s(i+1==1?"一":i+1==2?"二":"三")+"级")]),e._v(" "),a("span",{staticClass:"level"},[e._v("选择员工"),a("span",{staticStyle:{color:"#ff7330"}},[e._v("*")])])]),e._v(" "),a("div",{staticClass:"results-level"},[a("el-form-item",{attrs:{prop:"processSettingResultConfirmationBOList["+i+"].confirmationType",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-select",{attrs:{disabled:e.disabled},on:{change:function(t){e.appealLevelChange(t,i)}},model:{value:e.flowForm["processSettingResultConfirmationBOList"][i].confirmationType,callback:function(t){e.$set(e.flowForm["processSettingResultConfirmationBOList"][i],"confirmationType",t)},expression:"flowForm['processSettingResultConfirmationBOList'][sIndex].confirmationType"}},e._l(e.appealList,(function(e,t){return a("el-option",{key:t,attrs:{disabled:e.disabled,label:e.label,value:e.value}})})))],1),e._v(" "),1==e.flowForm["processSettingResultConfirmationBOList"][i].confirmationType||2==e.flowForm["processSettingResultConfirmationBOList"][i].confirmationType?a("el-form-item",{attrs:{prop:"processSettingResultConfirmationBOList["+i+"].level",rules:{required:!0,message:"请选择",trigger:"change"}}},[1==e.flowForm["processSettingResultConfirmationBOList"][i].confirmationType?a("el-select",{attrs:{disabled:e.disabled},model:{value:e.flowForm["processSettingResultConfirmationBOList"][i].level,callback:function(t){e.$set(e.flowForm["processSettingResultConfirmationBOList"][i],"level",t)},expression:"flowForm['processSettingResultConfirmationBOList'][sIndex].level"}},e._l(e.superiorOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))):e._e(),e._v(" "),2==e.flowForm["processSettingResultConfirmationBOList"][i].confirmationType?a("el-select",{attrs:{disabled:e.disabled},model:{value:e.flowForm["processSettingResultConfirmationBOList"][i].level,callback:function(t){e.$set(e.flowForm["processSettingResultConfirmationBOList"][i],"level",t)},expression:"flowForm['processSettingResultConfirmationBOList'][sIndex].level"}},e._l(e.departmentOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))):e._e()],1):e._e(),e._v(" "),3==e.flowForm["processSettingResultConfirmationBOList"][i].confirmationType?a("el-form-item",{attrs:{prop:"processSettingResultConfirmationBOList["+i+"].designatedUserId",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("wk-user-select",{staticStyle:{height:"32px"},attrs:{disabled:e.disabled,props:{dataType:"hrm",label:"employeeName",value:"employeeId",isKpi:!0},radio:!0},model:{value:e.flowForm["processSettingResultConfirmationBOList"][i].designatedUserId,callback:function(t){e.$set(e.flowForm["processSettingResultConfirmationBOList"][i],"designatedUserId",t)},expression:"flowForm['processSettingResultConfirmationBOList'][sIndex].designatedUserId"}})],1):e._e(),e._v(" "),e.flowForm["processSettingResultConfirmationBOList"][i].confirmationType&&!e.disabled?a("i",{staticClass:"wk wk-close",staticStyle:{color:"#97a0af",cursor:"pointer"},on:{click:function(t){e.handleClose(i,"appeal")}}}):e._e()],1)])})),e._v(" "),a("el-button",{staticStyle:{"margin-top":"10px"},attrs:{disabled:3==e.flowForm["processSettingResultConfirmationBOList"].length||e.disabled,type:"text"},on:{click:e.addAppeal}},[e._v("+新增申诉节点")])],2):e._e()]):e._e()],1)}))],2)],1)},Me=[],Ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"form",attrs:{model:e.gradingProcessForm,"label-width":"80px"}},[a("el-table",{attrs:{data:e.gradingProcessForm["processSettingScoringBOList"]}},[e._l(e.tableFieldList,(function(t,i){return a("el-table-column",{key:i,attrs:{label:t.label,width:t.width,prop:t.prop},scopedSlots:e._u([{key:"header",fn:function(i){i.column,i.$index;return[a("span",[e._v("\n          "+e._s(t.label)+"\n          "),"rater"==t.prop||"weight"==t.prop?a("span",{staticStyle:{color:"#de350b"}},[e._v("*")]):e._e()])]}},{key:"default",fn:function(i){var s=i.$index;return["rater"==t.prop&&e.gradingProcessForm["processSettingScoringBOList"].length-1==s?a("div",{staticClass:"rater"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.addSelfAssessmentShow,expression:"addSelfAssessmentShow"}],attrs:{disabled:e.disabled,type:"text"},on:{click:function(t){e.addScore("self")}}},[e._v("+新增自评")]),e._v(" "),a("el-button",{attrs:{type:"text",disabled:e.disabled},on:{click:function(t){e.addScore("others")}}},[e._v("+新增他人评分")])],1):e._e(),e._v(" "),"weight"==t.prop&&e.gradingProcessForm["processSettingScoringBOList"].length-1==s&&e.weightTotal?a("span",{style:e.weightTotal>100?"color:red":"color: #ff991f"},[e._v(e._s(e.weightTotal)+"%")]):e._e(),e._v(" "),"rater"!=t.prop||e.gradingProcessForm["processSettingScoringBOList"].length-1==s||e.gradingProcessForm["processSettingScoringBOList"][s].hasOwnProperty("rejectAuthority")?e._e():a("span",[e._v("\n          被审核人\n        ")]),e._v(" "),"rater"==t.prop&&e.gradingProcessForm["processSettingScoringBOList"].length-1!=s&&e.gradingProcessForm["processSettingScoringBOList"][s].hasOwnProperty("rejectAuthority")?a("div",{staticClass:"rater"},[a("el-form-item",{attrs:{prop:"processSettingScoringBOList["+s+"].raterType",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-select",{attrs:{disabled:e.disabled},on:{change:function(t){e.confirmationTypeChange(t,s)}},model:{value:e.gradingProcessForm["processSettingScoringBOList"][s]["raterType"],callback:function(t){e.$set(e.gradingProcessForm["processSettingScoringBOList"][s],"raterType",t)},expression:"gradingProcessForm['processSettingScoringBOList'][$index]['raterType']"}},e._l(e.scorerOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),1==e.gradingProcessForm["processSettingScoringBOList"][s]["raterType"]||2==e.gradingProcessForm["processSettingScoringBOList"][s]["raterType"]?a("el-form-item",{attrs:{prop:"processSettingScoringBOList["+s+"].raterLevel",rules:{required:!0,message:"请选择",trigger:"change"}}},[1==e.gradingProcessForm["processSettingScoringBOList"][s]["raterType"]?a("el-select",{attrs:{disabled:e.disabled},on:{change:function(t){e.confirmationLevelChange(t,"superior")}},model:{value:e.gradingProcessForm["processSettingScoringBOList"][s]["raterLevel"],callback:function(t){e.$set(e.gradingProcessForm["processSettingScoringBOList"][s],"raterLevel",t)},expression:"gradingProcessForm['processSettingScoringBOList'][$index]['raterLevel']"}},e._l(e.superiorOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,disabled:e.disabled,value:e.value}})}))):e._e(),e._v(" "),2==e.gradingProcessForm["processSettingScoringBOList"][s]["raterType"]?a("el-select",{attrs:{disabled:e.disabled},on:{change:function(t){e.confirmationLevelChange(t,"dep")}},model:{value:e.gradingProcessForm["processSettingScoringBOList"][s]["raterLevel"],callback:function(t){e.$set(e.gradingProcessForm["processSettingScoringBOList"][s],"raterLevel",t)},expression:"gradingProcessForm['processSettingScoringBOList'][$index]['raterLevel']"}},e._l(e.departmentOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,disabled:e.disabled,value:e.value}})}))):e._e()],1):e._e(),e._v(" "),3==e.gradingProcessForm["processSettingScoringBOList"][s]["raterType"]?a("el-form-item",{attrs:{prop:"processSettingScoringBOList["+s+"].rater",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("wk-user-select",{staticStyle:{width:"120px",height:"32px"},attrs:{disabled:e.disabled,props:{dataType:"hrm",label:"employeeName",value:"employeeId",isKpi:!0},radio:!0},on:{change:function(t){e.userSelectChange(arguments,s)}},model:{value:e.gradingProcessForm["processSettingScoringBOList"][s]["rater"],callback:function(t){e.$set(e.gradingProcessForm["processSettingScoringBOList"][s],"rater",t)},expression:"gradingProcessForm['processSettingScoringBOList'][$index]['rater']"}})],1):e._e()],1):e._e(),e._v(" "),"weight"==t.prop&&e.gradingProcessForm["processSettingScoringBOList"].length-1!=s?a("el-form-item",{attrs:{prop:"processSettingScoringBOList["+s+"].weight",rules:{required:!0,message:"不能为空",trigger:["change","blur"]}}},[a("wk-percent-input",{staticStyle:{width:"100%"},attrs:{disabled:e.disabled,min:0,max:100,controls:!1},model:{value:e.gradingProcessForm["processSettingScoringBOList"][s][t.prop],callback:function(a){e.$set(e.gradingProcessForm["processSettingScoringBOList"][s],t.prop,a)},expression:"gradingProcessForm['processSettingScoringBOList'][$index][item.prop]"}})],1):e._e(),e._v(" "),"select"==t.formType&&e.gradingProcessForm["processSettingScoringBOList"].length-1!=s?a("el-select",{attrs:{disabled:e.disabled},model:{value:e.gradingProcessForm["processSettingScoringBOList"][s][t.prop],callback:function(a){e.$set(e.gradingProcessForm["processSettingScoringBOList"][s],t.prop,a)},expression:"gradingProcessForm['processSettingScoringBOList'][$index][item.prop]"}},e._l(t.setting,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):e._e(),e._v(" "),"requiredSetting"==t.prop&&e.gradingProcessForm["processSettingScoringBOList"].length-1!=s?a("div",{staticClass:"onOff"},[a("span",[e._v("考核评语")]),e._v(" "),a("el-switch",{attrs:{disabled:e.disabled,"active-color":"#00875A","inactive-color":"#ff4949"},model:{value:e.gradingProcessForm["processSettingScoringBOList"][s][t.prop],callback:function(a){e.$set(e.gradingProcessForm["processSettingScoringBOList"][s],t.prop,a)},expression:"gradingProcessForm['processSettingScoringBOList'][$index][item.prop]"}})],1):e._e(),e._v(" "),"rejectAuthority"==t.prop&&e.gradingProcessForm["processSettingScoringBOList"].length-1!=s?a("div",{staticClass:"onOff"},[a("span",[e._v(e._s(e.gradingProcessForm["processSettingScoringBOList"][s].hasOwnProperty("rejectAuthority")?"允许驳回":"--"))]),e._v(" "),e.gradingProcessForm["processSettingScoringBOList"][s].hasOwnProperty("rejectAuthority")?a("el-switch",{attrs:{disabled:e.disabled,"active-color":"#00875A","inactive-color":"#ff4949"},model:{value:e.gradingProcessForm["processSettingScoringBOList"][s][t.prop],callback:function(a){e.$set(e.gradingProcessForm["processSettingScoringBOList"][s],t.prop,a)},expression:"gradingProcessForm['processSettingScoringBOList'][$index][item.prop]"}}):e._e()],1):e._e()]}}])})})),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,s=t.$index;return[e.gradingProcessForm["processSettingScoringBOList"].length-1!=s?a("el-button",{attrs:{type:"text",disabled:e.disabled},on:{click:function(t){e.handlerDel(i,s)}}},[e._v("删除")]):e._e()]}}])})],2)],1)},Qe=[],Je=a("371f"),Ke=a("5c0a"),Xe={name:"GradingProcess",components:{WkPercentInput:Je["a"],WkUserSelect:Ke["a"]},inject:{disabled:{default:!1}},props:{processSettingScoringBOList:Array,type:[String,Number]},data:function(){return{gradingProcessForm:{},tableFieldList:[{label:"评分人",prop:"rater",width:"260"},{label:"评分权重",prop:"weight",formType:"percent"},{label:"评分方式",prop:"scoringType",formType:"select",setting:[{label:"按指标评分",value:1}]},{label:"可见内容",prop:"visibleContent",formType:"select",setting:[{label:"所有人的评分/评语",value:2},{label:"仅自己的评分/评语",value:1}]},{label:"必填设置",prop:"requiredSetting",formType:"onOff"},{label:"驳回权限",prop:"rejectAuthority",formType:"onOff"}],addSelfAssessmentShow:!0,scorerOptions:[{label:"上级",value:1},{label:"部门负责人",value:2},{label:"指定评分人",value:3}],superiorOptions:[{label:"直属上级",value:1},{label:"第二级上级",value:2},{label:"第三级上级",value:3},{label:"第四级上级",value:4},{label:"第五级上级",value:5},{label:"第六级上级",value:6},{label:"第七级上级",value:7},{label:"第八级上级",value:8},{label:"第九级上级",value:9},{label:"第十级上级",value:10}],departmentOptions:[{label:"直属部门负责人",value:1},{label:"第二级部门负责人",value:2},{label:"第三级部门负责人",value:3},{label:"第四级部门负责人",value:4},{label:"第五级部门负责人",value:5},{label:"第六级部门负责人",value:6},{label:"第七级部门负责人",value:7},{label:"第八级部门负责人",value:8},{label:"第九级部门负责人",value:9},{label:"第十级部门负责人",value:10}]}},computed:{weightTotal:function(){var e=0;return this.processSettingScoringBOList.forEach((function(t){t.weight&&(e+=t.weight)})),e}},watch:{processSettingScoringBOList:{handler:function(e){var t=this;e.forEach((function(e){t.superiorOptions.forEach((function(t){e.raterLevel==t.value&&1==e.raterType&&(t.disabled=!0)}))})),e.forEach((function(e){t.departmentOptions.forEach((function(t){e.raterLevel==t.value&&2==e.raterType&&(t.disabled=!0)}))})),e.length>1&&e.forEach((function(e){!e.hasOwnProperty("rejectAuthority")&&e.hasOwnProperty("requiredSetting")&&(t.addSelfAssessmentShow=!1)}))},immediate:!0,deep:!0}},created:function(){this.gradingProcessForm.processSettingScoringBOList=this.processSettingScoringBOList},methods:{addScore:function(e){"self"==e?(this.processSettingScoringBOList.splice(this.processSettingScoringBOList.length-1,0,{rater:"",raterType:4,weight:void 0,scoringType:1,visibleContent:2,requiredSetting:!1}),this.addSelfAssessmentShow=!1):this.processSettingScoringBOList.splice(this.processSettingScoringBOList.length-1,0,{rater:"",weight:void 0,scoringType:1,visibleContent:2,requiredSetting:!1,rejectAuthority:!1,raterType:""})},handlerDel:function(e,t){var a=this;e.rejectAuthority||(this.addSelfAssessmentShow=!0),this.processSettingScoringBOList.forEach((function(e){a.superiorOptions.forEach((function(t){e.raterLevel!=t.value&&1==e.raterType&&(t.disabled=!1)}))})),this.processSettingScoringBOList.forEach((function(e){a.departmentOptions.forEach((function(t){e.raterLevel!=t.value&&2==e.raterType&&(t.disabled=!1)}))})),this.processSettingScoringBOList.splice(t,1)},confirmationLevelChange:function(e,t){"superior"==t?this.superiorOptions.forEach((function(t){t.value==e?t.disabled=!0:t.disabled=!1})):this.departmentOptions.forEach((function(t){t.value==e?t.disabled=!0:t.disabled=!1}))},confirmationTypeChange:function(e,t){var a=this;1==e||2==e?this.$set(this.processSettingScoringBOList[t],"raterLevel",""):3==e&&this.$set(this.processSettingScoringBOList[t],"rater",""),this.processSettingScoringBOList.forEach((function(e){a.superiorOptions.forEach((function(t){e.raterLevel!=t.value&&1==e.raterType&&(t.disabled=!1)}))})),this.processSettingScoringBOList.forEach((function(e){a.departmentOptions.forEach((function(t){e.raterLevel!=t.value&&2==e.raterType&&(t.disabled=!1)}))}))},userSelectChange:function(e,t){var a=this;if(e[0].length&&e[1].length){var i=e[0][0],s=e[1][0].employeeName,l=Object(y["z"])(this.processSettingScoringBOList);l.splice(t,1),l.forEach((function(e){e.rater==i&&(a.$set(a.processSettingScoringBOList[t],"rater",""),a.$message.error("".concat(s,"已经存在")))}))}}}},Ge=Xe,Ze=(a("6880"),Object(S["a"])(Ge,Ye,Qe,!1,null,null,null)),et=Ze.exports,tt={name:"WorkflowSetting",components:{CreateSections:ye["a"],GradingProcess:et,WkUserSelect:Ke["a"]},inject:{disabled:{default:!1}},props:{flowForm:Object,verify:Object},data:function(){return{flowFormFieldList:[{label:"指标制定",prop:"quotaSettingType",fieldName:"quotaSettingType",rules:{required:!0,message:"请选择",trigger:"change"}},{fieldName:"targetConfirmation"},{fieldName:"processSettingScoringBOList"},{fieldName:"resultAudit"},{fieldName:"resultConfirmation"}],scorerOptions:[{label:"上级",value:1},{label:"部门负责人",value:2},{label:"指定评分人",value:3},{label:"被考核人",value:4}],resultsAudit:[{label:"上级",value:1},{label:"部门负责人",value:2},{label:"指定评分人",value:3}],appealList:[{label:"上级",value:1},{label:"部门负责人",value:2},{label:"指定评分人",value:3}],superiorOptions:[{label:"直属上级",value:1},{label:"第二级上级",value:2},{label:"第三级上级",value:3},{label:"第四级上级",value:4},{label:"第五级上级",value:5},{label:"第六级上级",value:6},{label:"第七级上级",value:7},{label:"第八级上级",value:8},{label:"第九级上级",value:9},{label:"第十级上级",value:10}],departmentOptions:[{label:"直属部门负责人",value:1},{label:"第二级部门负责人",value:2},{label:"第三级部门负责人",value:3},{label:"第四级部门负责人",value:4},{label:"第五级部门负责人",value:5},{label:"第六级部门负责人",value:6},{label:"第七级部门负责人",value:7},{label:"第八级部门负责人",value:8},{label:"第九级部门负责人",value:9},{label:"第十级部门负责人",value:10}]}},watch:{"flowForm.processSettingResultAuditBOList":{handler:function(e){var t=this;e.forEach((function(e){t.resultsAudit.forEach((function(t){e.auditType==t.value&&(t.disabled=!0)}))}))},immediate:!0,deep:!0},"flowForm.resultAudit":{handler:function(e){e||this.resultsAudit.forEach((function(e){e.disabled=!1}))},immediate:!0,deep:!0},"flowForm.resultConfirmation":{handler:function(e){e||this.appealList.forEach((function(e){e.disabled=!1}))},immediate:!0,deep:!0},"flowForm.processSettingResultConfirmationBOList":{handler:function(e){var t=this;e.forEach((function(e){t.appealList.forEach((function(t){e.confirmationType==t.value&&(t.disabled=!0)}))}))},immediate:!0,deep:!0},verify:{handler:function(e){var t=this;"flow"!=e.tab||e.pass||this.$refs.form.validate((function(a){1!=t.flowForm.processSettingScoringBOList.length?t.$refs.grading[0].$refs.form.validate((function(i){if(i&&a){var s=0;t.flowForm.processSettingScoringBOList.forEach((function(e){e.weight&&(s+=e.weight)})),100==s?t.$emit("pass",e.next,e.tab,e.type):t.$message.error("评分总和需等于100%")}else t.$message.error("请完善信息")})):t.$message.error("请至少设置一个评分人")}))},deep:!0}},methods:{radioChange:function(e){e&&(this.$set(this.flowForm.processSettingTargetConfirmationBO,"confirmationType",""),this.$set(this.flowForm.processSettingTargetConfirmationBO,"confirmationLevel",""),this.$set(this.flowForm.processSettingTargetConfirmationBO,"identifyingPeople",""),this.$set(this.flowForm,"targetConfirmation",!1))},targetConfirmationChange:function(e){e||(this.$set(this.flowForm.processSettingTargetConfirmationBO,"confirmationType",""),this.$set(this.flowForm.processSettingTargetConfirmationBO,"confirmationLevel",""),this.$set(this.flowForm.processSettingTargetConfirmationBO,"identifyingPeople",""))},confirmationTypeChange:function(e){1==e||2==e?(this.$set(this.flowForm.processSettingTargetConfirmationBO,"confirmationLevel",1),this.$set(this.flowForm.processSettingTargetConfirmationBO,"identifyingPeople","")):(3==e||4==e)&&(this.$set(this.flowForm.processSettingTargetConfirmationBO,"identifyingPeople",""),this.$set(this.flowForm.processSettingTargetConfirmationBO,"confirmationLevel",""))},resultAuditChange:function(e){e||this.$set(this.flowForm,"processSettingResultAuditBOList",[{auditType:""}])},resultsLevelChange:function(e,t){1==e||2==e?this.$set(this.flowForm.processSettingResultAuditBOList[t],"level",1):3==e&&this.$set(this.flowForm.processSettingResultAuditBOList[t],"designatedPerson",""),this.resultsAudit.forEach((function(t){t.value==e?t.disabled=!0:t.disabled=!1}))},addResultsAudit:function(){this.flowForm.processSettingResultAuditBOList.push({auditType:""})},handleClose:function(e,t){var a=this;"audit"==t?1==this.flowForm.processSettingResultAuditBOList.length?this.$message.error("至少存在一个确认人"):(this.flowForm.processSettingResultAuditBOList.splice(e,1),this.flowForm.processSettingResultAuditBOList.forEach((function(e){a.resultsAudit.forEach((function(t){e.auditType!=t.value&&(t.disabled=!1)}))}))):"appeal"==t&&(1==this.flowForm.processSettingResultConfirmationBOList.length?this.$message.error("至少存在一个申诉节点"):(this.flowForm.processSettingResultConfirmationBOList.splice(e,1),this.flowForm.processSettingResultConfirmationBOList.forEach((function(e){a.appealList.forEach((function(t){e.confirmationType!=t.value&&(t.disabled=!1)}))}))))},addAppeal:function(){this.flowForm.processSettingResultConfirmationBOList.push({confirmationType:""})},appealListChange:function(e){e?(this.$set(this.flowForm,"overdueDays",2),this.$set(this.flowForm,"beOverdueType",1)):(this.$set(this.flowForm,"processSettingResultConfirmationBOList",[{confirmationType:""}]),this.$set(this.flowForm,"overdueDays",""),this.$set(this.flowForm,"beOverdueType",""))},appealLevelChange:function(e,t){1==e||2==e?this.$set(this.flowForm.processSettingResultConfirmationBOList[t],"level",1):3==e&&this.$set(this.flowForm.processSettingResultConfirmationBOList[t],"designatedUserId",""),this.appealList.forEach((function(t){t.value==e?t.disabled=!0:t.disabled=!1}))}}},at=tt,it=(a("aec5"),Object(S["a"])(at,We,Me,!1,null,"7af68058",null)),st=it.exports,lt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"base-info-set",staticStyle:{padding:"0 20px",overflow:"auto"},attrs:{"body-style":{height:"100%"}}},[a("el-form",{ref:"resultForm",attrs:{model:e.resultForm,rules:e.baseRules}},[a("el-form-item",[a("el-select",{attrs:{disabled:e.disabled},on:{change:e.getResultTemplateList},model:{value:e.resultForm.resultTemplateId,callback:function(t){e.$set(e.resultForm,"resultTemplateId",t)},expression:"resultForm.resultTemplateId"}},e._l(e.resultTemplateOption,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),a("el-form-item",[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("span",{staticClass:"moneny-title"},[e._v("同步到薪资")]),e._v(" "),a("el-switch",{staticStyle:{height:"30px"},attrs:{disabled:e.disabled,"active-color":"#00875A","inactive-color":"#7f7f7f"},model:{value:e.resultForm.syncToSalary,callback:function(t){e.$set(e.resultForm,"syncToSalary",t)},expression:"resultForm.syncToSalary"}})],1)]),e._v(" "),e.resultForm.syncToSalary?a("el-form-item",{attrs:{label:"参与计薪月份",prop:"paidForMonth",rules:{required:!0,message:"请选择",trigger:"change"}}},[a("el-date-picker",{attrs:{disabled:e.disabled,type:"month","value-format":"yyyy-MM",placeholder:"请选择"},model:{value:e.resultForm["paidForMonth"],callback:function(t){e.$set(e.resultForm,"paidForMonth",t)},expression:"resultForm['paidForMonth']"}})],1):e._e(),e._v(" "),a("div",{staticClass:"other-info-section"},[a("el-form-item",{attrs:{prop:"appraisalPlanResultSettingLevelList"}},[e._l(e.resultForm.appraisalPlanResultSettingLevelList,(function(t,i){return a("flexbox",{key:i,staticClass:"weight-data-row"},[a("div",{staticClass:"column"},[0==i?a("div",{staticClass:"label"},[e._v("等级")]):e._e(),e._v(" "),a("el-form-item",{attrs:{prop:"appraisalPlanResultSettingLevelList["+i+"].levelName",rules:{required:!0,message:"请输入",trigger:"change"},label:""}},[a("el-input",{staticStyle:{width:"200px"},attrs:{disabled:e.disabled,type:"text"},model:{value:t.levelName,callback:function(a){e.$set(t,"levelName",a)},expression:"scoreLevel.levelName"}})],1)],1),e._v(" "),a("div",{staticClass:"column"},[0==i?a("div",{staticClass:"label"},[e._v("分数范围")]):e._e(),e._v(" "),a("flexbox",{staticClass:"flex-box"},[a("el-form-item",{attrs:{prop:"appraisalPlanResultSettingLevelList["+i+"].scoreLowerLimit",rules:e.getScoreRules(t,i,"min"),label:""}},[a("el-input",{directives:[{name:"wk-number",rawName:"v-wk-number",value:"positiveInt",expression:"'positiveInt'"}],staticStyle:{width:"200px",height:"34px"},attrs:{disabled:e.disabled,type:"text"},on:{blur:function(t){e.inputBlurValidate("score",i,"min")}},model:{value:t.scoreLowerLimit,callback:function(a){e.$set(t,"scoreLowerLimit",a)},expression:"scoreLevel.scoreLowerLimit"}},[a("template",{slot:"append"},[e._v("分")])],2)],1),e._v(" "),a("div",{staticClass:"range"},[e._v("~")]),e._v(" "),a("el-form-item",{attrs:{prop:"appraisalPlanResultSettingLevelList["+i+"].scoreUpperLimit",rules:e.getScoreRules(t,i,"max"),label:""}},[a("el-input",{directives:[{name:"wk-number",rawName:"v-wk-number",value:"positiveInt",expression:"'positiveInt'"}],staticStyle:{width:"200px",height:"34px"},attrs:{disabled:e.disabled,type:"text"},on:{blur:function(t){e.inputBlurValidate("score",i,"max")}},model:{value:t.scoreUpperLimit,callback:function(a){e.$set(t,"scoreUpperLimit",a)},expression:"scoreLevel.scoreUpperLimit"}},[a("template",{slot:"append"},[e._v("分")])],2)],1)],1)],1),e._v(" "),e.resultForm.syncToSalary?a("div",{staticClass:"column input-number"},[0==i?a("div",{staticClass:"label"},[e._v("系数")]):e._e(),e._v(" "),a("flexbox",[a("el-form-item",{attrs:{prop:"appraisalPlanResultSettingLevelList["+i+"].coefficient",rules:[{required:!0,message:"请输入",trigger:"blur"},{pattern:/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/,message:"请输入正确的格式,可保留两位小数"}],label:""}},[a("el-input",{staticStyle:{width:"200px"},attrs:{disabled:e.disabled,type:"number"},model:{value:t.coefficient,callback:function(a){e.$set(t,"coefficient",a)},expression:"scoreLevel.coefficient"}})],1)],1)],1):e._e(),e._v(" "),e.disabled?e._e():a("i",{staticClass:"el-icon-remove",class:{"is-first":0==i},on:{click:function(t){e.deleteItemClick(e.resultForm.appraisalPlanResultSettingLevelList,i)}}})])})),e._v(" "),a("div",{staticClass:"add-bar"},[a("el-button",{attrs:{icon:"el-icon-plus",type:"text",disabled:e.disabled},on:{click:e.addScoreLevelClick}},[e._v("\n            添加考核等级\n          ")])],1)],2)],1)],1)],1)},nt=[],rt=a("7caf"),ot=a("da92"),ct={name:"ResultSet",components:{},inject:{disabled:{default:!1}},props:{resultForm:Object,verify:Object,resultTemplateId:String,status:[String,Number]},data:function(){return{loading:!1,resultTemplateOption:[],baseRules:{resultTemplateName:{required:!0,message:"不能为空",trigger:["blur","change"]},appraisalPlanResultSettingLevelList:{required:!0,message:"请选择",trigger:["blur","change"]}}}},watch:{"resultForm.salary":{handler:function(e){e||this.$set(this.resultForm,"PaidForMonth","")}},verify:{handler:function(e){var t=this;"result"!=e.tab||e.pass||this.$refs.resultForm.validate((function(a){a?t.$emit("pass",e.next,e.tab,e.type):t.$message.error("请完善表单信息")}))},deep:!0}},created:function(){this.getResultList()},methods:{getResultList:function(){var e=this;Object(rt["d"])().then((function(t){var a=t.data.list||[];a.forEach((function(t){e.resultTemplateOption.push({label:t.resultTemplateName,value:t.resultTemplateId})})),e.resultTemplateId&&e.resultTemplateOption.some((function(t){return t.value==e.resultTemplateId}))?e.$set(e.resultForm,"resultTemplateId",e.resultTemplateOption[0].value):e.$set(e.resultForm,"resultTemplateId",""),!e.status&&e.resultForm.resultTemplateId&&e.getResultTemplateList(e.resultForm.resultTemplateId)}))},getResultTemplateList:function(e){var t=this;this.loading=!0,Object(rt["a"])(e).then((function(e){t.$set(t.resultForm,"appraisalPlanResultSettingLevelList",e.data.resultTemplateLevelBOList),t.loading=!1}))},deleteItemClick:function(e,t){e.splice(t,1)},addScoreLevelClick:function(){this.resultForm.appraisalPlanResultSettingLevelList.push({levelName:""})},getProportionRules:function(e,t,a){var i=this,s=function(e,t,a){if(t<0||t>100||null===t||void 0===t||""===t)a(new Error("范围在0-100之间"));else if(parseInt(e.data.maxNum||0)<parseInt(e.data.minNum||0))a(new Error("下限值不能大于上限值"));else if(i.resultForm.appraisalPlanResultSettingLevelList.length){var s=0,l=0;i.resultForm.appraisalPlanResultSettingLevelList.forEach((function(e){s=ot["a"].plus(s,e.minNum),l=ot["a"].plus(l,e.maxNum)})),s>100&&"min"==e.type?e.index==i.resultForm.appraisalPlanResultSettingLevelList.length-1&&a(new Error("下限值之和不能大于100")):l<100&&"max"==e.type?e.index==i.resultForm.appraisalPlanResultSettingLevelList.length-1&&a(new Error("上限值应大于等于100")):a()}};return{validator:s,trigger:["blur"],data:e,index:t,type:a}},getScoreRules:function(e,t,a){var i=this,s=function(e,t,a){if(t<0||t>100||null===t||void 0===t||""===t)a(new Error("范围在0-100之间"));else if(parseInt(e.data.scoreUpperLimit||0)<parseInt(e.data.scoreLowerLimit||0))a(new Error("下限值不能大于上限值"));else{if(e.index>0){var s=i.resultForm.appraisalPlanResultSettingLevelList[e.index-1];if(parseInt(s.scoreLowerLimit||0)<=parseInt(t||0))return void a(new Error("须小于上一等级下限值"))}a()}};return{validator:s,trigger:["blur"],data:e,index:t,type:a}},inputBlurValidate:function(e,t,a){"num"==e?this.$refs.resultForm.validateField("appraisalPlanResultSettingLevelList[".concat(t,"].").concat("min"==a?"maxNum":"minNum")):"score"==e&&this.$refs.resultForm.validateField("appraisalPlanResultSettingLevelList[".concat(t,"].").concat("min"==a?"maxScore":"minScore"))}}},ut=ct,dt=(a("a9ab"),Object(S["a"])(ut,lt,nt,!1,null,"7dda6e8f",null)),pt=dt.exports,mt={name:"BusinessApproveFlowCreate",components:{WkBackgroudTabs:ve,BaseInfoSet:Pe,IndicatorSettings:Ue,WorkflowSetting:st,ResultSet:pt},filters:{},provide:function(){return{disabled:this.disableStatus}},props:{inspectionDetial:Object},data:function(){return{loading:!1,height:document.documentElement.clientHeight-100,tabs:[{label:"1.基础设置",value:"base"},{label:"2.指标设置",value:"target"},{label:"3.流程设置",value:"flow"},{label:"4.结果设置",value:"result"}],tabIndex:"base",verify:{},fieldsForm:{baseForm:{inspectionScope:[{type:""}],appraisalCycleType:1},appraisalPlanQuotaSettingBO:{scoreCalculation:1,upperLimitType:1,upperLimitScore:100,quotaSettingDimensionBOList:[]},appraisalPlanProcessSettingBO:{quotaSettingType:1,processSettingScoringBOList:[{}],processSettingResultAuditBOList:[{auditType:""}],processSettingResultConfirmationBOList:[{confirmationType:""}],processSettingTargetConfirmationBO:{confirmationLevel:"",confirmationType:"",identifyingPeople:""}},appraisalEmployeeResultSettingBO:{resultTemplateId:"",syncToSalary:!1,paidForMonth:"",appraisalPlanResultSettingLevelList:[{levelName:"S",scoreLowerLimit:"85",scoreUpperLimit:"100",minNum:"10",maxNum:"15",coefficient:""},{levelName:"A",scoreLowerLimit:"75",scoreUpperLimit:"84",minNum:"50",maxNum:"55",coefficient:""},{levelName:"B",scoreLowerLimit:"60",scoreUpperLimit:"74",minNum:"30",maxNum:"35",coefficient:""},{levelName:"C",scoreLowerLimit:"0",scoreUpperLimit:"59",minNum:"10",maxNum:"15",coefficient:""}]}},pass:[],status:null,targetTemplateName:"",resultTemplateId:""}},computed:{disableStatus:function(){return 3==this.status||4==this.status}},watch:{fieldsForm:{handler:function(){var e=this;this.pass.forEach((function(t,a){t==e.tabIndex&&e.pass.splice(a,1)}))},deep:!0},inspectionDetial:{handler:function(e){if(Object.keys(e).length){var t=Object(y["z"])(e);this.status=t.status,this.targetTemplateName=t.appraisalTemplateName,this.resultTemplateId=t.resultTemplateId;var a={appraisalCycleType:t.appraisalCycleType,appraisalCycle:2==t.appraisalCycle.split(",").length?t.appraisalCycle.split(","):t.appraisalCycle,appraisalIllustrate:t.appraisalIllustrate,appraisalPlanId:t.appraisalPlanId,appraisalPlanName:t.appraisalPlanName,appraisalTemplateId:t.appraisalTemplateId,inspectionScope:t.inspectionScope,quarter:t.quarter},i=Object(l["a"])({},t.appraisalPlanQuotaSettingVO);i.quotaSettingDimensionVOList.forEach((function(e){e.quotaSettingDimensionQuotaBOList=e.quotaSettingDimensionQuotaVOList,delete e.quotaSettingDimensionQuotaVOList})),i.quotaSettingDimensionBOList=i.quotaSettingDimensionVOList,delete i.quotaSettingDimensionVOList;var s=Object(l["a"])({},t.appraisalPlanProcessSettingVO);s.processSettingScoringVOList.push({}),s.processSettingScoringBOList=s.processSettingScoringVOList,s.processSettingResultAuditBOList=s.processSettingResultAuditVOList,s.processSettingResultConfirmationBOList=s.processSettingResultConfirmationVOList,s.processSettingTargetConfirmationBO=s.processSettingTargetConfirmationVO,delete s.processSettingScoringVOList,delete s.processSettingResultAuditVOList,delete s.processSettingResultConfirmationVOList,delete s.processSettingTargetConfirmationVO;var n=Object(l["a"])({},t.appraisalPlanResultSettingVO);this.fieldsForm.baseForm=a,this.fieldsForm.appraisalEmployeeResultSettingBO=n,this.fieldsForm.appraisalPlanQuotaSettingBO=i,this.fieldsForm.appraisalPlanProcessSettingBO=s,this.pass.push("base","target","flow","result")}},immediate:!0,deep:!0}},mounted:function(){var e=this;this.$el.style.zIndex=Object(y["p"])(),document.body.appendChild(this.$el),window.onresize=function(){e.height=document.documentElement.clientHeight-100}},destroyed:function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},methods:{sendClick:function(){for(var e=0;e<this.tabs.length;e++)if(!this.pass.includes(this.tabs[e].value)){if(e!=this.tabs.length-1){this.tabClick(this.tabs[e+1].value,"submit");break}this.tabClick(this.tabs[e].value,"submit")}4==this.pass.length&&this.tabClick(this.tabIndex,"submit")},submiteRequest:function(){var e=this;this.loading=!0;var t=Object(y["z"])(this.fieldsForm);delete t.baseForm;var a=Object(l["a"])(Object(l["a"])({},this.fieldsForm.baseForm),t);a.appraisalPlanProcessSettingBO.processSettingScoringBOList.pop(),Array.isArray(a.appraisalCycle)&&(a.appraisalCycle=a.appraisalCycle.toString());var i=a.hasOwnProperty("appraisalPlanId")?"编辑成功":"新建成功";Object(n["h"])(a).then((function(t){e.closeClick(),e.$emit("createSuccess"),e.$message.success(i),e.loading=!1})).catch((function(){e.loading=!1}))},closeClick:function(){this.$emit("close")},tabClick:function(e,t){var a=this;this.tabs.forEach((function(i){i.value==e&&(a.verify={tab:a.tabIndex,pass:!1,next:e,type:t})}))},tabPass:function(e,t,a){this.pass.includes(t)||this.pass.push(t),4==this.pass.length&&a?this.submiteRequest():this.tabIndex=e}}},ft=mt,ht=(a("eb66b"),Object(S["a"])(ft,ce,ue,!1,null,"a7d6dfba",null)),vt=ht.exports,gt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("slide-view",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"d-view",attrs:{"listener-ids":e.listenerIDs,"no-listener-ids":e.noListenerIDs,"no-listener-class":e.noListenerClass,"body-style":{padding:0,height:"100%",background:"white"}},on:{afterEnter:e.viewAfterEnter,close:e.hideView}},[e.detailData?a("flexbox",{staticClass:"side-detail-main",staticStyle:{padding:"0 15px"},attrs:{direction:"column",align:"stretch"}},[a("wk-detail-header",{attrs:{subtitle:"绩效详情",title:e.detailData.appraisalName},on:{edit:e.editClick,"command-select":e.commandSelect}},[a("template",{slot:"left"},[e.detail?[2==e.detail.status?a("span",{staticClass:"tip-btn-start"},[e._v("未开始")]):e._e(),e._v(" "),3==e.detail.status?a("span",{staticClass:"tip-btn-ing"},[e._v("进行中")]):e._e(),e._v(" "),4==e.detail.status?a("span",{staticClass:"tip-btn-end"},[e._v("已归档")]):e._e()]:e._e()],2),e._v(" "),a("template",{slot:"right"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.headerRightClick("confirm")}}},[e._v("确定启动")]),e._v(" "),e.addEmployeeAuth?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.headerRightClick("add")}}},[e._v("新增考核人员")]):e._e()],1)],2),e._v(" "),a("div",{staticClass:"d-container-body"},[a("detail-head-base",{attrs:{list:e.headDetails}}),e._v(" "),a("div",{staticClass:"top-padding"},[a("flexbox",{staticClass:"filter-wrap"},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入姓名"},nativeOn:{keyup:function(t){return!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchInput(t)}},model:{value:e.search,callback:function(t){e.search="string"===typeof t?t.trim():t},expression:"search"}},[a("el-button",{attrs:{slot:"suffix",type:"icon",icon:"wk wk-sousuo"},on:{click:e.searchInput},slot:"suffix"})],1),e._v(" "),a("el-cascader",{staticStyle:{"margin-left":"10px"},attrs:{options:e.options,props:{multiple:!0,emitPath:!1},"collapse-tags":"",placeholder:"请选择聘用形式",clearable:""},on:{"visible-change":e.visibleChange,"remove-tag":e.removeTag,change:e.clearCheckedNodes},model:{value:e.employStatus,callback:function(t){e.employStatus=t},expression:"employStatus"}})],1),e._v(" "),a("el-table",{staticStyle:{width:"100%","margin-top":"15px"},attrs:{id:"crm-table",data:e.list,height:e.tableHeight,stripe:""},on:{"row-click":e.handleRowClick}},[e._l(e.fieldList,(function(e,t){return a("el-table-column",{key:t,attrs:{prop:e.key,label:e.name,"min-width":e.width,"show-overflow-tooltip":""}})})),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,s=t.$index;return[e.delEmployeeAuth?a("el-button",{staticClass:"delete-btn",attrs:{type:"text"},on:{click:function(t){e.removeClick(i,s)}}},[e._v("\n                移除\n              ")]):e._e()]}}])})],2),e._v(" "),a("div",{staticClass:"p-contianer"},[a("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1),e._v(" "),e.employeeDialogShow?a("hrm-employee-dialog",{attrs:{visible:e.employeeDialogShow},on:{"update:visible":function(t){e.employeeDialogShow=t},change:e.selectChange}}):e._e()],1):e._e()],1)},bt=[],yt=a("130f"),_t=a("da37"),wt=a("94e7"),St=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{ref:"wkDialog",attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,title:e.title,"show-close":!1,width:"700px"}},[a("div",{staticClass:"form-add-dialog-body"},[a("wk-dep-user-view",{attrs:{props:{value:"employeeId",label:"employeeName",canSelectDep:!1,isHrm:!0}},on:{change:e.selectChange}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("确定")]),e._v(" "),a("el-button",{nativeOn:{click:function(t){return e.close(t)}}},[e._v("取消")])],1)])},Ct=[],xt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("flexbox",{staticClass:"wk-user-select",attrs:{align:"stretch"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"wk-user-select__left"},[a("div",{staticClass:"wk-user-select__header"},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.searchListUser,placeholder:"请输入内容"},on:{select:e.searchSelect},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[a("span",[e._v(e._s(i[e.config.label]))]),e._v(" "),a("span",{staticStyle:{color:"#6b778c"}},[e._v(e._s("("+(i.post||"暂无岗位")+")"))])]}}]),model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}})],1),e._v(" "),a("div",{staticClass:"wk-user-select__body"},[a("el-breadcrumb",{staticStyle:{padding:"5px 0"},attrs:{"separator-class":"el-icon-arrow-right"}},e._l(e.breadcrumbList,(function(t,i){return a("el-breadcrumb-item",{key:i},[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){e.breadcrumbBtn(t,i)}}},[e._v(e._s(t.label))])])}))),e._v(" "),a("div",{staticClass:"wk-user-select__list"},e._l(e.showDataList,(function(t,i){return a("flexbox",{key:i,staticClass:"wk-user-select__item"},[t.isDep&&e.config.canSelectDep||!t.isDep?a("el-checkbox",{attrs:{disabled:t.disabled},on:{change:function(a){e.dataCheckboxChange(a,t)}},model:{value:t.isCheck,callback:function(a){e.$set(t,"isCheck",a)},expression:"item.isCheck"}}):e._e(),e._v(" "),t.isDep?[a("div",{staticClass:"dep-name text-one-line"},[e._v(e._s(e.$getDeptName(t,e.config.depLabel)+(t.currentNum>0?"("+t.currentNum+")":"")))]),e._v(" "),1==t.hasChildren||t.currentNum>0?a("el-button",{attrs:{disabled:t.isCheck,type:"text",icon:"wk wk-icon-structure"},on:{click:function(a){e.lowerLevelClick(t)}}},[e._v("下级")]):e._e()]:[a("xr-avatar",{staticClass:"user-img",attrs:{disabled:"",name:e.$getUserName(t,e.config.label),size:24,src:e.$getUserImg(t)}}),e._v(" "),a("div",{staticClass:"user-info"},[a("div",{staticClass:"user-name text-one-line"},[e._v(e._s(e.$getUserName(t,e.config.label)))]),e._v(" "),a("div",{staticClass:"user-post"},[e._v(e._s(t.post||"暂无岗位"))])])]],2)})))],1)]),e._v(" "),a("div",{staticClass:"wk-user-select__right"},[a("flexbox",{staticClass:"user-selects",attrs:{wrap:"wrap"}},[e._l(e.selectDeps,(function(t,i){return a("span",{key:"dep"+i,staticClass:"user-item text-one-line"},[e._v(e._s(t[e.config.depLabel]+(t.currentNum>0?"("+t.currentNum+")":""))+"\n        "),a("i",{staticClass:"delete-icon el-icon-close",on:{click:function(a){a.stopPropagation(),e.deleteDepUser("dep",i,t,e.selectDeps)}}})])})),e._v(" "),e._l(e.selectUsers,(function(t,i){return a("span",{key:"user"+i,staticClass:"user-item text-one-line"},[e._v(e._s(e.$getUserName(t,e.config.label))+"\n        "),a("i",{staticClass:"delete-icon el-icon-close",on:{click:function(a){a.stopPropagation(),e.deleteDepUser("user",i,t,e.selectUsers)}}})])}))],2)],1)])},kt=[],Tt=(a("466d"),a("b0c0"),a("7078")),Ot=a("e17e"),Lt=a("2934"),Ft=a("d22a"),Nt={name:"WkDepUserView",components:{},props:{props:{type:Object,default:function(){return{}}},depValue:{type:Array,default:function(){return[]}},userValue:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,searchInput:"",searchUserList:[],breadcrumbList:[],showDataList:[],selectUsers:[],selectDeps:[]}},computed:{config:function(){var e={value:"userId",label:"realname",depValue:"id",depLabel:"name",canSelectDep:!0,userOptions:null,radio:!1,isHrm:!1,request:null,searchParams:null},t=this.props||{};return Object(l["a"])(Object(l["a"])({},e),t)}},watch:{selectUsers:function(){this.selectChange()},selectDeps:function(){this.selectChange()}},created:function(){if(this.selectUsers=this.userValue,this.selectDeps=this.depValue,this.config.userOptions){var e=this.config.userOptions;this.handleArrayCheckValue("user",e,this.selectUsers),this.showDataList=e}else this.getDepUserList(0)},mounted:function(){},beforeDestroy:function(){},methods:{searchListUser:function(e,t){var a=this;if(this.searchUserList&&this.searchUserList.length||this.config.userOptions){var i=this.config.userOptions||this.searchUserList;t(e?i.filter((function(t){return Ft["a"].match(a.$getUserName(t,a.config.label)||"",e)})):i)}else{var s=this.config.isHrm?Tt["F"]:Lt["k"],n={pageType:0};this.config.searchParams&&(n=Object(l["a"])(Object(l["a"])({},n),this.config.searchParams)),s(n).then((function(i){a.searchUserList=i.data.hasOwnProperty("list")?i.data.list||[]:i.data||[],t(e?a.searchUserList.filter((function(t){return Ft["a"].match(a.$getUserName(t,a.config.label)||"",e)})):a.searchUserList)})).catch((function(){}))}},searchSelect:function(e){var t=this.config.value,a=this.selectUsers.map((function(e){return e[t]})),i=e[t];if(!a.includes(i)){this.config.radio?this.selectUsers=[e]:this.selectUsers.push(e);for(var s=0;s<this.showDataList.length;s++){var l=this.showDataList[s];if(!l.isDep&&i==l[t]){l.isCheck=!0;break}}}},getDepUserList:function(e,t){var a=this;this.loading=!0;var i=this.config.isHrm?Tt["C"]:Ot["a"];this.config.request&&(i=this.config.request),i(e).then((function(i){var s=i.data||{},l=s.deptList||[];l.forEach((function(e){e.isDep=!0})),a.handleArrayCheckValue("dep",l,a.selectDeps);var n=s.employeeList||s.userList||[];a.handleArrayCheckValue("user",n,a.selectUsers),a.showDataList=l.concat(n),0==e?a.breadcrumbList=[{label:"组织",deptList:l,employeeList:n}]:a.breadcrumbList.push({label:t.name,deptList:l,employeeList:n}),a.loading=!1})).catch((function(){a.loading=!1}))},handleArrayCheckValue:function(e,t,a){var i="user"==e?this.config.value:this.config.depValue,s=a.map((function(e){return e[i]}));t.forEach((function(e){e.isCheck=s.includes(e[i])}))},breadcrumbBtn:function(e,t){t+1<=this.breadcrumbList.length-1&&this.breadcrumbList.splice(t+1,this.breadcrumbList.length-1);var a=e.deptList;this.handleArrayCheckValue("dep",a,this.selectDeps);var i=e.employeeList;this.handleArrayCheckValue("user",i,this.selectUsers),this.showDataList=a.concat(i)},dataCheckboxChange:function(e,t){if(t.isDep)if(e)this.selectDeps.push(t);else{var a=this.getArrayIndexWithItem(this.selectDeps,t,this.config.depValue);a>=0&&this.selectDeps.splice(a,1)}else if(e)this.config.radio?(this.selectUsers=[t],this.handleArrayCheckValue("user",this.showDataList,this.selectUsers)):this.selectUsers.push(t);else{var i=this.getArrayIndexWithItem(this.selectUsers,t,this.config.value);i>=0&&this.selectUsers.splice(i,1)}},getArrayIndexWithItem:function(e,t,a){for(var i=0;i<e.length;i++){var s=e[i];if(s[a]==t[a])return i}return-1},lowerLevelClick:function(e){this.showDataList=[],this.getDepUserList(e.deptId,e)},deleteDepUser:function(e,t,a,i){i.splice(t,1);for(var s="user"==e?this.config.value:this.config.depValue,l=a[s],n=0;n<this.showDataList.length;n++){var r=this.showDataList[n];if(r.isDep){if("dep"==e&&l==r[s]){r.isCheck=!1;break}}else if("user"==e&&l==r[s]){r.isCheck=!1;break}}},selectChange:function(){this.$emit("change",this.selectUsers,this.selectDeps)}}},It=Nt,Dt=(a("f5e4"),Object(S["a"])(It,xt,kt,!1,null,"6e83bb65",null)),jt=Dt.exports,$t={name:"HrmEmployeeDialog",components:{WkDepUserView:jt},mixins:[O["a"]],props:{visible:{type:Boolean,required:!0,default:!1}},data:function(){return{loading:!1,title:"选择员工",users:[],deps:[]}},computed:{},watch:{visible:{handler:function(e){},immediate:!0}},mounted:function(){},methods:{close:function(){this.$emit("update:visible",!1)},selectChange:function(e,t){this.users=e||[],this.deps=t||[]},handleConfirm:function(){this.$emit("change",this.users,this.deps)}}},Pt=$t,Et=(a("e3308"),Object(S["a"])(Pt,St,Ct,!1,null,"73835331",null)),At=Et.exports,Bt={name:"NotStartedDetail",components:{SlideView:yt["a"],WkDetailHeader:_t["a"],DetailHeadBase:wt["a"],HrmEmployeeDialog:At},inject:["editAuth"],props:{id:[String,Number],listenerIDs:{type:Array,default:function(){return["crm-main-container"]}},noListenerIDs:{type:Array,default:function(){return[]}},noListenerClass:{type:Array,default:function(){return["el-table__body","org-tree-node-label"]}},detail:{type:Object,default:function(){return null}}},data:function(){return{loading:!1,detailData:null,tabCurrentName:"baseInfo",dropdownItems:[{icon:"wk wk-edit",label:"编辑",command:"edit"}],isCreate:!1,list:[],fieldList:[{field:"employeeName",name:"姓名"},{field:"deptName",name:"部门"},{field:"raterName",name:"自评"}],tableHeight:"600px",search:"",employStatus:[],options:[{label:"正式",children:[{value:1,label:"正式"},{value:2,label:"试用"}]},{label:"非正式",children:[{value:3,label:"实习"},{value:4,label:"兼职"},{value:5,label:"劳务"},{value:6,label:"顾问"},{value:7,label:"返聘"},{value:8,label:"外包"}]}],currentPage:1,pageSize:15,pageSizes:[15,30,60,100],total:0,headDetails:[],deptSelectIds:[],employeeDialogShow:!1}},computed:Object(l["a"])(Object(l["a"])({},Object(G["b"])(["hrm"])),{},{addEmployeeAuth:function(){return this.hrm.appraisalPlan&&this.hrm.appraisalPlan.addAppraisalEmployeeList},delEmployeeAuth:function(){return this.hrm.appraisalPlan&&this.hrm.appraisalPlan.delAppraisalEmployee}}),watch:{id:function(){this.detailData=null,this.getDetial(),this.getFieldList()}},mounted:function(){this.getDetial(),this.getFieldList()},beforeDestroy:function(){},methods:{viewAfterEnter:function(){this.getDetial()},getDetial:function(){this.detailData={appraisalName:this.detail&&this.detail.appraisalPlanName};var e=[{title:"考核范围",value:""},{title:"考核周期类型",value:""},{title:"考核说明",value:""}];e[0].value=this.detail&&this.detail.inspectionScopeName,e[1].value=this.detail&&{1:"月度",2:"季度",3:"上半年",4:"下半年",5:"全年",6:"其他"}[this.detail.appraisalCycleType],e[2].value=this.detail&&this.detail.appraisalIllustrate,this.headDetails=e},getFieldList:function(){var e=this;this.loading=!0,Object(n["q"])({id:this.id}).then((function(t){e.loading=!1,e.fieldList=t.data,e.getEmployeeList()})).catch((function(){e.loading=!1}))},getEmployeeList:function(){var e=this,t={appraisalPlanId:this.id,page:this.currentPage,limit:this.pageSize};this.search&&(t.employeeNamer=this.search),this.employStatus.length&&(t.employStatus=this.employStatus),this.loading=!0,Object(n["p"])(t).then((function(t){e.list=t.data.list,e.total=t.data.totalRow,e.loading=!1})).catch((function(){e.loading=!1}))},handleSizeChange:function(e){this.pageSize=e,this.getEmployeeList()},visibleChange:function(e){e||this.getEmployeeList()},removeTag:function(){this.getEmployeeList()},clearCheckedNodes:function(){this.employStatus.length||this.getEmployeeList()},handleCurrentChange:function(e){this.currentPage=e,this.getEmployeeList()},searchInput:function(){this.getEmployeeList()},cellClassName:function(){},handleRowClick:function(){},removeClick:function(e,t){var a=this;this.$confirm("确认要移除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["l"])({appraisalPlanId:a.id,employeeIdList:[e.employeeId]}).then((function(e){a.$message.success("移除成功"),a.$emit("success"),a.getEmployeeList()})).catch((function(){}))})).catch((function(){}))},headerRightClick:function(e){var t=this;"confirm"==e?(this.loading=!0,Object(n["u"])({appraisalPlanId:this.id}).then((function(e){t.loading=!1,t.$emit("success"),t.$emit("close")})).catch((function(){t.loading=!1}))):"add"==e&&(this.employeeDialogShow=!0)},selectChange:function(e){var t=this;if(e.length){var a=this.list.map((function(e){return e.employeeId})),i=e.some((function(e){return a.includes(e.employeeId)}));if(i)return void this.$message.error("添加员工已在考核范围内，请勿重复添加");Object(n["i"])({appraisalPlanId:this.id,employeeIdList:e.map((function(e){return e.employeeId}))}).then((function(e){t.$message.success("新增成功"),t.employeeDialogShow=!1,t.$emit("success"),t.getEmployeeList()})).catch((function(){}))}},editClick:function(){this.isCreate=!0},editSuccess:function(){this.getDetial(),this.$emit("edit-success"),this.$emit("handle",{type:"edit"})},commandSelect:function(e){},hideView:function(){this.$emit("close")}}},Rt=Bt,qt=(a("e091"),Object(S["a"])(Rt,gt,bt,!1,null,"4efb4ead",null)),Vt=qt.exports,Ht=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("slide-view",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"d-view",attrs:{"listener-ids":e.listenerIDs,"no-listener-ids":e.noListenerIDs,"no-listener-class":e.noListenerClass,"body-style":{padding:0,height:"100%",background:"white"}},on:{afterEnter:e.viewAfterEnter,close:e.hideView}},[e.detailData?a("flexbox",{staticClass:"side-detail-main",staticStyle:{padding:"0 15px"},attrs:{direction:"column",align:"stretch"}},[a("wk-detail-header",{attrs:{subtitle:"绩效详情",title:e.detailData.appraisalName},on:{edit:e.editClick,"command-select":e.commandSelect}},[a("template",{slot:"left"},[e.detail?[2==e.detail.status?a("span",{staticClass:"tip-btn-start"},[e._v("未开始")]):e._e(),e._v(" "),3==e.detail.status?a("span",{staticClass:"tip-btn-ing"},[e._v("进行中")]):e._e(),e._v(" "),4==e.detail.status?a("span",{staticClass:"tip-btn-end"},[e._v("已归档")]):e._e()]:e._e()],2)],2),e._v(" "),a("div",{staticClass:"d-container-body"},[a("detail-head-base",{attrs:{list:e.headDetails}}),e._v(" "),a("div",{staticClass:"top-padding"},[a("wk-table-header",{attrs:{search:e.search,props:e.wkHeaderProps,"filter-header-props":e.wkHeaderProps.filterHeaderProps,"filter-form-props":e.wkHeaderProps.filterFormProps,fields:e.getFilterFields},on:{"update:search":function(t){e.search=t},"event-change":e.tableHeaderHandle,"filter-change":e.handleFilter},scopedSlots:e._u([{key:"custom",fn:function(t){return[a("div",{staticClass:"custom-scene"},[a("span",[e._v("显示：")]),e._v(" "),e._l(e.customScene,(function(t,i){return a("el-button",{key:i,attrs:{title:t.label,type:t.value===e.activeScene?"selected":null,icon:t.icon},on:{click:function(a){e.sceneClick(t)}}},[e._v(e._s(t.label))])}))],2)]}}])}),e._v(" "),a("el-tabs",{staticStyle:{"margin-top":"15px"},attrs:{"nav-mode":"more"},on:{"tab-click":e.tabClick},model:{value:e.tabCurrent,callback:function(t){e.tabCurrent=t},expression:"tabCurrent"}},e._l(e.tabs,(function(t,i){return a("el-tab-pane",{key:i,attrs:{label:t.label,name:t.name,lazy:""}},[a("template",{slot:"label"},[a("el-badge",{attrs:{value:t.num,hidden:t.num<=0,type:"undefined"}},[e._v("\n                "+e._s(t.label)+"\n              ")])],1)],2)}))),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{id:"crm-table",data:e.list,height:e.tableHeight,"cell-class-name":e.cellClassName,stripe:""},on:{"row-click":e.handleRowClick}},e._l(e.fieldList,(function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.field,label:t.name,"min-width":t.width,formatter:e.fieldFormatter,"show-overflow-tooltip":""}})}))),e._v(" "),a("div",{staticClass:"p-contianer"},[a("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1),e._v(" "),e.detailShow?a("indicators-detail",{attrs:{id:e.rowId,"active-tab":3,"appraisal-plan-name":e.rowAppraisalPlanName,"sub-tab-type":1},on:{"hide-view":function(t){e.detailShow=!1}}}):e._e()],1):e._e()],1)},zt=[],Ut=(a("ddb0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("slide-view",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"d-view",attrs:{"body-style":{padding:"32px 32px 0",height:"100%"},"xs-empty-icon":"nopermission","xs-empty-text":"暂无权限"},on:{close:e.hideView}},[a("div",{staticClass:"d-header"},[a("div",{staticClass:"header-user"},[a("el-avatar"),e._v(" "),a("div",{staticClass:"user-info"},[a("span",{staticClass:"user-info-label"},[e._v("姓名")]),e._v(" "),a("span",{staticClass:"user-info-name"},[e._v(e._s(e.appraisalPlanName))])])],1)]),e._v(" "),a("div",{staticStyle:{height:"calc(100% - 130px)","padding-right":"20px","overflow-y":"auto"}},[a("div",{staticClass:"desc"},[a("div",{staticClass:"desc-header"},e._l(e.headerList,(function(t,i){return a("div",{key:i,staticClass:"desc-header-item"},[a("span",[e._v(e._s(t.label))]),e._v(" "),a("span",[e._v(e._s(t.value))])])}))),e._v(" "),a("el-divider"),e._v(" "),a("div",{staticClass:"desc-target"},[a("el-steps",{attrs:{active:e.currentActive,space:150}},e._l(e.activities,(function(t,i){return a("el-step",{key:i},[a("template",{slot:"title"},[a("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"center"}},[a("span",{staticStyle:{color:"#42526e"}},[e._v(e._s(t.stageName))]),e._v(" "),t.stageName?a("span",{staticStyle:{"font-weight":"700",color:"#172b4d"}},[e._v(e._s(t.stageUserName))]):a("el-tag",{staticStyle:{width:"60px","margin-top":"10px"},attrs:{type:"info"}},[e._v(e._s("结果确认"==t.label?"待审核":"待确认"))])],1)])],2)})))],1)],1),e._v(" "),a("div",{staticClass:"d-container-body"},[a("score-and-detial",{ref:"childForm",attrs:{id:e.id,"sub-tab-type":e.subTabType,"active-tab":e.activeTab,"is-manage":!0},on:{close:e.success}})],1)])])}),Wt=[],Mt=a("c7c5"),Yt={name:"EmployeeDetails",components:{SlideView:yt["a"],ScoreAndDetial:Mt["a"]},provide:{rootTabs:{currentName:"ScoreAndDetial"}},props:{id:String,activeTab:[String,Number],subTabType:[String,Number],appraisalPlanName:String},data:function(){return{loading:!1,headerList:[{label:"考核计划",value:"",prop:"appraisalPlanName"},{label:"考核周期",value:"",prop:"appraisalCycleType"},{label:"部门",value:"",prop:"deptName"},{label:"岗位",value:"",prop:"post"},{label:"聘用形式",value:"",prop:"employmentForms"}],appraisalCycleType:{1:"月度",2:"季度",3:"上半年",4:"下半年",5:"全年"},activities:[],currentActive:null,assessmentScore:"",inspectionPeople:"",tabCurrentName:"ScoreAndDetial",assessmentDimensionList:[],quotaItem:{}}},computed:{btnHandler:function(){var e=[];return 1==this.activeTab&&e.push({label:"提交",type:"primary"}),e}},created:function(){this.getDetialHeader()},methods:{getDetialHeader:function(){var e=this;Object(d["o"])({id:this.id}).then((function(t){e.activities=t.data||[]})).catch((function(){e.hideView()})),Object(d["j"])({id:this.id}).then((function(t){var a=t.data||{};e.currentActive=a.stageSort,e.inspectionPeople=a.employeeName,e.assessmentScore=a.score,e.headerList.forEach((function(t){for(var i in a)t.prop==i&&("appraisalCycleType"==t.prop?t.value=e.appraisalCycleType[a[i]]?e.appraisalCycleType[a[i]]:a[i]:"employmentForms"==t.prop?t.value=1==a[i]?"正式":"非正式":t.value=a[i])}))}))},handlerSubmit:function(){this.$refs.childForm[0].sendClick()},hideView:function(){this.$emit("hide-view")},success:function(){this.hideView(),this.$emit("success")}}},Qt=Yt,Jt=(a("ff67"),Object(S["a"])(Qt,Ut,Wt,!1,null,"f3dace36",null)),Kt=Jt.exports,Xt={name:"OngoingDetail",components:{SlideView:yt["a"],WkDetailHeader:_t["a"],DetailHeadBase:wt["a"],WkTableHeader:r["a"],IndicatorsDetail:Kt},inject:["editAuth"],props:{id:[String,Number],listenerIDs:{type:Array,default:function(){return["crm-main-container"]}},noListenerIDs:{type:Array,default:function(){return[]}},noListenerClass:{type:Array,default:function(){return["el-table__body","org-tree-node-label"]}},detail:{type:Object,default:function(){return null}},isResult:{type:Boolean,default:function(){return!1}},queryEmployeeAppraisalAuth:Boolean},data:function(){return{loading:!1,detailData:null,headDetails:[],tabCurrent:"all",tabsNumber:{},levelTabsData:[],search:"",activeScene:1,wkHeaderProps:{showFilterView:!0,filterHeaderProps:{searchPlaceholder:"请输入姓名",tabSetShow:!1},filterFormProps:{showExport:!1,showSaveScene:!1}},list:[],fieldList:[{field:"employeeName",name:"姓名"},{field:"mobile",name:"手机号"},{field:"jobNumber",name:"工号"},{field:"deptName",name:"部门"},{field:"employmentForms",name:"聘用形式"},{field:"stageStatusName",name:"考核状态"},{field:"stageUsersName",name:"待处理人"},{field:"score",name:"评分"},{field:"level",name:"结果"}],tableHeight:"600px",currentPage:1,pageSize:15,pageSizes:[15,30,60,100],total:0,filterObj:{form:[]},detailShow:!1,rowId:null,rowAppraisalPlanName:""}},computed:{tabs:function(){var e=[];return 1==this.activeScene?e=[{label:"全部",name:"all",num:this.tabsNumber.TOTAL},{label:"目标填写",name:"1",num:this.tabsNumber.FILL},{label:"目标确认",name:"2",num:this.tabsNumber.TARGET_CONFIRMATION},{label:"执行中",name:"9",num:this.tabsNumber.EXECUTING},{label:"自评中",name:"3",num:this.tabsNumber.SELF_SCORE},{label:"他人评价",name:"4",num:this.tabsNumber.OTHER_SCORE},{label:"结果审核",name:"5",num:this.tabsNumber.RESULT_AUDIT},{label:"结果确认",name:"6,7",num:this.tabsNumber.RESULT_CONFIRMATION},{label:"已完成",name:"10",num:this.tabsNumber.END}]:2==this.activeScene&&(e=[{label:"全部",name:"all",num:this.tabsNumber.TOTAL}],this.levelTabsData.length&&this.levelTabsData.forEach((function(t){e.push({label:t.levelName,name:t.levelName,num:t.count})})),e.push({label:"未定级",name:"no",num:this.tabsNumber.UNCLASSIFIED})),e},customScene:function(){var e=[{label:"考核人员",value:1}];return this.queryEmployeeAppraisalAuth&&e.push({label:"考核结果",value:2}),e}},watch:{id:function(){this.detailData=null,this.getDetial(),this.refreshList()}},mounted:function(){this.isResult&&(this.activeScene=2,this.getLevelTabs()),this.getDetial(),this.refreshList()},beforeDestroy:function(){},methods:{viewAfterEnter:function(){this.getDetial()},getDetial:function(){this.detailData={appraisalName:this.detail&&this.detail.appraisalPlanName};var e=[{title:"考核范围",value:""},{title:"考核周期类型",value:""},{title:"考核周期",value:""},{title:"考核人数",value:""}];e[0].value=this.detail&&this.detail.inspectionScopeName,e[1].value=this.detail&&{1:"月度",2:"季度",3:"上半年",4:"下半年",5:"全年",6:"其他"}[this.detail.appraisalCycleType],e[2].value=this.detail&&this.detail.appraisalCycle,e[3].value=this.detail&&this.detail.appraisalPersons.toString(),this.headDetails=e},getLevelTabs:function(){var e=this;Object(n["e"])({id:this.id}).then((function(t){e.levelTabsData=t.data||[]})).catch((function(){}))},getTabsNum:function(){var e=this,t={1:n["g"],2:n["f"]}[this.activeScene];if(t){var a={};a["id"]=this.id,t(a).then((function(t){e.tabsNumber=t.data||{}})).catch((function(){}))}},getFilterFields:function(){var e=this;return new Promise((function(t){Object(n["r"])({appraisalPlanId:e.id}).then((function(a){var i=a.data||[];e.filterFieldList=i,t(e.filterFieldList)})).catch((function(){}))}))},getAppraisalList:function(){var e=this,t={page:this.currentPage,limit:this.pageSize,searchList:[]};if(this.filterObj&&this.filterObj.length>0){var a=this.filterObj?this.filterObj.filter((function(e){return e.values&&e.values.length>0||[5,6].includes(e.type)})):[];a.length>0&&(t.searchList=Object(y["z"])(this.filterObj))}t.searchList.push({type:1,values:[this.id],formType:"text",name:"appraisalPlanId"}),1==this.activeScene?this.tabCurrent&&!["all","0"].includes(this.tabCurrent)&&t.searchList.push({type:1,values:"6,7"==this.tabCurrent?this.tabCurrent.split(","):[this.tabCurrent],formType:"text",name:"stageStatus"}):2==this.activeScene&&(this.tabCurrent&&!["all","no"].includes(this.tabCurrent)?t.searchList.push({type:1,values:[this.tabCurrent],formType:"text",name:"level"}):this.tabCurrent&&"no"==this.tabCurrent&&t.searchList.push({type:5,values:[],formType:"text",name:"level"})),this.search&&(t.employeeName=this.search),this.loading=!0,Object(n["d"])(t).then((function(t){e.list=t.data.list,e.total=t.data.totalRow,e.loading=!1})).catch((function(){e.loading=!1}))},handleSizeChange:function(e){this.pageSize=e,this.getAppraisalList()},handleCurrentChange:function(e){this.currentPage=e,this.getAppraisalList()},tableHeaderHandle:function(e,t){"search"==e&&this.refreshList()},handleFilter:function(e){this.filterObj=e,this.refreshList()},sceneClick:function(e){this.tabCurrent="all",this.activeScene=e.value,2==this.activeScene&&this.getLevelTabs(),this.refreshList()},tabClick:function(){this.refreshList()},refreshList:function(){this.tabsNumber={},this.getTabsNum(),this.handleCurrentChange(1)},fieldFormatter:function(e,t){return"employmentForms"==t.property?["","正式","非正式"][e.employmentForms]:e[t.property]||"—"},cellClassName:function(e){e.row;var t=e.column;e.rowIndex,e.columnIndex;return"employeeName"===t.property?"can-visit--underline":""},handleRowClick:function(e,t,a){"employeeName"===t.property&&(this.rowId=e.appraisalEmployeeId,this.rowAppraisalPlanName=e.employeeName,this.detailShow=!0)},editClick:function(){},editSuccess:function(){this.getDetial(),this.$emit("edit-success"),this.$emit("handle",{type:"edit"})},commandSelect:function(e){},hideView:function(){this.$emit("close")}}},Gt=Xt,Zt=(a("e684"),Object(S["a"])(Gt,Ht,zt,!1,null,"da98f36c",null)),ea=Zt.exports,ta={name:"KpiAssessmentIndex",components:{XrHeader:o["a"],EmployeesView:oe,KpiAssessmentPlanCreate:vt,WkTableHeader:r["a"],NotStartedDetail:Vt,OngoingDetail:ea},provide:function(){return{editAuth:this.editAuth}},beforeRouteUpdate:function(e,t,a){e.query.tabType&&(this.tabType=e.query.tabType),this.refreshList(),a()},data:function(){return{loading:!1,isCreate:!1,tabShowType:"list",list:[],currentPage:1,pageSize:15,pageSizes:[15,30,60,100],total:0,tabType:"0",tabLeftList:[{label:"未开始考核",name:"0",num:0},{label:"进行中考核",name:"5",num:0},{label:"已归档",name:"4",num:0}],tabRightList:[{label:"目标填写/目标确认中",name:"1",num:0},{label:"结果评定中",name:"2",num:0},{label:"结果确认中",name:"3",num:0}],stepList:["发起考核","填写目标/确认目标","评定结果","确认结果","考核归档"],rowId:null,rowData:null,rowStatus:null,showDview:!1,rowOngoingId:null,rowOngoingData:null,isResult:!1,showOngoingDview:!1,employeesViewData:{},employeesViewShow:!1,search:"",activeTab:2,sceneOptions:[{label:"未开始考核",value:2,num:"0"},{label:"进行中",value:3,num:"0"},{label:"已归档",value:4,num:"0"}],wkHeaderProps:{showFilterView:!1,filterHeaderProps:{searchPlaceholder:"请输入考核指标名称",tabSetShow:!1},filterFormProps:{showSaveScene:!1}},appraisalCycleType:{1:"月度",2:"季度",3:"上半年",4:"下半年",5:"全年",6:"其他"},tableHeight:document.documentElement.clientHeight-260,fieldList:[],inspectionDetial:{}}},computed:Object(l["a"])(Object(l["a"])({},Object(G["b"])(["hrm"])),{},{kpiAuth:function(){return this.hrm.appraisalPlan},viewListAuth:function(){return this.kpiAuth&&this.kpiAuth.queryPageList},createAuth:function(){return this.kpiAuth&&this.kpiAuth.addAppraisalPlan},deleteAuth:function(){return this.kpiAuth&&this.kpiAuth.delAppraisalPlan},delOfFileAuth:function(){return this.kpiAuth&&this.kpiAuth.delAppraisalPlanOfFile},checkAppraisalPlanAuth:function(){return this.kpiAuth&&this.kpiAuth.checkAppraisalPlan},querySettingAuth:function(){return this.kpiAuth&&this.kpiAuth.querySetting},terminationPlanAuth:function(){return this.kpiAuth&&this.kpiAuth.terminationPlan},openScoringAuth:function(){return this.kpiAuth&&this.kpiAuth.openScoring},toInterviewAuth:function(){return this.kpiAuth&&this.kpiAuth.toInterview},placeOnFileAuth:function(){return this.kpiAuth&&this.kpiAuth.placeOnFile},quotaInformationAuth:function(){return this.kpiAuth&&this.kpiAuth.quotaInformation},queryEmployeeAppraisalAuth:function(){return this.kpiAuth&&this.kpiAuth.queryAppraisalResultPageList}}),watch:{},created:function(){var e=this;window.onresize=function(){e.tableHeight=document.documentElement.clientHeight-260},this.$route.query.tabType&&(this.tabType=this.$route.query.tabType),this.refreshList()},mounted:function(){this.initTask()},methods:{showTypeChange:function(e){this.tabShowType=e},createClick:function(){this.inspectionDetial={},this.isCreate=!0},createSaveSuccess:function(){this.refreshList()},refreshList:function(){this.getTabsNum(),this.handleCurrentChange(1)},handleSizeChange:function(e){this.pageSize=e,this.getFieldList()},handleCurrentChange:function(e){this.currentPage=e,this.getFieldList()},getTabsNum:function(){var e=this;Object(n["o"])().then((function(t){var a=t.data||{};e.sceneOptions.forEach((function(e){e.num=a[e.value]}))})).catch((function(){}))},getFieldList:function(){2==this.activeTab?this.fieldList=[{field:"appraisalPlanName",width:120,name:"考核名称"},{field:"inspectionScopeName",width:180,name:"考核范围"},{field:"appraisalCycleType",width:120,name:"考核周期类型"},{field:"appraisalCycle",width:120,name:"考核周期"},{field:"appraisalIllustrate",width:120,name:"考核说明"}]:this.fieldList=[{field:"appraisalPlanName",width:120,name:"考核名称"},{field:"inspectionScopeName",width:180,name:"考核范围"},{field:"appraisalCycleType",width:120,name:"考核周期类型"},{field:"appraisalCycle",width:120,name:"考核周期"},{field:"appraisalPersons",width:120,name:"考核人数"},{field:"fillPersons",width:120,name:"目标填写"},{field:"targetConfirmationPersons",width:120,name:"目标待确认"},{field:"executingPersons",width:120,name:"执行中"},{field:"selfScoringPersons",width:120,name:"自评"},{field:"otherScoringPersons",width:120,name:"他人评分"},{field:"resultAuditPersons",width:120,name:"结果审核"},{field:"resultConfirmationPersons",width:120,name:"结果确认"},{field:"appraisalIllustrate",width:120,name:"考核说明"}],this.getList()},getList:function(){var e=this;this.loading=!0;var t={page:this.currentPage,limit:this.pageSize,pageType:1,status:this.activeTab};this.search&&(t.appraisalPlanName=this.search),Object(n["s"])(t).then((function(t){e.list=t.data.list,e.total=t.data.totalRow,e.loading=!1})).catch((function(){e.loading=!1}))},tableHeaderHandle:function(e,t){"search"==e&&this.refreshList()},tabsClick:function(e){this.activeTab=e.value,this.refreshList()},getRowDropdownItems:function(e){var t=[];return 2==this.activeTab?(this.deleteAuth&&t.push({label:"删除考核",command:"delete"}),this.querySettingAuth&&t.push({label:"查看考核设置",command:"check"}),this.checkAppraisalPlanAuth&&t.push({label:"检查并开启考核",command:"status"})):3==this.activeTab&&(this.querySettingAuth&&t.push({label:"查看考核设置",command:"check"}),this.terminationPlanAuth&&t.push({label:"终止考核",command:"termination"}),this.queryEmployeeAppraisalAuth&&t.push({label:"考核结果",command:"result"}),1==e.operationStage&&this.openScoringAuth?t.unshift({label:"开始评分",command:"score"}):2==e.operationStage&&this.toInterviewAuth?t.unshift({label:"发起绩效面谈",command:"interview"}):3==e.operationStage&&this.placeOnFileAuth&&t.unshift({label:"归档",command:"archive"})),t},handleTypeClick:function(e,t){var a=this;"delete"==e?this.$confirm("确认要删除吗？确认后考核计划的设置、考核、结果记录、面谈记录将同时被删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0,Object(n["k"])({appraisalPlanId:t.appraisalPlanId}).then((function(e){a.loading=!1,a.$message.success("删除成功"),a.refreshList()})).catch((function(){a.loading=!1}))})).catch((function(){})):"status"==e?(this.loading=!0,Object(n["j"])({appraisalPlanId:t.appraisalPlanId}).then((function(e){a.loading=!1,a.rowData=t,a.rowID=t.appraisalPlanId,a.showDview=!0})).catch((function(){a.loading=!1}))):"check"==e?(this.loading=!0,Object(n["t"])({appraisalPlanId:t.appraisalPlanId}).then((function(e){a.loading=!1,a.inspectionDetial=e.data,a.isCreate=!0})).catch((function(){a.loading=!1}))):"termination"==e?this.$confirm("确认要终止考核吗？确认后考核计划配置的流程将暂停","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0,Object(n["v"])({appraisalPlanId:t.appraisalPlanId}).then((function(e){a.loading=!1,a.$message.success("终止考核成功"),a.refreshList()})).catch((function(){a.loading=!1}))})).catch((function(){})):"score"==e?(this.loading=!0,Object(n["m"])({appraisalPlanId:t.appraisalPlanId}).then((function(e){a.loading=!1,a.$message.success("操作成功"),a.refreshList()})).catch((function(){a.loading=!1}))):"interview"==e?(this.loading=!0,Object(n["w"])({appraisalPlanId:t.appraisalPlanId}).then((function(e){a.loading=!1,a.$message.success("操作成功"),a.refreshList()})).catch((function(){a.loading=!1}))):"archive"==e?(this.loading=!0,Object(n["n"])({appraisalPlanId:t.appraisalPlanId}).then((function(e){a.loading=!1,a.$message.success("操作成功"),a.refreshList()})).catch((function(){a.loading=!1}))):"result"==e&&(this.rowOngoingData=t,this.rowOngoingId=t.appraisalPlanId,this.isResult=!0,this.showOngoingDview=!0)},getPeriodTime:function(e){return"".concat(Object(y["E"])(e.startTime,"YYYY.MM.DD"),"-").concat(Object(y["E"])(e.endTime,"YYYY.MM.DD"))},getStatusHandleButtonName:function(e){return 4==e.status?"":1==e.isStop?"归档":{0:"开启考核",1:"开启评定",2:"开启结果确认",3:"归档"}[e.status]},isHandleDisabled:function(e){return 3==e.status&&0==e.isArchive},getIsDeleteHandle:function(e){return 0==e.status||4==e.status||1==e.isStop},getDeleteButtonName:function(e){return 4==e.status?"":this.getIsDeleteHandle(e)?"删除考核":"终止考核"},rowClick:function(e,t,a){if("delete"==e)this.getIsDeleteHandle(t)?this.deleteItem(t):this.stopItem(t);else if("status"==e){if(3==t.status||1==t.isStop){var i=1==t.isStop?"".concat(this.getStatusMessage(t.status,t.isStop),"，归档后不能修改，是否确认归档？"):"".concat(this.getStatusMessage(t.status),"，归档后不能修改，是否确认归档？");this.updateItemStatus(i,t,"4")}else if(0==t.status)this.updateItemStatus("".concat(this.getStatusMessage(t.status),"，开启考核后只能修改结果评定人和结果确认人，是否确认开启？"),t,"1");else if(1==t.status){var s="".concat(this.getStatusMessage(t.status),"，")+this.getStatusNumMessage(!1,t.statistics);s="".concat(s,"开启评定后只能修改结果确认人，是否确认开启？"),this.updateItemStatus(s,t,"2")}else if(2==t.status){var l="".concat(this.getStatusMessage(t.status),"，")+this.getStatusNumMessage(!0,t.statistics);l="".concat(l,"开启结果确认后将无法修改结果确认人，是否确认开启？"),this.updateItemStatus(l,t,"3")}}else"check"==e&&(this.rowStatus=t.status,this.rowId=t.appraisalId,this.isCreate=!0)},handleDelClick:function(e){var t=this;this.$confirm("确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["c"])({appraisalPlanId:e.appraisalPlanId}).then((function(e){t.$message({type:"success",message:"删除成功!"}),t.refreshList()}))})).catch((function(){}))},fieldFormatter:function(e,t,a){return"".concat(a,"人")},numCellClassName:function(e){var t=e.row,a=(e.column,e.rowIndex,e.columnIndex);return 0==a&&0===t.status?"":"can-visit--underline"},itemCellStyle:function(e){var t=e.row,a=e.column;return 0==a.property?0!==t.status?{cursor:"pointer"}:{}:{cursor:"pointer"}},numRowClick:function(e,t){var a=Array.prototype.slice.call(e),i=a[1].property;0===t.status&&"0"==i||(this.employeesViewData={appraisalId:t.appraisalId,status:"0"==i?"":i},this.employeesViewShow=!0)},deleteItem:function(e){var t=this;this.$confirm("确定要删除考核?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["z"])(e.appraisalId).then((function(e){t.$message.success("删除成功"),t.refreshList()})).catch((function(){}))})).catch((function(){}))},stopItem:function(e){var t=this,a="".concat(this.getStatusMessage(e.status),"，")+this.getStatusNumMessage(!0,e.statistics);a="".concat(a,"是否确认终止考核？"),this.$confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["B"])(e.appraisalId).then((function(e){t.$message.success("终止成功"),t.refreshList()})).catch((function(){}))})).catch((function(){}))},getStatusMessage:function(e,t){return 1===t?"当前考核已终止":{0:"当前考核未开始",1:"当前考核在目标填写/目标确认中",2:"当前考核在结果评定中",3:"当前考核在结果确认中"}[e]||""},getStatusNumMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,a=t||{},i=a[1],s=a[2],l=e?a[3]:0,n="";if(i>0||s>0||e&&l>0){n+="还有";var r=[];i>0&&r.push("".concat(i,"人目标待填写")),s>0&&r.push("".concat(s,"人目标待确认")),l>0&&r.push("".concat(l,"人结果待评定")),n=n+r.join("、")+"，"}return n},updateItemStatus:function(e,t,a){var i=this;this.$confirm("".concat(e),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["C"])({appraisalId:t.appraisalId,status:a}).then((function(e){i.$message.success("操作成功"),i.refreshList()})).catch((function(){}))})).catch((function(){}))},cellClassName:function(e){var t=e.row,a=e.column;e.rowIndex,e.columnIndex;return"statistics.0"===a.property&&0!==t.status||["appraisalName","statistics.1","statistics.2","statistics.3","statistics.4","appraisalPlanName"].includes(a.property)?"can-visit--underline":""},handleRowClick:function(e,t,a){var i=this;if("appraisalName"===t.property)this.rowClick("check",e,null);else if(["statistics.0","statistics.1","statistics.2","statistics.3","statistics.4"].includes(t.property)){var s=t.property.split(".")[1];this.numRowClick([null,{property:s}],e)}else"appraisalPlanName"===t.property&&2==e.status?this.querySettingAuth?(this.loading=!0,Object(n["t"])({appraisalPlanId:e.appraisalPlanId}).then((function(e){i.loading=!1,i.inspectionDetial=e.data,i.isCreate=!0})).catch((function(){i.loading=!1}))):this.$message.error("暂无权限"):"appraisalPlanName"===t.property&&2!=e.status&&(this.quotaInformationAuth?(this.rowOngoingData=e,this.rowOngoingId=e.appraisalPlanId,this.isResult=!1,this.showOngoingDview=!0):this.$message.error("暂无权限"))},tableFieldFormatter:function(e,t,a,i){return"appraisalCycleType"===t.property?{1:"月度",2:"季度",3:"上半年",4:"下半年",5:"全年",6:"其他"}[e.appraisalCycleType]:Object(ie["c"])(a)?"--":a},getStepIcon:function(e,t){return t<=e.appraisalSteps?"wk wk-success":t<e.activateSteps?"wk wk-icon-datetime":t===e.activateSteps?"":4===t&&4===e.status?"wk wk-success":""},detailClick:function(){this.rowID=1,this.showDview=!0},detailHandle:function(){},initTask:function(){var e=this,t=this.$route.query;"detail"===t.event&&Object(n["t"])({appraisalPlanId:t.id}).then((function(t){e.inspectionDetial=t.data,e.isCreate=!0})).catch((function(){}))}}},aa=ta,ia=(a("ab0e"),Object(S["a"])(aa,i,s,!1,null,"da99ef30",null));t["default"]=ia.exports},"2a46":function(e,t,a){"use strict";a("9228")},"2c8e":function(e,t,a){"use strict";a("af64")},"2f4a":function(e,t,a){},3277:function(e,t,a){"use strict";a("dc14")},3627:function(e,t,a){},"3ee3":function(e,t,a){},5815:function(e,t,a){e.exports=a.p+"static/img/status-achieve.af8e3b9f.png"},"5d2e":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wk-table-header"},[a("wk-filter-header",e._g(e._b({attrs:{props:e.filterHeaderConfig},on:{"event-change":e.filterHeaderHandle}},"wk-filter-header",e.$attrs,!1),e.$listeners),[a("template",{slot:"left-start"},[e._t("custom")],2),e._v(" "),a("template",{slot:"right"},[e.exportFields.length>0?a("el-button",{staticClass:"collapse-button",attrs:{type:e.exportFieldsShow?"selected":"text"},on:{click:function(t){e.collapseHandle()}}},[e._v("\n        "+e._s(e.exportFieldsShow?"收起筛选":"展开筛选")+"\n        "),a("i",{class:["el-icon-arrow-up",{"is-reverse":!e.exportFieldsShow}]})]):e._e(),e._v(" "),e.config.showFilterView?a("el-button",{staticClass:"filter-button",class:{"has-values":e.filterValidCount>0},attrs:{type:"subtle",icon:"wk wk-screening"},on:{click:e.showFilterClick}},[e._v("高级筛选"),e.filterValidCount>0?a("span",{staticClass:"values-span",attrs:{closable:"",type:"info"}},[e._v("\n          "+e._s(e.filterValidCount)),a("i",{staticClass:"el-icon-close",on:{click:function(t){t.stopPropagation(),e.clearFilterVal(e.filterObj.form)}}})]):e._e()]):e._e(),e._v(" "),e._t("default")],2)],2),e._v(" "),e.exportFields.length>0&&e.exportFieldsShow?a("filter-export-fields",{attrs:{"condition-type-fun":e.conditionTypeFun,form:e.exportFields,"field-list":e.fieldList,props:e.filterFormProps?e.filterFormProps.filterFieldsProps:null},on:{filter:e.exportFilter,clear:e.clearFilterVal}}):e._e(),e._v(" "),a("scene-set",{attrs:{"dialog-visible":e.sceneSetShow,props:e.sceneSetProps,"create-props":e.sceneCreateProps,"filter-fields-props":e.filterFormProps?e.filterFormProps.filterFieldsProps:null,"condition-type-fun":e.conditionTypeFun},on:{"update:dialogVisible":function(t){e.sceneSetShow=t},"save-success":e.updateSceneList}}),e._v(" "),e.config.showFilterView?a("filter-form",{attrs:{"field-list":e.fieldList,"dialog-visible":e.filterShow,obj:e.filterObj,"condition-type-fun":e.conditionTypeFun,props:e.filterFormProps},on:{"update:dialogVisible":function(t){e.filterShow=t},filter:e.handleFilter}}):e._e()],1)},s=[],l=a("c7eb"),n=a("1da1"),r=a("5530"),o=(a("4de4"),a("d3b7"),a("ddb0"),a("caad"),a("159b"),a("14d9"),a("e9c4"),a("1bfc")),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"filter-export-fields"},[a("div",{staticClass:"title"},[e._v("筛选条件")]),e._v(" "),a("filter-fields",{attrs:{"condition-type-fun":e.conditionTypeFun,form:e.form,"field-list":e.fieldList,props:e.props,"is-export":""}}),e._v(" "),a("div",{staticClass:"filter-export-fields__handle"},[a("el-button",{attrs:{type:"primary"},on:{click:e.filterClick}},[e._v("筛选")]),e._v(" "),a("el-button",{on:{click:e.clearClick}},[e._v("清空外露筛选值")])],1)],1)},u=[],d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"filterFieldsForm",staticClass:"filter-fields"},e._l(e.form,(function(t,i){return a("el-row",{key:i,attrs:{type:"flex"}},[a("el-col",{attrs:{span:6}},[a("wk-search-select",{attrs:{disabled:e.isExport,placeholder:"请选择要筛选的字段名",options:e.fieldListOptions},on:{change:function(a){e.fieldChange(t)},focus:e.fieldFocus},model:{value:t.fieldName,callback:function(a){e.$set(t,"fieldName",a)},expression:"formItem.fieldName"}})],1),e._v(" "),e.showCalCondition(t.formType,t.fieldName,t)?[a("el-col",{staticClass:"interval-base",attrs:{span:1}}),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-select",{attrs:{placeholder:"请选择范围"},on:{change:function(a){e.selectChange(a,t)}},model:{value:t.condition,callback:function(a){e.$set(t,"condition",a)},expression:"formItem.condition"}},e._l(e.getAdvancedFilterOptions(e.conditionTypeFun?e.conditionTypeFun(t):t.formType,t),(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)]:e._e(),e._v(" "),"business_cause"==t.formType?a("el-col",{staticClass:"interval-base",attrs:{span:1}}):e._e(),e._v(" "),"business_cause"==t.formType?a("el-col",{attrs:{span:4}},[a("el-select",{on:{change:function(a){e.typeOptionsChange(t)}},model:{value:t.flowName,callback:function(a){e.$set(t,"flowName",a)},expression:"formItem.flowName"}},e._l(t.typeOption,(function(t){return a("el-option",{key:t.flowId,attrs:{label:t.flowName,value:t[e.config.businessCauseValueKey]}})})))],1):e._e(),e._v(" "),a("el-col",{staticClass:"interval-base",attrs:{span:1}}),e._v(" "),a("el-col",{staticStyle:{position:"relative"},attrs:{span:e.getValueSpan(t.formType,t.fieldName,t)?e.isExport||!e.showExport?11:9:e.isExport?16:14}},["isNull"===t.condition||"isNotNull"===t.condition?void 0:e.updateFlag?["checkStatus"===t.formType||"dealStatus"===t.formType||"invoiceStatus"===t.formType||"receivedStatus"===t.formType||"status"===t.formType||"select"===t.formType&&"string"!=e.getSettingValueType(t.setting)?a("wk-search-select",{attrs:{placeholder:"请选择筛选条件",options:t.setting},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}}):"checkbox"===t.formType&&"string"!=e.getSettingValueType(t.setting)?a("wk-search-select",{attrs:{multiple:"field_tag"!==t.formType,placeholder:"请选择筛选条件",options:t.setting},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}},e._l(t.setting,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name||e.label,value:e.value}})}))):["select","checkbox"].includes(t.formType)?a("wk-search-select",{attrs:{multiple:"field_tag"!==t.formType,placeholder:"请选择筛选条件",options:e.getObjOptions(t.setting)},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}}):["field_tag"].includes(t.formType)?a("el-select",{attrs:{filterable:"",multiple:"",placeholder:"请选择筛选条件","popper-class":"select-popper-class"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}},e._l(t.groupList,(function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.labelList,(function(e){return a("el-option",{key:""+(t.label+e),attrs:{label:e,value:e}})})))}))):"field_attention"===t.formType?a("el-select",{attrs:{multiple:"",placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}},e._l(t.setting,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}))):"number"==t.formType||"floatnumber"==t.formType||"percent"==t.formType?[14===t.type?a("div",{staticClass:"date-range-value"},[a("el-input-number",{staticClass:"small",attrs:{controls:!1},model:{value:t.min,callback:function(a){e.$set(t,"min",a)},expression:"formItem.min"}}),e._v(" "),a("span",[e._v("-")]),e._v(" "),a("el-input-number",{staticClass:"small",attrs:{controls:!1},model:{value:t.max,callback:function(a){e.$set(t,"max",a)},expression:"formItem.max"}})],1):a("el-input-number",{staticClass:"small",staticStyle:{width:"100%"},attrs:{controls:!1},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}})]:"date"===t.formType||"datetime"===t.formType?[a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:14===t.type,expression:"formItem.type === 14"}],ref:"wkDatePicker"+i,refInFor:!0,attrs:{"picker-options":e.getPickerOptions(t,i),type:"date"===t.formType?"daterange":"datetimerange","value-format":"date"===t.formType?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},on:{change:function(a){e.datePickerChange(t)}},model:{value:t.range,callback:function(a){e.$set(t,"range",a)},expression:"formItem.range"}}),e._v(" "),t.timeType?a("div",{staticClass:"date-range-content",on:{click:function(a){e.dateRangeSelect(t,i)}}},[e._v(e._s(t.timeTypeName))]):e._e(),e._v(" "),a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:14!==t.type,expression:"formItem.type !== 14"}],attrs:{"value-format":"date"===t.formType?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss",type:t.formType,placeholder:"选择日期"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}})]:"business_cause"===t.formType?a("el-select",{model:{value:t.settingName,callback:function(a){e.$set(t,"settingName",a)},expression:"formItem.settingName"}},e._l(t.settingList,(function(e){return a("el-option",{key:e.settingId,attrs:{label:e.settingName,value:e.settingName}})}))):"user"===t.formType||"single_user"===t.formType?a("wk-user-dialog-select",{staticStyle:{width:"100%"},attrs:{radio:!1},on:{change:function(a){e.userDepChange(t,arguments[0],arguments[1])}},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}}):"structure"===t.formType?a("wk-dept-dialog-select",{staticStyle:{width:"100%"},attrs:{radio:!1},on:{change:function(a){e.userDepChange(t,arguments[0],arguments[1])}},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}}):"boolean_value"==t.formType?a("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}}):"productTypeId"===t.fieldName?a("wk-product-category",{attrs:{item:t,value:t.value,type:"jxc"},on:{change:e.arrayValueChange}}):"category"===t.formType?a("xh-prouct-cate",{attrs:{item:t,value:t.value},on:{"value-change":e.arrayValueChange}}):"map_address"===t.formType?a("v-distpicker",{attrs:{province:t.address.state,city:t.address.city,area:t.address.area},on:{province:function(a){e.selectProvince(a,t)},city:function(a){e.selectCity(a,t)},area:function(a){e.selectArea(a,t)}}}):"position"==t.formType?a("wk-position",{attrs:{"show-detail":!1,props:{checkStrictly:!0}},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}}):a("el-input",{attrs:{placeholder:"多个条件请用；隔开"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"formItem.value"}})]:e._e()],2),e._v(" "),e.isExport?e._e():a("el-col",{staticClass:"delete",attrs:{span:1}},[a("i",{staticClass:"el-icon-error delete-btn",on:{click:function(t){e.handleDelete(i)}}})]),e._v(" "),!e.isExport&&e.showExport?a("el-col",{attrs:{span:2}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},on:{change:e.exportChange},model:{value:t.isOut,callback:function(a){e.$set(t,"isOut",a)},expression:"formItem.isOut"}},[e._v("外露")])],1):e._e()],2)})))},p=[],m=a("b85c"),f=a("2909"),h=a("53ca"),v=(a("d81d"),a("b0c0"),a("7db0"),a("a630"),a("3ca3"),a("6062"),a("f068")),g=a("8f81"),b=a("bfba"),y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-cascader",e._b({ref:"elCascader",staticStyle:{width:"100%"},attrs:{options:e.options,"show-all-levels":!1,props:e.defaultProps},on:{change:e.valueChange},model:{value:e.dataValue,callback:function(t){e.dataValue=t},expression:"dataValue"}},"el-cascader",e.$attrs,!1))},_=[],w=(a("a9e3"),a("2532"),a("ea20")),S=a("6bfe"),C={name:"ProductType",components:{},props:{item:Object,value:{type:[String,Number,Object,Array],default:null},type:{type:String,default:"jxc"}},data:function(){return{options:[],dataValue:null,defaultProps:{},request:null}},watch:{value:{handler:function(){this.value?this.dataValue&&this.dataValue.includes(this.value)||(this.dataValue=this.value):this.dataValue=null},deep:!0,immediate:!0}},mounted:function(){this.setConfig(),this.getProductCategoryIndex()},methods:{setConfig:function(){"crm"===this.type&&(this.defaultProps={children:"children",label:"label",value:"categoryId",checkStrictly:!0},this.request=w["o"])},getProductCategoryIndex:function(){var e=this;this.request({type:"tree"}).then((function(t){e.options=e.formatOptions(t.data,e.defaultProps.children)})).catch((function(){}))},formatOptions:function(e,t){var a=this;return e.forEach((function(e){e.hasOwnProperty(t)&&(Object(S["c"])(e[t])?delete e[t]:e[t]=a.formatOptions(e[t],t))})),e},valueChange:function(e){this.$emit("input",e[e.length-1]||""),this.$emit("change",{valArr:e,value:e,item:this.item,valueContent:e.length>0?this.$refs.elCascader.getCheckedNodes()[0].label:""})}}},x=C,k=a("2877"),T=Object(k["a"])(x,y,_,!1,null,"527cc426",null),O=T.exports,L=a("5a8c"),F=a("0a3e"),N=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",e._g(e._b({key:e.refreshKey,attrs:{filterable:"",remote:"","remote-method":e.remoteMethod},on:{change:e.valueChange,focus:e.selectFocus},model:{value:e.selectedValue,callback:function(t){e.selectedValue=t},expression:"selectedValue"}},"el-select",e.$attrs,!1),e.$listeners),e._l(e.filterOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name||e.label,value:e.value}})})))},I=[],D=(a("ac1f"),a("841c"),a("466d"),a("d22a")),j={name:"WkSearchSelect",inheritAttrs:!1,props:{value:{required:!0},options:Array},data:function(){return{selectedValue:null,search:"",refreshKey:Date.now()}},computed:{filterOptions:function(){var e=this;return this.search?this.options.filter((function(t){return D["a"].match(e.isEmptyValue(t.value)?t:t.label||t.name,e.search)})):this.options}},watch:{value:{handler:function(){this.selectedValue!==this.value&&(this.selectedValue=this.value)},immediate:!0}},methods:{remoteMethod:function(e){this.search=e},isEmptyValue:function(e){return null===e||void 0==e},valueChange:function(e){var t=this;this.$emit("input",e),this.$nextTick((function(){t.refreshKey=Date.now()}))},selectFocus:function(){this.search=""}}},$=j,P=Object(k["a"])($,N,I,!1,null,"094f3408",null),E=P.exports,A=a("2b0e"),B={methods:{getAdvancedFilterOptionName:function(e,t){var a="date"===t||"datetime"===t;return{1:"等于",2:"不等于",3:"包含",4:"不包含",5:"为空",6:"不为空",7:a?"晚于":"大于",8:a?"不早于":"大于等于",9:a?"早于":"小于",10:a?"不晚于":"小于等于",12:"开始于",13:"结束于",14:a?"等于（时间段）":"等于（范围）"}[e]||""},getAdvancedFilterOptions:function(e,t){return"text"==e||"textarea"==e||"website"==e||"mobile"==e||"email"==e||"module"==e||"serial_number"==e?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"contains",label:"包含",disabled:!1,type:3},{value:"notContains",label:"不包含",disabled:!1,type:4},{value:"startWith",label:"开始于",disabled:!1,type:12},{value:"endWith",label:"结束于",disabled:!1,type:13},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"invoiceStatus"===e||"checkStatus"==e||"dealStatus"==e||"receivedStatus"==e||"status"==e?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2}]:"select"==e||"field_attention"==e?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"boolean_value"==e?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2}]:"checkbox"==e||"location"==e?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"contains",label:"包含",disabled:!1,type:3},{value:"notContains",label:"不包含",disabled:!1,type:4},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"number"==e||"floatnumber"==e||"percent"==e?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"gt",label:"大于",disabled:!1,type:7},{value:"egt",label:"大于等于",disabled:!1,type:8},{value:"lt",label:"小于",disabled:!1,type:9},{value:"elt",label:"小于等于",disabled:!1,type:10},{value:"range",label:"等于（范围）",disabled:!1,type:14},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"date"==e||"datetime"==e?[{value:"is",label:"等于",disabled:!1,type:1},{value:"isNot",label:"不等于",disabled:!1,type:2},{value:"lt",label:"早于",disabled:!1,type:9},{value:"gt",label:"晚于",disabled:!1,type:7},{value:"egt",label:"不早于",disabled:!1,type:8},{value:"elt",label:"不晚于",disabled:!1,type:10},{value:"range",label:"等于（时间段）",disabled:!1,type:14},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:"date_interval"==e||"position"==e?[]:"user"==e||"structure"==e||"single_user"==e||"field_tag"==e?[{value:"contains",label:"包含",disabled:!1,type:3},{value:"notContains",label:"不包含",disabled:!1,type:4},{value:"isNull",label:"为空",disabled:!1,type:5},{value:"isNotNull",label:"不为空",disabled:!1,type:6}]:[]},getAdvancedFilterDefaultItemByFormType:function(e,t,a){t||(t=e),"business_cause"==e.formType?(e.typeOption=t.setting,e.settingList=[],A["default"].set(e,"flowName",""),A["default"].set(e,"settingName",""),e.value=""):"checkStatus"==e.formType||"dealStatus"==e.formType||"invoiceStatus"==e.formType||"receivedStatus"==e.formType||"status"==e.formType?(e.setting=t.setting||[],e.value=""):"map_address"==e.formType?e.address={state:"",city:"",area:""}:"user"===e.formType||"single_user"===e.formType||"structure"===e.formType||"category"===e.formType||"position"===e.formType?e.value=[]:"date"===e.formType||"datetime"===e.formType?(e.value="",A["default"].set(e,"timeType",""),A["default"].set(e,"timeTypeName",""),A["default"].set(e,"range",[])):"select"==e.formType||"checkbox"===e.formType||"field_attention"===e.formType?(e.setting=t.setting||[],e.value=[]):"number"==e.formType||"floatnumber"==e.formType||"percent"==e.formType?(e.min="",e.max="",e.value=""):"field_tag"===e.formType?(e.setting=t.setting||[],e.value=""):e.value="";var i=this.getAdvancedFilterOptions(a?a(e):e.formType,e.fieldName);if(i.length>0){var s=i[0];e.condition=s.value,e.type=s.type}else e.condition="is",e.type=1;return e},resetAdvancedFilterFieldsValue:function(e){e.forEach((function(e){"number"==e.formType||"floatnumber"==e.formType||"percent"==e.formType?(e.min="",e.max="",e.value=""):"business_cause"==e.formType?(e.flowName="",e.settingName="",e.value="",e.settingList=[]):"map_address"==e.formType?e.address={state:"",city:"",area:""}:["date","datetime"].includes(e.formType)?(e.value="",e.range=[]):Object(S["a"])(e.value)?e.value=[]:Object(S["d"])(e.value)?e.value={}:e.value=""}))}}},R=a("8ed6"),q={showPersonTag:!1,request:null,params:null,businessCauseValueKey:"flowName"},V={name:"FilterFields",components:{WkUserDialogSelect:g["a"],XhProuctCate:v["b"],WkProductCategory:O,VDistpicker:L["a"],WkDeptDialogSelect:b["a"],WkPosition:F["a"],WkSearchSelect:E},mixins:[B],props:{conditionTypeFun:Function,form:Array,fieldList:Array,disabled:{type:Boolean,default:!1},showExport:{type:Boolean,default:!0},isExport:{type:Boolean,default:!1},props:Object},data:function(){return{updateFlag:!0}},computed:{config:function(){return Object(R["a"])(Object(r["a"])({},q),this.props||{})},fieldListOptions:function(){return this.fieldList.map((function(e){return{name:e.name,value:e.fieldName}}))}},watch:{form:function(){var e=this;this.$nextTick((function(){e.$el.scrollTop=e.$el.scrollHeight}))}},created:function(){var e,t=this;(null===(e=this.form)||void 0===e?void 0:e.length)>0&&this.form.forEach((function(e){"field_tag"==e.formType&&t.getPersonLabel(e)}))},mounted:function(){},beforeDestroy:function(){},methods:{showCalCondition:function(e,t,a){return this.getAdvancedFilterOptions(this.conditionTypeFun?this.conditionTypeFun(a):e,t).length>0},getValueSpan:function(e,t,a){return"business_cause"==e||this.showCalCondition(e,t,a)?8:13},typeOptionsChange:function(e){var t=this;if(e.flowName){var a=e.typeOption.find((function(a){return a[t.config.businessCauseValueKey]===e.flowName}));e.settingList=a.settingList||[]}else e.settingList=[];e.settingName=""},getSettingValueType:function(e){if(e&&e.length>0){var t=e[0];return Object(h["a"])(t)}return[]},getPersonLabel:function(e){var t=this;this.$nextTick((function(){var a=Array.from(new Set(e.setting)),i=!!(a.length>0&&a[0].labelList),s=null;i&&(s=a.map((function(e){var t;return{label:e.name,labelList:null===(t=e.labelList)||void 0===t?void 0:t.map((function(e){return e.name}))}})));var l=[{label:"企业标签",labelList:i?[]:a}];i&&l.push.apply(l,Object(f["a"])(s));var n=t.config,r=n.showPersonTag,o=n.request,c=n.params;r?o(c).then((function(a){var i,s=[],n=Object(m["a"])(a.data||[]);try{for(n.s();!(i=n.n()).done;){var r=i.value;s.push(r.name)}}catch(u){n.e(u)}finally{n.f()}var o=Array.from(new Set(s)),c={label:"个人标签",labelList:o};l.push(c),t.$set(e,"groupList",l)})):t.$set(e,"groupList",l)}))},selectProvince:function(e,t){t.address.state=e.value},selectCity:function(e,t){t.address.city=e.value},selectArea:function(e,t){t.address.area=e.value},arrayValueChange:function(e){e.value.length>0?(e.item.value=e.value,e.item.valueContent=e.valueContent):e.item.value=[]},userDepChange:function(e,t,a){e.valueContent=a},selectChange:function(e,t){this.getAdvancedFilterOptions(this.conditionTypeFun?this.conditionTypeFun(t):t.formType,t.fieldName).forEach((function(a){a.value===e&&(t.type=a.type)}))},fieldFocus:function(){this.$el.click()},fieldChange:function(e){var t=this,a=this.fieldList.find((function(t){return t.fieldName===e.fieldName}));a&&(e.formType=a.formType,e.name=a.name,"field_tag"==e.formType&&this.getPersonLabel(e),this.getAdvancedFilterDefaultItemByFormType(e,a,this.conditionTypeFun)),this.$emit("on-field-change"),this.updateFlag=!1,this.$nextTick((function(){t.updateFlag=!0}))},dateRangeSelect:function(e,t){var a=this.$refs["wkDatePicker".concat(t)][0];this.$nextTick((function(){a.focus(),a.pickerVisible=!0}))},datePickerChange:function(e){e.timeTypeName="",e.timeType=""},getPickerOptions:function(e,t){for(var a=this,i=[{text:"本年度",value:"year"},{text:"上一年度",value:"lastYear"},{text:"下一年度",value:"nextYear"},{text:"上半年",value:"firstHalfYear"},{text:"下半年",value:"nextHalfYear"},{text:"本季度",value:"quarter"},{text:"上一季度",value:"lastQuarter"},{text:"下一季度",value:"nextQuarter"},{text:"本月",value:"month"},{text:"上月",value:"lastMonth"},{text:"下月",value:"nextMonth"},{text:"本周",value:"week"},{text:"上周",value:"lastWeek"},{text:"下周",value:"nextWeek"},{text:"今天",value:"today"},{text:"昨天",value:"yesterday"},{text:"明天",value:"tomorrow"},{text:"过去7天",value:"previous7day"},{text:"过去30天",value:"previous30day"},{text:"未来7天",value:"future7day"},{text:"未来30天",value:"future30day"}],s=[],l=function(){var t=i[n];s.push({text:t.text,onClick:function(i){i.$emit("pick",[],!1),a.$nextTick((function(){e.timeTypeName=t.text,e.timeType=t.value}))}})},n=0;n<i.length;n++)l();return{shortcuts:s}},handleDelete:function(e){this.$emit("on-field-delete",e)},exportChange:function(){this.$emit("on-field-export")},getObjOptions:function(e){return e.map((function(e){return{name:e,value:e}}))}}},H=V,z=(a("bb7d"),Object(k["a"])(H,d,p,!1,null,"11f23114",null)),U=z.exports,W=(a("a15b"),a("5319"),function(e){return[5,6].includes(e)});function M(e){var t=[];return e.forEach((function(e){var a=[];if("datetime"==e.formType||"date"==e.formType)14===e.type?a=Object(S["c"])(e.timeType)?e.range:[e.timeType]:e.value&&(a=Object(S["a"])(e.value)?e.value:[e.value]),W(e.type)&&(a=[]),t.push({formType:e.formType,name:e.fieldName,type:e.type,values:a});else if("number"==e.formType||"floatnumber"==e.formType||"percent"==e.formType)14===e.type?a=[Object(S["c"])(e.min)?0:e.min,Object(S["c"])(e.max)?0:e.max]:Object(S["c"])(e.value)||(a=[e.value]),W(e.type)&&(a=[]),t.push({formType:e.formType,name:e.fieldName,type:e.type,values:a});else if("business_cause"==e.formType)e.flowName&&t.push({formType:e.formType,name:"flowName",type:1,values:[e.flowName]}),e.settingName&&t.push({formType:e.formType,name:"settingName",type:1,values:[e.settingName]});else if("user"==e.formType||"single_user"==e.formType)a=e.value,W(e.type)&&(a=[]),t.push({type:e.type,values:a,formType:e.formType,name:e.fieldName});else if("position"==e.formType)a=e.value.filter((function(e){return!Object(S["c"])(e.name)})).map((function(e){return JSON.stringify(e)})),W(e.type)&&(a=[]),t.push({type:e.type,values:a,formType:e.formType,name:e.fieldName});else if("structure"==e.formType)a=e.value,W(e.type)&&(a=[]),t.push({type:e.type,values:a,formType:e.formType,name:e.fieldName});else if("checkbox"==e.formType)a="receivedStatus"!==e.fieldName||Object(S["a"])(e.value)?Object(S["a"])(e.value)?e.value:[]:""===e.value||null===e.value||void 0===e.value?[]:[e.value],W(e.type)&&(a=[]),t.push({type:e.type,values:a,formType:e.formType,name:e.fieldName});else if("category"==e.formType)a=Object(S["a"])(e.value)&&e.value.length>0?[e.value[e.value.length-1]]:[],W(e.type)&&(a=[]),t.push({type:1,values:a,formType:e.formType,name:e.fieldName});else if("select"===e.formType)a=e.value||[],"string"==Y(e.setting)||!e.value&&0!==e.value||(a=[e.value]),W(e.type)&&(a=[]),t.push({type:e.type,values:a,formType:e.formType,name:e.fieldName});else if(["field_tag","field_attention"].includes(e.formType))a=e.value||[],Object(S["a"])(a)||(a=[a]),W(e.type)&&(a=[]),t.push({type:e.type,values:a,formType:e.formType,name:e.fieldName});else if("map_address"==e.formType){var i=[];for(var s in e.address){var l=e.address[s];l&&i.push(l)}t.push({values:[i.join(",")],type:3,formType:e.formType,name:e.fieldName})}else{var n=[];if("string"===typeof e.value){var r=e.value.replace(/；/g,";");n=r.split(";").filter((function(e){return""!==e&&null!==e}))}else n=[e.value];W(e.type)&&(n=[]),t.push({type:e.type,values:n,formType:e.formType,name:e.fieldName})}})),t}function Y(e){if(e&&e.length>0){var t=e[0];return Object(h["a"])(t)}return[]}var Q={name:"FilterExportFields",components:{FilterFields:U},props:{conditionTypeFun:Function,form:Array,fieldList:Array,props:Object},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{filterClick:function(){this.$emit("filter",M(this.form))},clearClick:function(){this.$emit("clear",this.form)}}},J=Q,K=(a("0fe0"),Object(k["a"])(J,c,u,!1,null,"642ce051",null)),X=K.exports,G=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,width:"700px"},on:{"update:visible":function(t){e.visible=t},close:e.handleCancel}},[a("span",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v("场景管理"),e.config.help?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.config.help.type,"data-id":e.config.help.id}}):e._e()]),e._v(" "),a("div",{staticClass:"scene-name"},[e._v("您可通过拖拽管理场景")]),e._v(" "),a("flexbox",{staticClass:"scene-list"},[a("div",{staticClass:"scene-list-box"},[a("flexbox",{staticClass:"scene-list-head"},[a("el-checkbox",{attrs:{indeterminate:e.isleftIndeterminate},on:{change:e.handleleftCheckAllChange},model:{value:e.checkleftAll,callback:function(t){e.checkleftAll=t},expression:"checkleftAll"}}),e._v(" "),a("div",{staticClass:"scene-list-head-name"},[e._v("显示的场景")]),e._v(" "),a("div",{staticClass:"scene-list-head-detail"},[e._v(e._s(e.leftCheckItems.length+"/"+e.checkedLeftData.length))])],1),e._v(" "),a("div",{staticClass:"scene-list-body"},[a("draggable",{staticStyle:{"min-height":"100px"},attrs:{move:e.leftMove,options:{group:"list",forceFallback:!1,fallbackClass:"draggingStyle"}},on:{end:e.leftMoveEnd},model:{value:e.checkedLeftData,callback:function(t){e.checkedLeftData=t},expression:"checkedLeftData"}},e._l(e.checkedLeftData,(function(t,i){return a("flexbox",{key:i,staticClass:"list-item"},[a("div",{staticClass:"default-mark",class:{"default-mark-active":t.sceneId==e.defaultId}}),e._v(" "),a("el-checkbox",{staticClass:"list-item-check",on:{change:e.leftCheckItemChange},model:{value:t.check,callback:function(a){e.$set(t,"check",a)},expression:"item.check"}}),e._v(" "),a("div",{staticClass:"list-item-name"},[e._v(e._s(t.name))]),e._v(" "),a("div",{staticClass:"list-item-handle"},[1!=t.isSystem?a("i",{staticClass:"el-icon-edit",on:{click:function(a){e.itemHandle("edit",t,i)}}}):e._e(),e._v(" "),1!=t.isSystem?a("i",{staticClass:"el-icon-delete",on:{click:function(a){e.itemHandle("delete",t,i)}}}):e._e(),e._v(" "),t.sceneId!=e.defaultId?a("el-dropdown",{on:{command:function(a){e.defaultHandle(arguments[0],t)}},model:{value:t.visible,callback:function(a){e.$set(t,"visible",a)},expression:"item.visible"}},[a("el-button",{staticClass:"dropdown-btn menu-edit-btn",attrs:{icon:"wk wk-manage",size:"small"}}),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"default"}},[e._v("设置为默认场景")])],1)],1):e._e()],1)],1)})))],1)],1),e._v(" "),a("div",{staticClass:"scene-middle-list"},[a("el-button",{staticClass:"scene-middle-left-button",class:{"scene-middle-button-select":e.rightCheckItems.length>0},attrs:{disabled:0==e.rightCheckItems.length},on:{click:function(t){e.changePositon("left")}}},[a("i",{staticClass:"el-icon-arrow-left scene-middle-icon"})]),e._v(" "),a("el-button",{staticClass:"scene-middle-right-button",class:{"scene-middle-button-select":e.leftCheckItems.length>0},attrs:{disabled:0==e.leftCheckItems.length},on:{click:function(t){e.changePositon("right")}}},[a("i",{staticClass:"el-icon-arrow-right scene-middle-icon"})])],1),e._v(" "),a("div",{staticClass:"scene-list-box"},[a("flexbox",{staticClass:"scene-list-head"},[a("el-checkbox",{attrs:{indeterminate:e.isrightIndeterminate},on:{change:e.handlerightCheckAllChange},model:{value:e.checkrightAll,callback:function(t){e.checkrightAll=t},expression:"checkrightAll"}}),e._v(" "),a("div",{staticClass:"scene-list-head-name"},[e._v("隐藏的场景")]),e._v(" "),a("div",{staticClass:"scene-list-head-detail"},[e._v(e._s(e.rightCheckItems.length+"/"+e.checkedRightData.length))])],1),e._v(" "),a("div",{staticClass:"scene-list-body"},[a("draggable",{staticStyle:{"min-height":"100px"},attrs:{move:e.rightMove,options:{group:"list",forceFallback:!1,fallbackClass:"draggingStyle"}},on:{end:e.rightMoveEnd},model:{value:e.checkedRightData,callback:function(t){e.checkedRightData=t},expression:"checkedRightData"}},e._l(e.checkedRightData,(function(t,i){return a("flexbox",{key:i,staticClass:"list-item"},[a("el-checkbox",{staticClass:"list-item-check",staticStyle:{"margin-left":"9px"},on:{change:e.rightCheckItemChange},model:{value:t.check,callback:function(a){e.$set(t,"check",a)},expression:"item.check"}}),e._v(" "),a("div",{staticClass:"list-item-name"},[e._v(e._s(t.name))])],1)})))],1)],1)]),e._v(" "),a("div",{staticClass:"handle-bar"},[a("el-button",{staticStyle:{"padding-right":"0","padding-left":"0"},attrs:{type:"text"},on:{click:function(t){e.addAndEditScene("add",{})}}},[e._v("+ 新建场景")])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("保存")]),e._v(" "),a("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("取消")])],1),e._v(" "),a("scene-create",{attrs:{"field-list":e.fieldList,props:e.createProps,"filter-fields-props":e.filterFieldsProps,"condition-type-fun":e.conditionTypeFun,"dialog-visible":e.showCreateScene,obj:e.filterObj,name:e.filterName,"edit-id":e.filterEditId,"is-default":e.filterDefault},on:{"update:dialogVisible":function(t){e.showCreateScene=t},"save-success":e.refreshSceneList}})],1)},Z=[],ee=(a("a434"),a("25f0"),a("b76a")),te=a.n(ee),ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.editId?"编辑场景":"新建场景",visible:e.visible,"close-on-click-modal":!1,"append-to-body":!0,width:"800px"},on:{"update:visible":function(t){e.visible=t},close:e.handleCancel}},[a("div",{staticClass:"scene-name-container"},[a("div",{staticClass:"scene-name"},[e._v("场景名称")]),e._v(" "),a("el-input",{staticClass:"scene-input",attrs:{maxlength:10,placeholder:"场景名称，最多10个字符"},model:{value:e.saveName,callback:function(t){e.saveName="string"===typeof t?t.trim():t},expression:"saveName"}})],1),e._v(" "),a("div",{staticClass:"scene-name"},[e._v("筛选条件")]),e._v(" "),a("filter-fields",{attrs:{id:"scene-filter-container","condition-type-fun":e.conditionTypeFun,form:e.form,"field-list":e.fieldList,props:e.filterFieldsProps,"show-export":!1},on:{"on-field-change":e.getError,"on-field-delete":e.handleDelete}}),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.showErrors,expression:"showErrors"}],staticClass:"el-icon-warning warning-info"},[a("span",{staticClass:"desc"},[e._v(e._s(e.errorTypes[e.errorType]))])]),e._v(" "),a("el-button",{staticStyle:{"padding-right":"0","padding-left":"0"},attrs:{type:"text"},on:{click:e.handleAdd}},[e._v("+ 添加筛选条件")]),e._v(" "),a("div",{staticClass:"save"},[a("div",{staticClass:"save-setting"},[a("el-checkbox",{model:{value:e.saveDefault,callback:function(t){e.saveDefault=t},expression:"saveDefault"}},[e._v("设置为默认")]),e.config.help?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.config.help.type,"data-id":e.config.help.id}}):e._e()],1)]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)],1)},ie=[],se=(a("fb6a"),a("ed08")),le={updateRequest:null,updateParams:null,saveRequest:null,saveParams:null,help:null},ne={name:"SceneCreate",components:{FilterFields:U},mixins:[B],props:{dialogVisible:{type:Boolean,required:!0,default:!1},fieldList:{type:Array,required:!0,default:function(){return[]}},obj:{type:Object,required:!0,default:function(){return{}}},props:Object,filterFieldsProps:Object,conditionTypeFun:Function,name:{type:String,default:""},isDefault:{type:Boolean,default:!1},editId:{type:String,default:""}},data:function(){return{form:[],visible:!1,errorTypes:["筛选条件中有重复项！","请选择筛选条件！"],errorType:0,showErrors:!1,saveDefault:!1,saveName:null,timeTypes:[{text:"本年度",value:"year"},{text:"上一年度",value:"lastYear"},{text:"下一年度",value:"nextYear"},{text:"上半年",value:"firstHalfYear"},{text:"下半年",value:"nextHalfYear"},{text:"本季度",value:"quarter"},{text:"上一季度",value:"lastQuarter"},{text:"下一季度",value:"nextQuarter"},{text:"本月",value:"month"},{text:"上月",value:"lastMonth"},{text:"下月",value:"nextMonth"},{text:"本周",value:"week"},{text:"上周",value:"lastWeek"},{text:"下周",value:"nextWeek"},{text:"今天",value:"today"},{text:"昨天",value:"yesterday"},{text:"明天",value:"tomorrow"},{text:"过去7天",value:"previous7day"},{text:"过去30天",value:"previous30day"},{text:"未来7天",value:"future7day"},{text:"未来30天",value:"future30day"}]}},computed:{config:function(){return Object(R["a"])(Object(r["a"])({},le),this.props||{})}},watch:{dialogVisible:{handler:function(e){var t=this;if(e){var a=[];if(this.editId){var i=function(){var e=t.obj.obj[s],i=t.getFilterItem();if(i.fieldName=e.name,i.formType=e.formType,i.type=e.type,t.getAdvancedFilterOptions(e.formType,e.fieldName).forEach((function(t){e.type===t.type&&(i.condition=t.value)})),"checkbox"!==i.formType&&"select"!==i.formType&&"dealStatus"!==i.formType&&"checkStatus"!==i.formType||(i.setting=t.getEditSetting(i.formType,i.fieldName)),"date"==e.formType||"datetime"==e.formType)if(i.value="",t.$set(i,"timeType",""),t.$set(i,"timeTypeName",""),t.$set(i,"range",[]),14===i.type)if(Object(S["a"])(e.values)&&e.values.length>0)if(1===e.values.length){i.timeType=e.values[0];var l=t.timeTypes.find((function(e){return e.value===i.timeType}));l&&(i.timeTypeName=l.text)}else t.$set(i,"range",e.values.slice(0,2));else i.value="";else i.value=e.values[0];else if("number"==e.formType||"floatnumber"==e.formType||"percent"==e.formType)i.min="",i.max="",i.value="",14===i.type?(i.min=Object(S["a"])(e.values)&&!Object(S["c"])(e.values[0])?e.values[0]:"",i.max=Object(S["a"])(e.values)&&!Object(S["c"])(e.values[1])?e.values[1]:""):i.value=e.values[0];else if("business_cause"==e.formType){if("settingName"===e.name&&(i=a.find((function(e){return"business_cause"===e.formType}))||i,i.ignorePush=!0),i[e.name]=e.values[0],i.typeOption=t.getEditSetting(i.formType,i.fieldName),i.flowName){var n=i.typeOption.find((function(e){return e.flowName===i.flowName}));i.settingList=n?n.settingList:[]}}else if("user"==e.formType||"single_user"==e.formType||"structure"==e.formType||"checkbox"==e.formType||"position"==e.formType)i.value=e.values;else if("select"==e.formType)"string"!=t.getSettingValueType(i.setting)?i.value=e.values[0]:i.value=e.values;else if("category"==e.formType)i.value=[],t.getProductCategoryValue(i,e.values[0]);else if("map_address"==e.formType){var r=e.values[0].split(",");i.address={state:r.length>0?r[0]:"",city:r.length>1?r[1]:"",area:r.length>2?r[2]:""}}else i.setting=e.setting,i.value=e.values.join(";");i.ignorePush||a.push(i)};for(var s in this.obj.obj)i()}else a=Object(se["z"])(this.obj.form),0==a.length&&a.push(this.getFilterItem());this.form=a,this.name?this.saveName=this.name:this.saveName="",this.isDefault?this.saveDefault=this.isDefault:this.saveDefault=!1}this.visible=this.dialogVisible},deep:!0,immediate:!0},form:function(){this.$nextTick((function(){var e=document.getElementById("scene-filter-container");e.scrollTop=e.scrollHeight}))}},methods:{getEditSetting:function(e,t){var a=this.fieldList.find((function(a){return a.formType==e&&a.fieldName==t}));return a?a.setting:[]},getProductCategoryValue:function(e,t){var a=this;Object(w["o"])().then((function(i){var s=i.data||[],l=[];a.filterProductTree(s,t,l),e.value=l.reverse()})).catch((function(){}))},filterProductTree:function(e,t,a){for(var i=0;i<e.length;i++){var s=e[i];if(s.categoryId==t){a.push(t),this.filterProductTree(e,s.parentId,a);break}}},getFilterItem:function(){return{fieldName:"",name:"",formType:"",isOut:0,condition:"contains",type:3,value:"",setting:[],typeOption:[],settingList:[],flowName:"",settingName:"",address:{state:"",city:"",area:""}}},handleCancel:function(){this.visible=!1,this.$emit("update:dialogVisible",!1)},getError:function(){this.showErrors=!1;for(var e=[],t=0;t<this.form.length;t++){var a=this.form[t];if(""===a.fieldName||void 0===a.fieldName||null===a.fieldName){this.errorType=1,this.showErrors=!0;break}if(e.includes(a.fieldName)){this.errorType=0,this.showErrors=!0;break}e.push(a.fieldName)}return this.showErrors},handleConfirm:function(){var e=this;if(!this.getError())if(this.saveName&&""!==this.saveName){for(var t=0;t<this.form.length;t++){var a=this.form[t];if(!a.fieldName||""===a.fieldName)return void this.$message.error("筛选的字段名称不能为空！");if("business_cause"==a.formType){if(!a.flowName&&!a.settingName)return void this.$message.error("筛选内容不能为空！")}else if("map_address"==a.formType){if(!a.address.state&&!a.address.city&&!a.address.area)return void this.$message.error("筛选内容不能为空！")}else if("date"==a.formType||"datetime"==a.formType){if("isNull"!=a.condition&&"isNotNull"!=a.condition)if(14===a.type){if(Object(S["c"])(a.timeType)&&Object(S["c"])(a.range))return void this.$message.error("筛选内容不能为空！")}else if(Object(S["c"])(a.value))return void this.$message.error("筛选内容不能为空！")}else if("number"==a.formType||"floatnumber"==a.formType||"percent"==a.formType){if("isNull"!=a.condition&&"isNotNull"!=a.condition)if(14===a.type){if(Object(S["c"])(a.min)||Object(S["c"])(a.max))return void this.$message.error("筛选内容不能为空！")}else if(Object(S["c"])(a.value))return void this.$message.error("筛选内容不能为空！")}else if("user"==a.formType||"single_user"==a.formType||"structure"==a.formType||"category"==a.formType||"checkbox"==a.formType||"position"==a.formType){if(Object(S["c"])(a.value)&&"isNull"!=a.condition&&"isNotNull"!=a.condition)return void this.$message.error("筛选内容不能为空！")}else if(Object(S["c"])(a.value)&&"isNull"!=a.condition&&"isNotNull"!=a.condition)return void this.$message.error("筛选内容不能为空！")}var i=[];this.form.forEach((function(t){if("datetime"==t.formType||"date"==t.formType){var a=[];a=14===t.type?Object(S["c"])(t.timeType)?t.range:[t.timeType]:[t.value],i.push({formType:t.formType,name:t.fieldName,type:t.type,values:a})}else if("number"==t.formType||"floatnumber"==t.formType||"percent"==t.formType){var s=[];s=14===t.type?[Object(S["c"])(t.min)?"":t.min,Object(S["c"])(t.max)?"":t.max]:[t.value],i.push({formType:t.formType,name:t.fieldName,type:t.type,values:s})}else if("business_cause"==t.formType)t.flowName&&i.push({formType:t.formType,name:"flowName",type:1,values:[t.flowName]}),t.settingName&&i.push({formType:t.formType,name:"settingName",type:1,values:[t.settingName]});else if("user"==t.formType||"single_user"==t.formType)i.push({type:t.type,values:t.value,formType:t.formType,name:t.fieldName});else if("position"==t.formType)i.push({type:t.type,values:t.value.filter((function(e){return!Object(S["c"])(e.name)})).map((function(e){return JSON.stringify(e)})),formType:t.formType,name:t.fieldName});else if("structure"==t.formType)i.push({type:t.type,values:t.value,formType:t.formType,name:t.fieldName});else if("checkbox"==t.formType)i.push({type:t.type,values:t.value,formType:t.formType,name:t.fieldName});else if("category"==t.formType)i.push({type:1,values:[t.value[t.value.length-1]],formType:t.formType,name:t.fieldName});else if("select"==t.formType){var l=t.value;"string"!=e.getSettingValueType(t.setting)&&(l=[t.value]),i.push({type:t.type,values:l,formType:t.formType,name:t.fieldName})}else if("map_address"==t.formType){var n=[];for(var r in t.address){var o=t.address[r];o&&n.push(o)}i.push({values:[n.join(",")],type:1,formType:t.formType,name:t.fieldName})}else{var c=[];if("string"===typeof t.value){var u=t.value.replace(/；/g,";");c=u.split(";").filter((function(e){return""!==e&&null!==e}))}else c=[t.value];i.push({type:t.type,values:c,formType:t.formType,name:t.fieldName})}}));var s={obj:i,form:this.form,saveDefault:this.saveDefault,saveName:this.saveName};this.requestCreateScene(s)}else this.$message.error("场景名称不能为空！")},requestCreateScene:function(e){var t=this;this.editId?this.config.updateRequest(Object(r["a"])({isDefault:e.saveDefault?1:0,name:e.saveName,sceneId:this.editId,data:JSON.stringify(e.obj)},this.config.updateParams)).then((function(e){t.$message({type:"success",message:"编辑成功"}),t.$emit("save-success"),t.handleCancel()})).catch((function(){})):this.config.saveRequest(Object(r["a"])({isDefault:e.saveDefault?1:0,name:e.saveName,data:JSON.stringify(e.obj)},this.config.saveParams)).then((function(e){t.$emit("save-success"),t.$message({type:"success",message:"创建成功"}),t.handleCancel()})).catch((function(){}))},handleAdd:function(){this.form.push(this.getFilterItem())},handleDelete:function(e){var t=this;this.$confirm("您确定要删除这一条数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.form.splice(e,1),t.getError()})).catch((function(){}))},getSettingValueType:function(e){if(e&&e.length>0){var t=e[0];return Object(h["a"])(t)}return[]}}},re=ne,oe=(a("de2b"),Object(k["a"])(re,ae,ie,!1,null,"7f4c9887",null)),ce=oe.exports,ue={indexRequest:null,indexParams:null,sortRequest:null,sortParams:null,defaultsRequest:null,defaultsParams:null,deleteRequest:null,deleteParams:null,fieldsIndexRequest:null,fieldsIndexParams:null,help:null},de={name:"SceneSet",components:{draggable:te.a,SceneCreate:ce},props:{dialogVisible:{type:Boolean,required:!0,default:!1},props:Object,createProps:Object,filterFieldsProps:Object,conditionTypeFun:Function},data:function(){return{defaultId:"",visible:!1,isleftIndeterminate:!1,checkleftAll:!1,checkedLeftData:[],leftCheckItems:[],isrightIndeterminate:!1,checkrightAll:!1,checkedRightData:[],rightCheckItems:[],moveItem:{},handlDefaultItem:{},showCreateScene:!1,fieldList:[],filterObj:{form:[]},filterName:"",filterDefault:!1,filterEditId:""}},computed:{config:function(){return Object(R["a"])(Object(r["a"])({},ue),this.props||{})}},watch:{dialogVisible:{handler:function(e){this.visible=e,e&&this.getSceneList()},deep:!0,immediate:!0}},mounted:function(){},methods:{refreshSceneList:function(){this.getSceneList(),this.$emit("save-success")},getSceneList:function(){var e=this;this.config.indexRequest(Object(r["a"])({},this.config.indexParams)).then((function(t){var a=t.data||{};e.checkedLeftData=a.value.map((function(e){return e.check=!1,e.data=e.data?JSON.parse(e.data):[],e})),e.checkedRightData=a.hideValue.map((function(e){return e.check=!1,e.data=e.data?JSON.parse(e.data):[],e}));var i=e.checkedLeftData.filter((function(e){return 1==e.isDefault}));i&&i.length>0?e.defaultId=i[0].sceneId:e.defaultId=""})).catch((function(){}))},handleConfirm:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!==this.checkedLeftData.length){var a=this.checkedLeftData.filter((function(t){return t.sceneId==e.defaultId}));0==a.length&&(this.defaultId=""),this.config.sortRequest(Object(r["a"])({noHideIds:this.checkedLeftData.map((function(e){return e.sceneId})),hideIds:this.checkedRightData.map((function(e){return e.sceneId}))},this.config.sortParams)).then((function(a){!1!==t&&(e.$message({type:"success",message:"操作成功"}),e.handleCancel()),e.$emit("save-success")})).catch((function(){}))}else this.$message.error("场景不能全部隐藏！")},itemHandle:function(e,t,a){var i=this;t.isTemp?this.$message.error("请保存后操作"):"edit"==e?this.addAndEditScene("edit",t):"delete"==e&&this.$confirm("您确定要删除这一条数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.config.deleteRequest({sceneId:t.sceneId}).then((function(e){i.$message({type:"success",message:"删除成功"}),i.checkedLeftData.splice(a,1),i.leftCheckItemChange(),i.$emit("save-success")})).catch((function(){}))})).catch((function(){}))},defaultHandle:function(e,t){var a=this;this.config.defaultsRequest({sceneId:t.sceneId}).then((function(e){a.$message({type:"success",message:"操作成功"}),a.defaultId=t.sceneId,a.handleConfirm(!1)})).catch((function(){}))},addAndEditScene:function(e,t){var a=this;this.config.fieldsIndexRequest(Object(r["a"])({},this.config.fieldsIndexParams)).then((function(i){var s=i.data||[];a.fieldList=s;var l=s.map((function(e){return e.fieldName}));"edit"==e?(a.fieldList.find((function(e){return"business_cause"===e.formType&&"flowName"===e.fieldName}))&&l.push("settingName"),a.filterObj={form:[],obj:t.data.filter((function(e){return l.includes(e.name)}))},a.filterName=t.name,a.filterDefault=1==t.isDefault,a.filterEditId=t.sceneId.toString()):(a.filterObj={form:[]},a.filterEditId="",a.filterName="",a.filterDefault=!1),a.showCreateScene=!0})).catch((function(){}))},handleCancel:function(){this.visible=!1,this.$emit("update:dialogVisible",!1)},rightMoveEnd:function(e){this.moveItem.check=!1,this.leftCheckItemChange(),this.rightCheckItemChange()},rightMove:function(e){this.moveItem=e.draggedContext.element},leftMoveEnd:function(e){this.moveItem.check=!1,this.leftCheckItemChange(),this.rightCheckItemChange()},leftMove:function(e){this.moveItem=e.draggedContext.element},handleleftCheckAllChange:function(e){e&&(this.isleftIndeterminate=!1),this.checkedLeftData.forEach((function(t){t.check=e})),this.leftCheckItems=e?this.checkedLeftData.filter((function(e){return e.check})):[]},leftCheckItemChange:function(){this.leftCheckItems=this.checkedLeftData.filter((function(e){return 1==e.check})),this.leftCheckItems.length>0?this.leftCheckItems.length==this.checkedLeftData.length?(this.checkleftAll=!0,this.isleftIndeterminate=!1):(this.checkleftAll=!1,this.isleftIndeterminate=!0):(this.checkleftAll=!1,this.isleftIndeterminate=!1)},handlerightCheckAllChange:function(e){e&&(this.isrightIndeterminate=!1),this.checkedRightData.forEach((function(t){t.check=e})),this.rightCheckItems=e?this.checkedRightData:[]},rightCheckItemChange:function(){this.rightCheckItems=this.checkedRightData.filter((function(e){return 1==e.check})),this.rightCheckItems.length>0?this.rightCheckItems.length==this.checkedRightData.length?(this.checkrightAll=!0,this.isrightIndeterminate=!1):(this.checkrightAll=!1,this.isrightIndeterminate=!0):(this.checkrightAll=!1,this.isrightIndeterminate=!1)},changePositon:function(e){var t=this;"left"==e?(this.checkedRightData=this.checkedRightData.filter((function(e,a,i){var s=!1;return t.rightCheckItems.forEach((function(t,a){e.sceneId==t.sceneId&&(s=!0)})),!s})),this.rightCheckItems.forEach((function(e,a){e.check=!1,e.isTemp=!0,t.checkedLeftData.push(e)})),this.rightCheckItems=[],this.isrightIndeterminate=!1,this.checkrightAll=!1,this.leftCheckItemChange(),this.rightCheckItemChange()):(this.checkedLeftData=this.checkedLeftData.filter((function(e,a,i){var s=!1;return t.leftCheckItems.forEach((function(t,a){e.sceneId==t.sceneId&&(s=!0)})),!s})),this.leftCheckItems.forEach((function(e,a){e.check=!1,t.checkedRightData.push(e)})),this.leftCheckItems=[],this.isleftIndeterminate=!1,this.checkleftAll=!1,this.leftCheckItemChange(),this.rightCheckItemChange())}}},pe=de,me=(a("8a41"),Object(k["a"])(pe,G,Z,!1,null,"08071584",null)),fe=me.exports,he=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.visible,"close-on-click-modal":!1,"modal-append-to-body":"","append-to-body":"",title:"高级筛选",width:"900px"},on:{"update:visible":function(t){e.visible=t},close:e.handleCancel}},[a("div",{staticStyle:{"margin-bottom":"8px"}},[e._v("筛选条件"),e.config.exportHelp?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.config.exportHelp.type,"data-id":e.config.exportHelp.id}}):e._e()]),e._v(" "),a("filter-fields",{attrs:{"condition-type-fun":e.conditionTypeFun,form:e.form,"field-list":e.fieldList,props:e.config.filterFieldsProps,"show-export":e.config.showExport},on:{"on-field-change":e.getError,"on-field-delete":e.handleDelete,"on-field-export":e.handleExport}}),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.showErrors,expression:"showErrors"}],staticClass:"el-icon-warning warning-info"},[a("span",{staticClass:"desc"},[e._v(e._s(e.errorTypes[e.errorType]))])]),e._v(" "),a("el-button",{staticStyle:{"padding-right":"0","padding-left":"0"},attrs:{type:"text"},on:{click:e.handleAdd}},[e._v("+ 添加筛选条件")]),e._v(" "),e.config.showSaveScene?a("div",{staticClass:"save"},[a("el-checkbox",{model:{value:e.saveChecked,callback:function(t){e.saveChecked=t},expression:"saveChecked"}},[e._v("保存为场景")]),e._v(" "),a("el-input",{directives:[{name:"show",rawName:"v-show",value:e.saveChecked,expression:"saveChecked"}],staticClass:"name",attrs:{maxlength:10,placeholder:"场景名称，最多10个字符"},model:{value:e.saveName,callback:function(t){e.saveName="string"===typeof t?t.trim():t},expression:"saveName"}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.saveChecked,expression:"saveChecked"}],staticClass:"save-setting"},[a("el-checkbox",{model:{value:e.saveDefault,callback:function(t){e.saveDefault=t},expression:"saveDefault"}},[e._v("设置为默认")]),e.config.help?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.config.help.type,"data-id":e.config.help.id}}):e._e()],1)],1):e._e(),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleConfirm(!1)}}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)],1)},ve=[],ge={showExport:!0,showSaveScene:!0,help:null,exportHelp:null,saveRequest:null,saveParams:null,filterFieldsProps:null},be={name:"FilterForm",components:{FilterFields:U},mixins:[],props:{dialogVisible:{type:Boolean,required:!0,default:!1},fieldList:{type:Array,required:!0,default:function(){return[]}},obj:{type:Object,required:!0,default:function(){return{}}},conditionTypeFun:Function,props:Object},data:function(){return{form:[],visible:!1,errorTypes:["筛选条件中有重复项！","请选择筛选条件！"],errorType:0,showErrors:!1,saveChecked:!1,saveDefault:!1,saveName:null}},computed:{config:function(){return Object(R["a"])(Object(r["a"])({},ge),this.props||{})}},watch:{dialogVisible:{handler:function(e){e&&(this.form=Object(se["z"])(this.obj.form),0==this.form.length&&this.form.push(this.getFilterItem()),this.saveChecked=!1,this.saveDefault=!1,this.saveName=null),this.visible=this.dialogVisible},deep:!0,immediate:!0}},methods:{handleCancel:function(){this.$emit("update:dialogVisible",!1)},getError:function(){this.showErrors=!1;for(var e=[],t=0;t<this.form.length;t++){var a=this.form[t];if(""===a.fieldName||void 0===a.fieldName||null===a.fieldName){this.errorType=1,this.showErrors=!0;break}if(e.includes(a.fieldName)){this.errorType=0,this.showErrors=!0;break}e.push(a.fieldName)}return this.showErrors},handleConfirm:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.getError())if(!this.saveChecked||this.saveName&&""!==this.saveName){var t={obj:M(this.form),form:this.form,saveChecked:this.saveChecked,saveDefault:this.saveDefault,saveName:this.saveName};this.$emit("filter",t,e),this.saveExportFields()}else this.$message.error("场景名称不能为空！")},saveExportFields:function(){if(this.config.saveRequest){var e=[];this.form.forEach((function(t){1===t.isOut&&e.push(t.fieldName)}));var t=this.config.saveParams?Object(r["a"])({defaultValue:JSON.stringify(e)},this.config.saveParams):{defaultValue:JSON.stringify(e)};this.config.saveRequest(t).then((function(e){})).catch((function(){}))}},handleAdd:function(){this.form.push(this.getFilterItem())},getFilterItem:function(){return{fieldName:"",name:"",formType:"",isOut:0,condition:"contains",type:3,value:"",setting:[],typeOption:[],settingList:[],flowName:"",settingName:"",address:{state:"",city:"",area:""}}},handleDelete:function(e){var t=this;this.$confirm("您确定要删除这一条数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.form.splice(e,1),t.getError()})).catch((function(){}))},handleExport:function(){this.handleConfirm(!0)}}},ye=be,_e=(a("9b24"),Object(k["a"])(ye,he,ve,!1,null,"b6234ade",null)),we=_e.exports,Se={showFilterView:!0,showExportFields:!1},Ce={name:"WkTableHeader",components:{WkFilterHeader:o["a"],FilterExportFields:X,SceneSet:fe,FilterForm:we},mixins:[B],inheritAttrs:!1,props:{props:Object,filterHeaderProps:Object,filterFormProps:Object,sceneSetProps:Object,sceneCreateProps:Object,conditionTypeFun:Function,fields:[Array,Function]},data:function(){return{filterObj:{form:[],obj:[]},exportFieldsShow:!1,fieldList:[],filterShow:!1,sceneSetShow:!1}},computed:{config:function(){return Object(R["a"])(Object(r["a"])({},Se),this.props||{})},filterHeaderConfig:function(){return Object(r["a"])({tabSetShow:!0,tabSetLabel:"场景设置",tabSetCommand:"sceneSet"},this.filterHeaderProps||{})},exportFields:function(){return this.filterObj.form?this.filterObj.form.filter((function(e){return 1===e.isOut})):[]},filterValidCount:function(){var e=Object(S["a"])(this.filterObj.obj)?this.filterObj.obj:[],t=2===e.filter((function(e){return"business_cause"===e.formType&&e.values&&e.values.length>0})).length,a=e.filter((function(e){return e.values&&e.values.length>0||[5,6].includes(e.type)}));return t?a.length-1:a.length}},watch:{"config.showExportFields":{handler:function(e){var t=this;return Object(n["a"])(Object(l["a"])().mark((function a(){return Object(l["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:!t.config.showFilterView||Object(S["a"])(t.fieldList)&&0!==t.fieldList.length||(t.initFieldList(),t.exportFieldsShow=e);case 1:case"end":return a.stop()}}),a)})))()},immediate:!0}},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{filterHeaderHandle:function(e,t){e===this.filterHeaderConfig.tabSetCommand&&(this.sceneSetShow=!0)},collapseHandle:function(e){var t=void 0!==e?e:!this.exportFieldsShow;t!==this.exportFieldsShow&&(this.exportFieldsShow=t,this.$emit("event-change","export-fields-collapse",this.exportFieldsShow))},exportFilter:function(e){this.filterObj.obj=e,this.$emit("filter-change",e)},clearFilterVal:function(e){this.filterObj.obj=[],this.resetAdvancedFilterFieldsValue(e),this.$emit("filter-change",[])},showFilterClick:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(Object(S["a"])(e.fieldList)&&0!==e.fieldList.length){t.next=5;break}return t.next=3,e.initFieldList();case 3:t.next=8;break;case 5:return t.next=7,e.getFieldList();case 7:e.fieldList=t.sent;case 8:e.filterShow=!0;case 9:case"end":return t.stop()}}),t)})))()},initFieldList:function(){var e=this;return Object(n["a"])(Object(l["a"])().mark((function t(){var a,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getFieldList();case 2:a=t.sent,i=[],a.forEach((function(t){if(1===t.isOut){var a=Object(se["z"])(t);i.push(e.getAdvancedFilterDefaultItemByFormType(a,t,e.conditionTypeFun))}})),e.fieldList=a,e.filterObj.form=i;case 7:case"end":return t.stop()}}),t)})))()},getFieldList:function(){var e=this;return new Promise((function(t){Object(S["a"])(e.fields)?t(e.fields):e.fields instanceof Function&&e.fields().then((function(e){t(e)}))}))},handleFilter:function(e,t){var a=this;this.filterObj=e,t?this.exportFieldsShow||this.collapseHandle(!0):(this.filterShow=!1,e.saveChecked&&this.sceneCreateProps.saveRequest(Object(r["a"])({isDefault:e.saveDefault?1:0,name:e.saveName,data:JSON.stringify(e.obj)},this.sceneCreateProps.saveParams)).then((function(e){a.updateSceneList()})).catch((function(){})),this.$emit("filter-change",e.obj))},updateSceneList:function(){this.$emit("event-change","scene-refresh")}}},xe=Ce,ke=(a("b211"),Object(k["a"])(xe,i,s,!1,null,"ab558d46",null));t["a"]=ke.exports},6535:function(e,t,a){"use strict";a("0af2")},6880:function(e,t,a){"use strict";a("dac4")},6984:function(e,t,a){},"6fc6":function(e,t,a){},"7caf":function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return r})),a.d(t,"e",(function(){return o}));var i=a("b775");function s(e){return Object(i["a"])({url:"hrmAchievementsResultTemplate/queryPageList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function l(e){return Object(i["a"])({url:"hrmAchievementsResultTemplate/addResultTemplate",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function n(e){return Object(i["a"])({url:"/hrmAchievementsResultTemplate/delTemplate",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function r(e){return Object(i["a"])({url:"/hrmAchievementsResultTemplate/information/".concat(e),method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function o(e){return Object(i["a"])({url:"/hrmAchievementsResultTemplate/updateResultTemplate",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}},"7d00":function(e,t,a){},"8a41":function(e,t,a){"use strict";a("fc25")},"8c7b":function(e,t,a){},9144:function(e,t,a){"use strict";a("d851")},9228:function(e,t,a){},"94e7":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("flexbox",{staticClass:"detail-head-base",attrs:{align:"stretch"}},e._l(e.list,(function(t,i){return a("div",{key:i,staticClass:"base-item"},[a("div",{staticClass:"base-title"},[e._v(e._s(t.title)),t.helpObj?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":t.helpObj.type,"data-id":t.helpObj.id}}):e._e()]),e._v(" "),a("div",{staticClass:"base-value text-one-line"},[t.showPhone?a("span",{staticClass:"phone-item"},[a("i",{staticClass:"wk wk-circle-iphone"}),e._v(" "+e._s(t.value)+"\n      ")]):a("el-tooltip",{staticClass:"text-one-line",attrs:{content:t.value,effect:"dark",placement:"top"}},[a("span",[e._v(e._s(t.value))])])],1)])})))},s=[],l={name:"DetailHeadBase",components:{},props:{list:Array},data:function(){return{}},methods:{}},n=l,r=(a("2a46"),a("2877")),o=Object(r["a"])(n,i,s,!1,null,"66b0d858",null);t["a"]=o.exports},9897:function(e,t,a){},"9aa4":function(e,t,a){},"9b10":function(e,t,a){},"9b24":function(e,t,a){"use strict";a("9897")},"9f49":function(e,t,a){},a9ab:function(e,t,a){"use strict";a("6984")},ab0e:function(e,t,a){"use strict";a("bd84")},adcc:function(e,t,a){"use strict";a("8c7b")},aec5:function(e,t,a){"use strict";a("ba89")},af64:function(e,t,a){},b211:function(e,t,a){"use strict";a("e7db")},b499:function(e,t,a){},ba89:function(e,t,a){},bb7d:function(e,t,a){"use strict";a("3627")},bd84:function(e,t,a){},c2e1:function(e,t,a){"use strict";a("e31c")},cc4d:function(e,t,a){},d851:function(e,t,a){e.exports={colorPrimary:"#0052cc",colorBlack:"#172b4d",colorSuccess:"#36b37e",colorWarning:"#ffab00",colorDanger:"#ff5630",colorN40:"#dfe1e6",axisLineColor:"#dfe1e6",axisLabelFontWeight:"500"}},da37:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wk-detail-header"},[e.subtitle||e.$slots.subtitle?a("div",{staticClass:"wk-detail-header-subtitle"},[e._t("subtitle",[e._v(e._s(e.subtitle))])],2):e._e(),e._v(" "),a("flexbox",{staticClass:"wk-detail-header-body",attrs:{justify:"space-between"}},[a("div",{staticClass:"wk-detail-header-left"},[e._t("title"),e._v(" "),e.title&&!e.$slots.title?a("el-tooltip",{attrs:{disabled:!e.title,content:e.title,effect:"dark",placement:"top-start"}},[a("span",{staticClass:"wk-detail-header-title"},[e._v(e._s(e.title))])]):e._e(),e._v(" "),e._t("left"),e._v(" "),e.pageList&&e.pageList.length>1?a("el-button-group",{staticClass:"wk-detail-header-page-switch"},[a("el-button",{attrs:{type:"subtle",icon:"el-icon-arrow-left"},on:{click:function(t){e.$emit("pageChange","left")}}}),e._v(" "),a("el-button",{attrs:{type:"subtle",icon:"el-icon-arrow-right"},on:{click:function(t){e.$emit("pageChange","right")}}})],1):e._e()],2),e._v(" "),a("div",{staticClass:"wk-detail-header-right"},[e._t("right"),e._v(" "),e.dropdowns&&e.dropdowns.length>0?a("el-dropdown",{class:{"margin-left-interval":e.$slots.right},attrs:{trigger:"click"},on:{command:e.dropdownCommand}},[a("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-more"}}),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.dropdowns,(function(t,i){return a("el-dropdown-item",{key:i,attrs:{icon:t.icon,command:t.command}},[e._v(e._s(t.name))])})))],1):e._e()],2)])],1)},s=[],l={name:"WkDetailHeader",components:{},props:{subtitle:String,title:String,dropdowns:Array,pageList:Array},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{dropdownCommand:function(e){this.$emit("command",e)}}},n=l,r=(a("9144"),a("3277"),a("2877")),o=Object(r["a"])(n,i,s,!1,null,"43b39a5a",null);t["a"]=o.exports},dac4:function(e,t,a){e.exports={colorPrimary:"#0052cc",colorBlack:"#172b4d",colorSuccess:"#36b37e",colorWarning:"#ffab00",colorDanger:"#ff5630",colorN40:"#dfe1e6",axisLineColor:"#dfe1e6",axisLabelFontWeight:"500"}},dc14:function(e,t,a){},de2b:function(e,t,a){"use strict";a("3ee3")},e091:function(e,t,a){"use strict";a("9aa4")},e31c:function(e,t,a){},e3308:function(e,t,a){"use strict";a("11a7")},e414:function(e,t,a){"use strict";a("7d00")},e684:function(e,t,a){"use strict";a("9b10")},e7db:function(e,t,a){},e9153:function(e,t,a){"use strict";a("b499")},eac4:function(e,t,a){"use strict";a("2f4a")},eb66b:function(e,t,a){"use strict";a("cc4d")},f187:function(e,t,a){},f35d:function(e,t,a){"use strict";a("fec4")},f3df:function(e,t,a){"use strict";a("f187")},f5e4:function(e,t,a){"use strict";a("9f49")},f962:function(e,t,a){e.exports=a.p+"static/img/status-stop.2ad2912a.png"},fc25:function(e,t,a){},fec4:function(e,t,a){},ff67:function(e,t,a){"use strict";a("0828")},ff8d:function(e,t,a){}}]);