(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-222d6c6e"],{"1a38":function(e,t,a){},3223:function(e,t,a){},"3d4e":function(e,t,a){"use strict";var n=a("5530"),i=(a("ac1f"),a("841c"),a("14d9"),a("de91")),r=a("6bfe");t["a"]={created:function(){this.getFieldList()},data:function(){return{loading:!1,createType:"",tableHeight:document.documentElement.clientHeight-260,list:[],fieldList:[],currentPage:1,pageSize:15,pageSizes:[15,30,60,100],total:0,otherParams:{},request:"",sortData:{},popoverFilterWidth:150,attendanceDetailDialog:!1,attendanceDetail:{},statusMap:i["a"],params:{}}},computed:{searchComputed:function(){return this.$parent.search||this.search},date:function(){return this.$parent.month||this.month},filterObjComputed:function(){return this.$parent.filterObj||this.filterObj},times:function(){return[this.$moment(this.date,"YYYY-MM").startOf("month").format("YYYY-MM-DD"),this.$moment(this.date,"YYYY-MM").endOf("month").format("YYYY-MM-DD")]}},methods:{sortChange:function(e,t,a){this.currentPage=1,this.sortData=e||{},this.getList()},rowClick:function(){"punching"==this.recordType&&(this.attendanceDetailDialog=!0,this.attendanceDetail={})},getMonthField:function(e,t){for(var a=[],n=this.getCurrentMonthDay(e,t),i=1;i<=n;i++)a.push({fieldName:"day"+i,name:i+"",width:100});return a},getCurrentMonthDay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getFullYear(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getMonth()+1,a=new Date(e,t,0);return a.getDate()},refreshList:function(){this.handleCurrentChange(1)},handleSizeChange:function(e){this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.currentPage=e,this.getList()},fieldFormatter:function(e,t){return"clockType"==t.property?{1:"上班打卡",2:"下班打卡"}[e[t.property]]||"--":"type"==t.property?{1:"手机端打卡",2:"HR添加",3:"自动打卡"}[e[t.property]]||"--":"attendanceTime"==t.property?e[t.property].split(" ").shift():Object(r["c"])(e[t.property])?"--":e[t.property]},getList:function(e){var t=this;this.$refs.originalTable&&this.$refs.originalTable.clearSelection(),this.loading=!0;var a={page:this.currentPage,limit:this.pageSize,search:this.searchComputed,times:this.times},i=this.request,r=this.otherParams;for(var o in this.filterObjComputed)a[o]=this.filterObjComputed[o];this.sortData.order&&(a.sortField=this.sortData.prop,a.order="ascending"==this.sortData.order?2:1),this.params=Object(n["a"])(Object(n["a"])({},a),r),i(Object(n["a"])(Object(n["a"])({},a),r)).then((function(a){t.loading=!1,t.list=a.data.list,t.total=a.data.totalRow,a.data.totalRow&&Math.ceil(a.data.totalRow/t.pageSize)<t.currentPage&&t.currentPage>1?(t.currentPage=t.currentPage-1,t.getList()):(t.total=a.data.totalRow,t.loading=!1),t.$nextTick((function(){var e=document.querySelector(".el-table__body-wrapper");e.scrollTop=1,0!=e.scrollLeft&&(e.scrollLeft=e.scrollLeft-1)})),e&&e()})).catch((function(){t.loading=!1}))}}}},5638:function(e,t,a){"use strict";a("3223")},"5a4e":function(e,t,a){"use strict";a("bc80")},"7f46":function(e,t,a){"use strict";a("1a38")},bc80:function(e,t,a){},ca8f:function(e,t,a){"use strict";a.d(t,"e",(function(){return i})),a.d(t,"j",(function(){return r})),a.d(t,"b",(function(){return o})),a.d(t,"g",(function(){return l})),a.d(t,"c",(function(){return c})),a.d(t,"n",(function(){return s})),a.d(t,"l",(function(){return u})),a.d(t,"m",(function(){return d})),a.d(t,"k",(function(){return m})),a.d(t,"p",(function(){return h})),a.d(t,"o",(function(){return f})),a.d(t,"d",(function(){return p})),a.d(t,"a",(function(){return g})),a.d(t,"f",(function(){return b})),a.d(t,"i",(function(){return y})),a.d(t,"h",(function(){return v}));var n=a("b775");function i(e){return Object(n["a"])({url:"hrmAttendanceEmpMonthRecord/excelEmpMonthRecordExport",method:"post",responseType:"blob",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function r(e){return Object(n["a"])({url:"hrmAttendanceClock/queryPageList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function o(e){return Object(n["a"])({url:"hrmAttendanceClock/add",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function l(e){return Object(n["a"])({url:"hrmAttendanceClock/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function c(e){return Object(n["a"])({url:"hrmAttendanceClock/deleteByIds",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function s(e){return Object(n["a"])({url:"hrmAttendanceEmpMonthRecord/queryAttendanceEmpMonthRecordPageList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function u(e){return Object(n["a"])({url:"hrmAttendanceEmpMonthRecord/queryAttendanceEmpMonthDailyDetail",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function d(e){return Object(n["a"])({url:"hrmAttendanceEmpMonthRecord/queryAttendanceEmpMonthDailyDetailPageList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function m(e){return Object(n["a"])({url:"hrmAttendanceClock/queryAttendanceDailyDetail",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function h(e){return Object(n["a"])({url:"hrmEmployeeOverTimeRecord/queryOverTimeRecordPageList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function f(e){return Object(n["a"])({url:"hrmAttendanceClock/queryOutCardPageList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function p(e){return Object(n["a"])({url:"hrmAttendanceClock/excelExport",method:"post",responseType:"blob",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function g(e){return Object(n["a"])({url:"hrmAttendanceEmpMonthRecord/excelEmpMonthDailyDetailExport",method:"post",responseType:"blob",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function b(e){return Object(n["a"])({url:"hrmAttendanceClock/queryCurrentAttendShiftTime",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function y(e){return Object(n["a"])({url:"/hrmEmployee/queryInspectionDeptEmployeeList/".concat(e),method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function v(e){return Object(n["a"])({url:"hrmEmployee/queryAttendanceAllEmployeeList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}},cc78:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"el-input__inner range-time-picker"},[a("i",{staticClass:"el-input__icon el-icon-time"}),e._v(" "),a("el-select",{attrs:{disabled:e.disabled,placeholder:"请选择"},on:{change:e.hourChange},model:{value:e.hourNum,callback:function(t){e.hourNum=t},expression:"hourNum"}},e._l(e.hourOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))),e._v(" "),a("span",{staticClass:"division"},[e._v(":")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择",disabled:e.disabled},on:{change:e.minuteChange},model:{value:e.minuteNum,callback:function(t){e.minuteNum=t},expression:"minuteNum"}},e._l(e.minuteOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)},i=[],r=(a("99af"),a("14d9"),{name:"RangeTimePicker",components:{},props:{value:String,selectableRange:{type:Array,default:function(){return["00:00","23:59"]}},disabled:{type:Boolean,default:!1}},data:function(){return{hourNum:0,hourOptions:[],minuteNum:0,minuteOptions:[]}},computed:{rangeConfig:function(){var e=(this.selectableRange[0]||"00:00").split(":"),t=(this.selectableRange[1]||"23:59").split(":");return{minHour:isNaN(parseInt(e[0]))?0:parseInt(e[0]),maxHour:isNaN(parseInt(t[0]))?0:parseInt(t[0]),minMinute:isNaN(parseInt(e[1]))?0:parseInt(e[1]),maxMinute:isNaN(parseInt(t[1]))?0:parseInt(t[1])}},currentValue:function(){return"".concat(this.fillZero(this.hourNum),":").concat(this.fillZero(this.minuteNum))}},watch:{selectableRange:{handler:function(){this.initHourOptions(),this.verifyValue(this.hourNum,this.minuteNum)?this.initMinuteOptions():(this.hourNum=this.rangeConfig.minHour,this.minuteNum=this.rangeConfig.minMinute,this.updateValue())},deep:!0},value:{handler:function(){this.compareValue()},immediate:!0},hourNum:{handler:function(){this.initMinuteOptions()},immediate:!0}},created:function(){this.initHourOptions()},mounted:function(){},beforeDestroy:function(){},methods:{compareValue:function(){if(this.value){var e=this.value.split(":"),t=parseInt(e[0]),a=parseInt(e[1]);this.verifyValue(t,a)?this.currentValue!==this.value&&(this.hourNum=t,this.minuteNum=a):(this.verifyValue(this.hourNum,this.minuteNum)||(this.hourNum=this.rangeConfig.minHour,this.minuteNum=this.rangeConfig.minMinute),this.updateValue())}},verifyValue:function(e,t){var a=parseInt("".concat(this.fillZero(e+24)).concat(this.fillZero(t))),n=parseInt("".concat(this.fillZero(this.rangeConfig.minHour+24)).concat(this.fillZero(this.rangeConfig.minMinute))),i=parseInt("".concat(this.fillZero(this.rangeConfig.maxHour+24)).concat(this.fillZero(this.rangeConfig.maxMinute)));return a>=n&&a<=i},hourChange:function(){if(this.hourNum===this.rangeConfig.minHour){var e=this.rangeConfig.minHour===this.rangeConfig.maxHour,t=e?this.rangeConfig.maxMinute:59;(this.minuteNum<this.rangeConfig.minMinute||this.minuteNum>t)&&(this.minuteNum=this.rangeConfig.minMinute)}else this.hourNum===this.rangeConfig.maxHour&&(this.minuteNum<0||this.minuteNum>this.rangeConfig.maxMinute)&&(this.minuteNum=0);this.updateValue(),this.$emit("change",this.currentValue)},minuteChange:function(){this.updateValue(),this.$emit("change",this.currentValue)},updateValue:function(){this.$emit("input",this.currentValue)},initHourOptions:function(){for(var e=[],t=this.rangeConfig.minHour;t<=this.rangeConfig.maxHour;t++)e.push(this.getNumItem(t));this.hourOptions=e},initMinuteOptions:function(){var e=[];if(this.hourNum===this.rangeConfig.minHour)for(var t=this.rangeConfig.minHour===this.rangeConfig.maxHour,a=t?this.rangeConfig.maxMinute:59,n=this.rangeConfig.minMinute;n<=a;n++)e.push(this.getNumItem(n,!1));else if(this.hourNum===this.rangeConfig.maxHour)for(var i=0;i<=this.rangeConfig.maxMinute;i++)e.push(this.getNumItem(i,!1));else for(var r=0;r<=59;r++)e.push(this.getNumItem(r,!1));this.minuteOptions=e},getNumItem:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var a,n=e,i=e;if(e<0)i=24+e,a=i<10?"昨日0".concat(i):"昨日".concat(i);else if(e<10)a="0".concat(i);else if(e>9&&e<=23)a="".concat(i);else if(e>23){var r=e-24;a=r<10?"次日0".concat(r):"次日".concat(r)}return{label:a,value:n}}return e<10?{label:"0".concat(e),value:e}:{label:"".concat(e),value:e}},fillZero:function(e){var t;if(e<0){var a=Math.abs(e);t=e<10?"-0".concat(a):"-".concat(a)}else t=e<10?"0".concat(e):e;return t}}}),o=r,l=(a("7f46"),a("2877")),c=Object(l["a"])(o,n,i,!1,null,"2e72dff3",null);t["a"]=c.exports},de91:function(e,t,a){"use strict";t["a"]=[{value:0,color:"#333333",label:"正常",backgroundColor:"#f5f6f7"},{value:1,color:"#e83d22",label:"迟到",backgroundColor:"#ffeeee"},{value:2,color:"#e83d22",label:"早退",backgroundColor:"#ffeeee"},{value:3,color:"#ff7c18",label:"缺卡",backgroundColor:"#fff5e5"},{value:4,color:"#ff7c18",label:"旷工",backgroundColor:"#fff5e5"},{value:5,color:"#7fcb27",label:"外勤",backgroundColor:"#e9f7eb"},{value:6,color:"#809aaa",label:"请假",backgroundColor:"#f3f3ff"},{value:7,color:"#3da8f5",label:"加班",backgroundColor:"#e5f6fe"},{value:8,color:"#7fcb27",label:"出差",backgroundColor:"#e9f7eb"},{value:9,color:"#333333",label:"休息",backgroundColor:"#f5f6f7"}]},dfc4:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"clock-index",attrs:{id:"employee-main-container"}},[a("wk-page-header",{attrs:{title:"月度汇总",dropdowns:e.headerMoreHandle},on:{command:e.headerMoreHandleClick}},[a("el-menu",{attrs:{slot:"title","default-active":e.recordType,mode:"horizontal"},on:{select:e.menuSelect},slot:"title"},[a("el-menu-item",{attrs:{index:"punching"}},[e._v("打卡概况")]),e._v(" "),a("el-menu-item",{attrs:{index:"original"}},[e._v("打卡明细")])],1),e._v(" "),"punching"==e.recordType&&e.synchronousClockInAuth||"original"==e.recordType&&e.createPunchInRecordAuth?a("el-button",{attrs:{slot:"right",type:"primary"},on:{click:e.addOrSync},slot:"right"},[e._v("\n      "+e._s(e.headerBtnContent)+"\n    ")]):e._e()],1),e._v(" "),a("wk-filter-header",{attrs:{props:{searchPlaceholder:"请输入员工姓名/工号"},"selection-list":"punching"===e.recordType?[]:e.originalSelectionList,operations:e.headerOptionList},on:{"operations-click":e.selectionBarClick,"event-change":e.filterHeaderHandle}},[a("template",{slot:"left-start"},[a("el-date-picker",{staticClass:"margin-left-interval",attrs:{clearable:!1,"value-format":"yyyy-MM",format:"",type:"month",placeholder:"选择月"},on:{change:e.componentRefreshList},model:{value:e.month,callback:function(t){e.month=t},expression:"month"}})],1),e._v(" "),a("template",{slot:"right"},[e.hasFilterContent?a("el-button",{attrs:{type:"text"},on:{click:e.resetFilter}},[e._v("清除筛选")]):e._e(),e._v(" "),a("wk-popover-filter",{ref:"popoverFilter",staticClass:"margin-left-interval",attrs:{width:e.popoverFilterWidth,"field-from":e.filterObj,"field-list":e.filterList,"has-content":e.hasFilterContent,placement:"bottom"},on:{"update:fieldFrom":function(t){e.filterObj=t},sure:e.componentRefreshList,reset:e.resetFilter},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return[a("el-select",{staticStyle:{"margin-left":"20px"},attrs:{multiple:"","collapse-tags":"",placeholder:"请选择"},on:{change:e.typesChange},model:{value:e.filterObj[n.field],callback:function(t){e.$set(e.filterObj,n.field,t)},expression:"filterObj[data.field]"}},e._l(n.setting,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})))]}}])})],1)],2),e._v(" "),a("div",{staticClass:"crm-container"},[a(e.componentName,{ref:"componentRef",tag:"component",on:{syncSuccess:function(t){e.$message.success("同步成功")},"selection-change":e.originalSelectionChange}})],1),e._v(" "),e.showAddDialog?a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.showAddDialog,"before-close":e.handleClose,title:e.dialogTitle,width:"600px"},on:{"update:visible":function(t){e.showAddDialog=t}}},[a("el-form",{ref:"elForm",attrs:{model:e.fieldForm,rules:e.fieldRules,"validate-on-rule-change":!1,"label-position":"top"}},e._l(e.formFieldList,(function(t,n){return a("wk-form-item",{key:n,staticClass:"wk-form-item",attrs:{"ignore-fields":["clockTime","attendanceTime"],"field-from":e.fieldForm,item:t},on:{change:e.formChange},scopedSlots:e._u([{key:"default",fn:function(n){var i=n.data;return["date"==t.formType?a("el-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:!e.fieldForm.clockEmployeeId,"picker-options":e.pickerOptions,"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},on:{change:e.attendanceTimeChange},model:{value:e.fieldForm[i.field],callback:function(t){e.$set(e.fieldForm,i.field,t)},expression:"fieldForm[data.field]"}}):e._e(),e._v(" "),"datetime"==t.formType?a("range-time-picker",{staticClass:"range-time-picker",class:{disabled:!e.fieldForm.attendanceTime},attrs:{disabled:!e.fieldForm.attendanceTime,"selectable-range":e.clockTimeRange},model:{value:e.fieldForm[i.field],callback:function(t){e.$set(e.fieldForm,i.field,t)},expression:"fieldForm[data.field]"}}):e._e()]}}])})}))),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSure}},[e._v("确定")])],1)],1):e._e()],1)},i=[],r=a("5530"),o=(a("14d9"),a("b64b"),a("a9e3"),a("99af"),a("d3b7"),a("159b"),a("ac1f"),a("841c"),a("ca8f")),l=a("0f4c"),c=a("fdca"),s=a("1bfc"),u=a("9011"),d=a("c04c"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"punching-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"Table",staticStyle:{width:"100%"},attrs:{id:"crm-table","row-height":40,"cell-class-name":e.cellClassName,data:e.list,height:e.tableHeight,stripe:"",border:"","highlight-current-row":""}},[e._l(e.fieldList,(function(t,n){return a("el-table-column",{key:t.fieldName,attrs:{fixed:0==n,prop:t.fieldName,label:t.name,"min-width":t.width,align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"header",fn:function(i){var r=i.column;return[n>3?a("div",[a("p",{staticClass:"day"},[e._v(e._s(r.label))]),e._v(" "),a("p",{staticClass:"week"},[e._v(e._s(e.getWeek(r.label)))])]):[e._v(e._s(t.name))]]}},{key:"default",fn:function(t){var i=t.row,r=t.column;return[n>3?a("div",{on:{click:function(t){e.handleDetail(i,r)}}},e._l(e.getTimeAndStatus(i.dateList[Number(r.label)-1]["time"]),(function(t,n){return a("span",{key:n,style:{color:e.statusMap[t.status].color}},[e._v("\n            "+e._s(t.time)+"\n          ")])}))):[e._v(e._s(i[r.property]||"--"))]]}}])})})),e._v(" "),a("el-table-column")],2),e._v(" "),a("div",{staticClass:"p-contianer"},[a("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{visible:e.attendanceDetailDialog,title:e.attendanceDetail.employeeName+" "+e.attendanceDetail.currentDate,width:"650px"},on:{"update:visible":function(t){e.attendanceDetailDialog=t}}},[a("p",[e._v("班次："+e._s(e.attendanceDetail.shiftStr))]),e._v(" "),e.attendanceDetail.leaveStr?a("p",[e._v("请假："+e._s(e.attendanceDetail.leaveStr))]):e._e(),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.attendanceDetail.attendanceEmpDailyRecordList}},e._l(e.detailFieldList,(function(t,n){return a("el-table-column",{key:n,attrs:{prop:t.prop,label:t.label,width:"width"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,n=t.column;return[e._v("\n          "+e._s(e.fieldFormatter(a,n))+"\n        ")]}}])})})))],1)],1)},h=[],f=a("3835"),p=(a("d81d"),a("caad"),a("2ca0"),a("a15b"),a("6bfe")),g=a("3d4e"),b=a("c1df"),y=a.n(b),v={mixins:[g["a"]],data:function(){return{attendanceDetailDialog:!1,recordType:"punching",request:o["m"],detailFieldList:[{label:"打卡时间",prop:"clockTime"},{label:"打卡类型",prop:"clockType"},{label:"打卡地点",prop:"address"},{label:"打卡来源",prop:"type"}]}},methods:{getTimeAndStatus:function(e){var t=this;return e.length?e.map((function(e){var a=e.split("-"),n=Object(f["a"])(a,2),i=n[0],r=n[1];return[3,4,6,9].includes(Number(r))?{time:t.statusMap[r].label,status:r}:{time:i||"--",status:r||0}})):[{time:"--",status:0}]},handleDetail:function(e,t){var a=this;if(t.property.startsWith("day")){var n=e.employeeName,i=e.employeeId,r=e.dateList[Number(t.label)-1]["date"];Object(o["k"])({employeeId:i,currentDate:r}).then((function(e){a.attendanceDetailDialog=!0;var t=e.data,i=t.hrmAttendanceShiftVO,o=t.hrmEmployeeLeaveRecord,l=t.attendanceEmpDailyRecordList,c=void 0===l?[]:l,s=a.getTimeRange(i),u=o&&o.leaveType+" "+o.leaveStartTime+"～"+o.leaveEndTime;a.attendanceDetail={employeeName:n,currentDate:r,shiftStr:s,leaveStr:u,attendanceEmpDailyRecordList:c}})).catch((function(){}))}},getTimeRange:function(e){for(var t=[],a=e.shiftType,n=1;n<=3;n++)e["start"+n]&&t.push(e["start"+n]+"-"+e["end"+n]);return"".concat({0:"休息",1:"早晚打卡",2:"分段打卡"}[a]," ").concat(t.join("  ")," ")},getFieldList:function(){var e=[{fieldName:"employeeName",name:"姓名",sortable:"",width:100},{fieldName:"jobNumber",name:"工号",sortable:"",width:100},{fieldName:"deptName",name:"部门",sortable:"",width:100},{fieldName:"post",name:"岗位",sortable:"",width:100}];this.fieldList=e.concat(this.getMonthField()),this.getList()},getWeek:function(e){var t=y()(this.times[0],"YYYY-MM-DD").year(),a=y()(this.times[0],"YYYY-MM-DD").month(),n=y()([t,a,e]).day();return{1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",0:"日"}[n]},syncData:function(){var e=this;this.getList((function(){e.$message.success("同步成功")}))},cellClassName:function(e){e.row,e.column,e.rowIndex;var t=e.columnIndex;return t>3?"can-visit--underline":""},fieldFormatter:function(e,t){return"clockType"==t.property?{1:"上班打卡",2:"下班打卡"}[e[t.property]]||"--":"type"==t.property?{1:"手机端打卡",2:"HR添加",3:"自动打卡"}[e[t.property]]||"--":"attendanceTime"==t.property?e[t.property].split(" ").shift():"address"==t.property?Object(p["c"])(e[t.property])?"--":e.isOutCard?e[t.property]+"(外勤打卡)":e[t.property]:Object(p["c"])(e[t.property])?"--":e[t.property]}}},T=v,k=(a("5638"),a("2877")),C=Object(k["a"])(T,m,h,!1,null,"7393eb14",null),O=C.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"original-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"originalTable",staticStyle:{width:"100%"},attrs:{id:"crm-table","row-height":40,data:e.list,height:e.tableHeight,"row-key":"clockId",stripe:"",border:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange,"row-click":e.rowClick}},[a("el-table-column",{key:"selection",attrs:{"reserve-selection":"",type:"selection",align:"center"}}),e._v(" "),e._l(e.fieldList,(function(t,n){return a("el-table-column",{key:t.fieldName,attrs:{fixed:0==n,prop:t.fieldName,label:t.name,"min-width":t.width,formatter:e.fieldFormatter,"show-overflow-tooltip":""}})})),e._v(" "),"original"===e.recordType?a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{disabled:2!=n.type,type:"text"},on:{click:function(t){e.updateHandler(n)}}},[e._v("修改")])]}}])}):e._e()],2),e._v(" "),a("div",{staticClass:"p-contianer"},[a("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},D=[],F={mixins:[g["a"]],data:function(){return{tableHeight:document.documentElement.clientHeight-260,recordType:"original",request:o["j"],disabled:!0,multipleSelection:[]}},methods:{handleSelectionChange:function(e){this.multipleSelection=e,this.multipleSelection.length?this.disabled=this.multipleSelection.some((function(e){return 2!=e.type})):this.disabled=!0,this.$emit("selection-change",e)},updateHandler:function(e){var t=this;this.$parent.showAddDialog=!0;var a=e.clockEmployeeId,n=e.clockType,i=e.clockTime,r=e.type,o=e.attendanceTime,l=e.clockStage,c=e.remark,s=e.clockId;this.$parent.dialogTitle="修改打卡记录",this.$parent.formFieldList.forEach((function(e){"user"==e.formType&&(e.disabled=!0)})),this.$nextTick((function(){t.$parent.fieldForm={clockEmployeeId:a,clockType:n,clockTime:y()(i).format("HH:mm"),type:r,attendanceTime:y()(o).format("YYYY-MM-DD"),clockStage:l,remark:c,clockId:s,isUpdate:!0}})),this.$parent.getSelectTimeClockTime(y()(i).format("HH:mm"))},delRecord:function(){var e=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0;var t=e.multipleSelection.map((function(e){return e.clockId}));Object(o["c"])(t).then((function(){e.loading=!1,e.$message.success("操作成功"),e.refreshList()})).catch((function(){e.loading=!1,e.message.error("操作失败")}))})).catch((function(){}))},getFieldList:function(){this.fieldList=[{fieldName:"employeeName",name:"姓名",sortable:"",width:100},{fieldName:"jobNumber",name:"工号",sortable:"",width:100},{fieldName:"deptName",name:"部门",sortable:"",width:100},{fieldName:"post",name:"岗位",sortable:"",width:100},{fieldName:"attendanceTime",name:"上班日期",sortable:"",width:100},{fieldName:"clockType",name:"打卡类型",sortable:"",width:100},{fieldName:"clockTime",name:"打卡时间",sortable:"",width:100},{fieldName:"address",name:"打卡地点",sortable:"",width:100},{fieldName:"type",name:"打卡来源",sortable:"",width:100},{fieldName:"remark",name:"备注",sortable:"",width:100}],this.getList()}}},N=F,w=Object(k["a"])(N,j,D,!1,null,null,null),M=w.exports,_=a("cc78"),S=a("2f62"),Y=a("ed08"),H={name:"ClockIndex",components:{WkPageHeader:c["a"],WkFilterHeader:s["a"],WkPopoverFilter:u["a"],WkFormItem:d["default"],PunchingTable:O,OriginalTable:M,RangeTimePicker:_["a"]},data:function(){return{loading:!1,recordType:"punching",originalSelectionList:[],month:y()().format("YYYY-MM"),search:"",filterObj:{},componentName:"PunchingTable",showAddDialog:!1,fieldForm:{clockType:1,clockStage:1,clockTime:"",attendanceTime:"",type:2},fieldRules:{clockEmployeeId:[{required:!0,message:"请输入员工姓名",trigger:"blur"}],clockType:[{required:!0,message:"请输入打卡类型",trigger:"blur"}],clockTime:[{required:!0,message:"请输入打卡时间",trigger:"blur"}],clockStage:[{required:!0,message:"请输入打卡阶段",trigger:"blur"}],attendanceTime:[{required:!0,message:"请选择打卡日期",trigger:"blur"}]},formFieldList:[{name:"员工姓名",field:"clockEmployeeId",formType:"user",disabled:!1,props:{label:"employeeName",value:"employeeId",request:o["i"],searchRequest:o["h"]},redio:!0},{name:"打卡类型",field:"clockType",formType:"select",redio:!0,setting:[{label:"上班打卡",value:1},{label:"下班打卡",value:2}]},{name:"打卡日期",field:"attendanceTime",formType:"date"},{name:"打卡时间",field:"clockTime",formType:"datetime"},{name:"备注",field:"remark",formType:"textarea",redio:!0}],pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()}},dialogTitle:"新建打卡记录",clockTimeObj:{},createClockFlag:!0,createMessage:""}},computed:Object(r["a"])(Object(r["a"])({},Object(S["b"])(["collapse","hrm"])),{},{attendanceAuth:function(){return this.hrm&&this.hrm.attendance},synchronousClockInAuth:function(){return this.attendanceAuth&&this.attendanceAuth.punching},createPunchInRecordAuth:function(){return this.attendanceAuth&&this.attendanceAuth.addClock},exportPunchInRecord:function(){return this.attendanceAuth&&this.attendanceAuth.excelexport},headerMoreHandle:function(){var e=[];return this.exportPunchInRecord&&e.push({command:"export",name:"导出",icon:"wk wk-export"}),e},filterList:function(){var e=[{name:"部门",field:"deptIds",formType:"structure",radio:!1,props:{dataType:"hrm"},request:l["e"],setting:[]}];return"original"==this.recordType&&e.push.apply(e,[{name:"打卡类型",field:"clockType",formType:"select",setting:[{label:"上班打卡",value:1},{label:"下班打卡",value:2}]},{name:"打卡地点",field:"address",formType:"text"},{name:"打卡来源",field:"types",formType:"types",setting:[{label:"手机端打卡",value:1},{label:"HR添加",value:2}]}]),e},hasFilterContent:function(){if(this.filterObj){for(var e=!1,t=Object.keys(this.filterObj),a=0;a<t.length;a++){var n=t[a];""!=this.filterObj[n]&&this.filterObj[n]!=[]&&null!=this.filterObj[n]&&void 0!=this.filterObj[n]&&(e=!0)}return e}return!1},headerBtnContent:function(){return{punching:"同步打卡记录",original:"新建打卡记录"}[this.recordType]},headerOptionList:function(){var e=[{name:"删除",type:"delete",icon:"wk wk-icon-delete-line"}];return e},clockPickerOptions:function(){var e=this;return{disabledDate:function(t){if(!Object(p["c"])(e.clockTimeObj)){var a=e.clockTimeObj,n=a.advanceTime,i=a.lateTime,r=a.earlyTime,o=a.postponeTime;if(n&&i&&r&&o){if(1==e.fieldForm.clockType){var l=y()(n).format("YYYY-MM-DD"),c=y()(i).format("YYYY-MM-DD");return t.getTime()!=y()(l)&&t.getTime()!=y()(c)}if(2==e.fieldForm.clockType){var s=y()(r).format("YYYY-MM-DD"),u=y()(o).format("YYYY-MM-DD");return t.getTime()!=y()(s)&&t.getTime()!=y()(u)}}return t.getTime()!=y()(e.fieldForm.attendanceTime)}return t.getTime()!=y()(e.fieldForm.attendanceTime)}}},clockTimeRange:function(){var e=this.fieldForm.clockType;if(!Object(p["c"])(this.clockTimeObj)){var t=this.clockTimeObj,a=t.advanceTime,n=t.lateTime,i=t.earlyTime,r=t.postponeTime;if(!a&&!n&&!i&&!r)return["00:00","23:59"];if(1==e){var o=y()(a).format("YYYY-MM-DD"),l=y()(n).format("YYYY-MM-DD");if(y()(o).isSame(l))return[y()(a).format("HH:mm:ss"),y()(n).format("HH:mm:ss")];var c=Number(y()(n).format("HH"))+24,s=y()(n).format("mm"),u=y()(n).format("ss");return[y()(a).format("HH:mm:ss"),"".concat(c,":").concat(s,":").concat(u)]}if(2==e){var d=y()(i).format("YYYY-MM-DD"),m=y()(r).format("YYYY-MM-DD");if(y()(d).isSame(m))return[y()(i).format("HH:mm:ss"),y()(r).format("HH:mm:ss")];var h=Number(y()(r).format("HH"))+24,f=y()(r).format("mm"),g=y()(r).format("ss");return[y()(i).format("HH:mm:ss"),"".concat(h,":").concat(f,":").concat(g)]}}return["00:00","23:59"]},isRestDayClock:function(){return!Object(p["c"])(this.clockTimeObj)&&!this.clockTimeObj.start&&!this.clockTimeObj.end}}),watch:{collapse:{handler:function(e){this.popoverFilterWidth=document.documentElement.clientWidth-(e?89:225)},immediate:!0}},created:function(){},methods:{componentRefreshList:function(){this.$refs.componentRef.refreshList()},handleClose:function(){var e=this;this.showAddDialog=!1,this.dialogTitle="新建打卡记录",this.formFieldList.forEach((function(t){"user"==t.formType&&e.$set(t,"disabled",!1)})),this.$refs.elForm.resetFields()},handleSure:function(){var e=this;if(this.createClockFlag){this.loading=!0;var t=this.$refs.elForm;t.validate((function(a){if(a){var n=Object(Y["z"])(e.fieldForm),i=e.fieldForm,r=i.attendanceTime,l=i.clockTime,c=i.clockType,s=e.clockTimeObj,u=s.start,d=s.end,m="",h=l.split(":")[0];m=h>23?"".concat(y()(r).add(1,"days").format("YYYY-MM-DD")," 0").concat(Number(h)-24,":").concat(l.split(":")[1],":00"):"".concat(r," ").concat(l,":00"),n.clockTime=m;var f=y()("2023-01-01 ".concat(u||"00:00")).format("HH:mm:ss"),p=y()("2023-01-01 ".concat(d||"00:00")).format("HH:mm:ss");n.attendanceTime="".concat(n.attendanceTime," ").concat(1==c?f:p),e.isRestDayClock&&(n.clockStatus=7);var g=e.fieldForm.hasOwnProperty("isUpdate")&&e.fieldForm.isUpdate,b=g?o["g"]:o["b"];b(n).then((function(t){e.loading=!1,e.$message.success(g?"修改成功":"添加成功"),e.showAddDialog=!1,e.componentRefreshList()})).catch((function(){e.loading=!1}))}else if(e.loading=!1,t.fields)for(var v=0;v<t.fields.length;v++){var T=t.fields[v];if("error"==T.validateState){e.$message.error(T.validateMessage);break}}}))}else this.$message.error(this.createMessage)},formChange:function(e,t,a){"clockEmployeeId"==e.field&&(this.$refs.elForm.validateField("clockEmployeeId"),a.length?this.getSelectTimeClockTime():(this.$set(this.fieldForm,"attendanceTime",""),this.$set(this.fieldForm,"clockTime","")))},attendanceTimeChange:function(e){this.$set(this.fieldForm,"clockTime",""),e&&this.getSelectTimeClockTime()},getSelectTimeClockTime:function(e){var t=this;if(this.fieldForm.clockEmployeeId&&this.fieldForm.attendanceTime){var a={employeeId:this.fieldForm.clockEmployeeId,currentDate:this.fieldForm.attendanceTime};Object(o["f"])(a).then((function(a){t.clockTimeObj=a.data||{};var n=a.data,i=n.status,r=n.end,o=n.start,l=n.advanceTime,c=n.earlyTime;i||(t.createMessage="该员工当天尚未创建，无法添加打卡记录",t.$message.error(t.createMessage),t.createClockFlag=!1),r||o?1==t.fieldForm.clockType?t.fieldForm.clockTime=y()(l).format("HH:mm"):2==t.fieldForm.clockType&&(t.fieldForm.clockTime=y()(c).format("HH:mm")):t.fieldForm.clockTime="00:00",e&&(t.fieldForm.clockTime=e)}))}},addOrSync:function(){"punching"==this.recordType?this.$refs.componentRef.syncData():(this.fieldForm={clockType:1,clockStage:1,clockTime:"",attendanceTime:"",type:2},this.clockTimeObj={},this.showAddDialog=!0)},menuSelect:function(e){this.componentName={original:"OriginalTable",punching:"PunchingTable"}[e],this.recordType=e,this.originalSelectionList=[],this.search="",this.filterObj={}},resetFilter:function(){this.filterObj={},this.componentRefreshList()},filterHeaderHandle:function(e,t){"search"===e&&(this.search=t,this.componentRefreshList())},typesChange:function(){this.$set(this.$refs.popoverFilter.$data.from,"types",this.filterObj.types)},headerMoreHandleClick:function(e){var t=this;if("export"==e){var a=Object(Y["z"])(this.$refs.componentRef.params);this.loading=!0;var n="original"==this.recordType?o["d"]:o["a"];n(a).then((function(e){Object(Y["d"])(e),t.loading=!1})).catch((function(){t.loading=!1}))}},originalSelectionChange:function(e){this.originalSelectionList=e},selectionBarClick:function(e){"delete"===e&&this.$refs.componentRef.delRecord()}}},x=H,L=(a("5a4e"),Object(k["a"])(x,n,i,!1,null,"ffa55864",null));t["default"]=L.exports}}]);